import{j as _,a8 as yn,e as Pe,O as ke,a4 as ve,E as Te,a7 as Oe,s as at,a9 as jt,d as de,aa as Ie,a2 as Ye,M as qe,a3 as Ke,w as dt,x as ht,p as Xe,q as Je,r as Qe,t as et,W as Jt,ab as vn,ac as Sn,ad as xn,ae as Nt,af as wn,ag as kn,ah as mt,ai as Cn,aj as jn,L as He,ak as Qt,a as An,al as En}from"./chakra-oLgDt0ZB.js";import{r as X,c as rt,g as On,u as Rn}from"./react-Fl03amIb.js";import{_ as it,u as J,r as ce,E as Se,R as ut,a as en,s as Pn,b as tn,c as zn,D as ye,d as le,e as ue,f as ee,M as Tn,F as yt,g as Ne,h as ot,i as ze,j as vt,o as At,k as Bn,l as Et,m as Be,S as lt,n as Dt,B as ct,p as Ot,q as Rt,t as In,v as Nn,w as Dn,x as St,y as xt,z as Mn,A as Mt,C as Ln,G as Fn,H as nn,I as rn,J as Un,K as Wn,P as Zn,L as Hn,N as Lt,O as Gn,Q as Vn,T as $n,U as Yn,V as qn,W as Kn,X as Ft,Y as Xn,Z as Jn,$ as Qn,a0 as gt,a1 as er,a2 as tr,a3 as nr,a4 as rr,a5 as sr,a6 as ir,a7 as ar,a8 as Me,a9 as $e,aa as Le,ab as De,ac as sn,ad as or,ae as wt,af as kt,ag as lr,ah as cr,ai as dr,aj as hr,ak as an,al as on,am as ur,an as fr,ao as pr,ap as mr,aq as Ut,ar as gr,as as br,at as _r,au as yr,av as Ct,aw as vr,ax as Sr,ay as xr,az as wr,aA as kr,aB as Cr,aC as jr,aD as Ar,aE as Er,aF as Or,aG as Ge,aH as ln,aI as Rr,aJ as Pr,aK as zr,aL as Tr}from"./index-5KRu5Wq_.js";import{R as be,w as Br,i as Ir,d as Wt,a as cn,s as Nr,b as bt,r as Dr,g as _t,P as Mr,c as Lr,u as Fr,e as Ur,f as Wr}from"./param-manager-utils-yZ7fee0s.js";var Zr=function(o){var d=o.text,t=o.delimiter;return _.jsx("span",{children:d.split(t||"\\").map(function(i,s){return s?[_.jsx(yn,{children:"⏎"},s),i]:i})})};const Hr={mtr:()=>it(()=>import("./index-RVdv0m9B.js"),__vite__mapDeps([0,1,2,3,4,5,6,7])),gzmtr:()=>it(()=>import("./index-dj_NMTW4.js"),__vite__mapDeps([8,1,2,3,4,5,7])),shmetro:()=>it(()=>import("./index-fb2dLBXs.js"),__vite__mapDeps([9,1,2,3,4,5,6,7]))};function Gr(o){const[d,t]=X.useState({});return X.useEffect(()=>(Hr[o]().then(i=>{t(i.default)}).catch(i=>{console.error("Failed to load canvas for style ".concat(o),i),t({})}),()=>{t({})}),[o]),d}const Vr={position:"relative",flexDirection:"row",overflowX:"auto","&::before, &::after":{content:'""',margin:"auto"},"& > svg":{flex:"0 0 auto",border:"1px solid black"}};function $r(){const{canvasToShow:o,canvasScale:d}=J(r=>r.app),{svg_height:t,style:i}=J(r=>r.param),s=Gr(i);X.useEffect(()=>{document.getElementById("css_share").href="/rmg/styles/share_".concat(i,".css"),ce.event(Se.STYLE_CHANGE,{style:i})},[i]);const n=Object.keys(s).filter(r=>o.includes(r)),e=t*d;return _.jsx(Pe,{minH:e,sx:Vr,children:Object.keys(s).length===0?_.jsx(ut,{isIndeterminate:!0}):n.map(r=>_.jsx(en,{sx:{minWidth:750,height:e},children:s[r]},r+i))})}const Zt=o=>d=>{d(Pn(o)),d(tn(o.stn_list))},xe=(o,d)=>(t,i)=>{const{stn_list:s}=i().param,n={...s,[o]:d};t(we(n))},we=o=>d=>{d(zn(o)),d(tn(o))},Yr=(o=!1)=>(d,t)=>{const{stn_list:i}=t().param,s=Object.keys(i).reduce((n,e)=>({...n,[e]:(r=>{var l,u,v,p;switch(r){case"linestart":return{...i.lineend,parents:[],children:o?i.lineend.parents:i.lineend.parents.toReversed(),branch:{right:(l=i.lineend.branch)==null?void 0:l.left}};case"lineend":return{...i.linestart,parents:o?i.linestart.children:i.linestart.children.toReversed(),children:[],branch:{left:(u=i.linestart.branch)==null?void 0:u.right}};default:{const f=i[r].children.map(g=>g==="linestart"?"lineend":g==="lineend"?"linestart":g),c=i[r].parents.map(g=>g==="linestart"?"lineend":g==="lineend"?"linestart":g);return{...i[r],parents:o?f:f.reverse(),children:o?c:c.reverse(),branch:{left:(v=i[r].branch)==null?void 0:v.right,right:(p=i[r].branch)==null?void 0:p.left}}}}})(e)}),{});d(we(s))},Ht=(o,d)=>(t,i)=>{const s=i().param.stn_list[o];t(xe(o,{...s,name:d}))},Gt=(o,d)=>(t,i)=>{const s=i().param.stn_list[o];t(xe(o,{...s,secondaryName:d}))},qr=(o,d)=>(t,i)=>{const s=i().param.stn_list[o];t(xe(o,{...s,num:d}))},Vt=(o,d,t)=>(i,s)=>{var r,l;const n=s().param.stn_list[o],e=n.transfer.groups.map(u=>({...u}));if(e.length>d)e[d]={...e[d],lines:((r=e[d].lines)!=null?r:[]).concat(t)};else{for(let u=e.length;u<d;u++)e[u]={lines:[]};e[d]={lines:[t]}}i(xe(o,{...n,transfer:{...n.transfer,groups:[e[0],...(l=e.slice(1))!=null?l:[]]}}))},Kr=(o,d,t)=>(i,s)=>{var e,r;const n=s().param.stn_list[o];if(n.transfer.groups.length>d&&(((e=n.transfer.groups[d].lines)==null?void 0:e.length)||0)>t){const l=n.transfer.groups.map((u,v)=>{var p;return v===d?{...u,lines:(p=u.lines)==null?void 0:p.filter((f,c)=>c!==t)}:u});i(xe(o,{...n,transfer:{...n.transfer,groups:[l[0],...(r=l.slice(1))!=null?r:[]]}}))}},Xr=(o,d,t,i)=>(s,n)=>{var r,l;const e=n().param.stn_list[o];if(e.transfer.groups.length>d&&(((r=e.transfer.groups[d].lines)==null?void 0:r.length)||0)>t){const u=e.transfer.groups.map((v,p)=>{var f;return p===d?{...v,lines:(f=v.lines)==null?void 0:f.map((c,g)=>g===t?i:c)}:v});s(xe(o,{...e,transfer:{...e.transfer,groups:[u[0],...(l=u.slice(1))!=null?l:[]]}}))}},$t=(o,d,t)=>(i,s)=>{var r;const n=s().param.stn_list[o],e=n.transfer.groups.map(l=>({...l}));e.length>d&&(e[d]={...e[d],name:t},i(xe(o,{...n,transfer:{...n.transfer,groups:[e[0],...(r=e.slice(1))!=null?r:[]]}})))},Jr=(o,d)=>(t,i)=>{const s=i().param.stn_list[o];t(xe(o,{...s,transfer:{...s.transfer,tick_direc:d}}))},Qr=(o,d)=>(t,i)=>{const s=i().param.stn_list[o];t(xe(o,{...s,transfer:{...s.transfer,paid_area:d}}))},es=(o,d,t)=>(i,s)=>{var e,r;const n=s().param.stn_list[o];i(xe(o,{...n,branch:{...n.branch,[d]:(r=(e=n.branch)==null?void 0:e[d])==null?void 0:r.with(0,t)}}))},ts=(o,d,t)=>(i,s)=>{var r,l,u;const n=s().helper.branches,e={stnId:o,direction:d,first:t};if(d===ye.left){const v=(r=n.slice(1).find(p=>p.slice(-1)[0]===o))==null?void 0:r[0];if(v){const p=n[0][n[0].indexOf(v)+1];i(Yt([e,{stnId:v,direction:ye.right,first:p}]))}}else{const v=(u=(l=n.slice(1).find(p=>p[0]===o))==null?void 0:l.slice(-1))==null?void 0:u[0];if(v){const p=n[0][n[0].indexOf(v)-1];i(Yt([e,{stnId:v,direction:ye.left,first:p}]))}}},Yt=o=>(d,t)=>{var s,n,e,r;const{stn_list:i}=t().param;d(we({...i,[o[0].stnId]:{...i[o[0].stnId],branch:{...i[o[0].stnId].branch,[o[0].direction]:(n=(s=i[o[0].stnId].branch)==null?void 0:s[o[0].direction])==null?void 0:n.with(1,o[0].first)}},[o[1].stnId]:{...i[o[1].stnId],branch:{...i[o[1].stnId].branch,[o[1].direction]:(r=(e=i[o[1].stnId].branch)==null?void 0:e[o[1].direction])==null?void 0:r.with(1,o[1].first)}}}))},ns=(o,d)=>(t,i)=>{var n,e,r;const s=i().helper.branches;if(d===ye.left){const l=(n=s.slice(1).find(u=>u.slice(-1)[0]===o))==null?void 0:n[0];l&&t(qt(o,l))}else{const l=(r=(e=s.slice(1).find(u=>u[0]===o))==null?void 0:e.slice(-1))==null?void 0:r[0];l&&t(qt(l,o))}},qt=(o,d)=>(t,i)=>{const{stn_list:s}=i().param;t(we({...s,[o]:{...s[o],parents:s[o].parents.slice().reverse()},[d]:{...s[d],children:s[d].children.slice().reverse()}}))},rs=(o,d)=>(t,i)=>{const s=i().param.stn_list[o];t(xe(o,{...s,facility:d||void 0}))},ss=(o,d)=>(t,i)=>{const s=i().param.stn_list[o];t(xe(o,{...s,services:d}))},is=(o,d)=>(t,i)=>{const s=i().param.stn_list[o];t(xe(o,{...s,loop_pivot:d}))},as=(o,d)=>(t,i)=>{const s=i().param.stn_list[o];t(xe(o,{...s,one_line:d}))},os=(o,d)=>(t,i)=>{const s=i().param.stn_list[o];t(xe(o,{...s,int_padding:d}))},ls=o=>(d,t)=>{const s=t().param.stn_list[o].int_padding,n=JSON.parse(JSON.stringify(t().param.stn_list));Object.values(n).forEach(e=>{e.int_padding=s}),d(we(n))},cs=(o,d,t=2,i="asc")=>(s,n)=>{var u;const e=n().param.stn_list,l=(u=n().helper.branches[o])==null?void 0:u.slice(1,-1);if(l){const v=l.reduce((p,f,c)=>({...p,[f]:{...e[f],num:(d+c*(i==="desc"?-1:1)).toString().padStart(t,"0")}}),e);s(we(v))}};function ds(){const{t:o}=le(),d=ue(),t=J(l=>l.app.selectedStation);console.log("InfoSection:: Rendering for",t);const i=J(l=>l.param.style),{num:s,name:n,secondaryName:e}=J(l=>l.param.stn_list[t]),r=[{type:"input",label:o("StationSidePanel.info.num"),value:s,placeholder:"01",onChange:l=>d(qr(t,l)),hidden:![ee.GZMTR].includes(i)},{type:"input",label:o("Chinese name"),value:n[0],onChange:l=>d(Ht(t,[l,n[1]]))},{type:"input",label:o("English name"),value:n[1],onChange:l=>d(Ht(t,[n[0],l]))},{type:"input",label:o("StationSidePanel.info.zhSecondary"),value:e?e[0]:"",placeholder:"1号航站楼",onChange:l=>d(Gt(t,[l,e?e[1]:""])),hidden:![ee.GZMTR].includes(i)},{type:"input",label:o("StationSidePanel.info.enSecondary"),value:e?e[1]:"",placeholder:"Terminal 1",onChange:l=>d(Gt(t,[e?e[0]:"",l])),hidden:![ee.GZMTR].includes(i)}];return _.jsxs(ke,{p:1,children:[_.jsx(ve,{as:"h5",size:"sm",children:o("StationSidePanel.info.title")}),_.jsx(be,{fields:r,minW:130})]})}class hs{static hexToRgb(d){return[parseInt(d.slice(1,3),16),parseInt(d.slice(3,5),16),parseInt(d.slice(5,7),16)]}static fade(d,t){return"rgba(".concat([...this.hexToRgb(d),t].join(","),")")}static euclideanDistance(d,t){return this.hexToRgb(d).reduce((i,s,n)=>i+Math.pow(s-this.hexToRgb(t)[n],2),0)}}function Pt(o){var s;const{theme:d,onClick:t}=o,{t:i}=le();return _.jsx(Te,{size:"xs","aria-label":i("Colour"),mt:"0.45px",color:d==null?void 0:d[3],bg:d==null?void 0:d[2],_hover:{bg:hs.fade((s=d==null?void 0:d[2])!=null?s:"#aaaaaa",.7)},icon:_.jsx(Tn,{}),onClick:t})}function us(o){const{interchangeList:d,onAdd:t,onDelete:i,onUpdate:s}=o,{t:n}=le(),e=ue(),[r,l]=X.useState(),{paletteAppClipOutput:u}=J(y=>y.app),{style:v,theme:p,stn_list:f}=J(y=>y.param);X.useEffect(()=>{r!==void 0&&u&&(s==null||s(r,{...d[r],theme:u}),l(void 0))},[u==null?void 0:u.toString()]);const c=Object.values(f).reduce((y,b)=>{const[x,C]=y;return[[...new Set(x.concat(b.transfer.groups.map(j=>{var A,N;return(N=(A=j.lines)==null?void 0:A.map(O=>O.name[0]))!=null?N:[]}).flat()))],[...new Set(C.concat(b.transfer.groups.map(j=>{var A,N;return(N=(A=j.lines)==null?void 0:A.map(O=>O.name[1]))!=null?N:[]}).flat()))]]},[[],[]]),g=Object.fromEntries(Object.entries(yt).filter(([y])=>!["railway"].includes(y)).map(([y,b])=>[y,n(b)])),m=d.map((y,b)=>[{type:"input",label:n("Chinese name"),value:y.name[0],onChange:x=>s==null?void 0:s(b,{...y,name:[x,y.name[1]]}),optionList:c[0]},{type:"input",label:n("English name"),value:y.name[1],onChange:x=>s==null?void 0:s(b,{...y,name:[y.name[0],x]}),optionList:c[1]},{type:"select",label:n("Line icon"),value:y.facility,options:g,onChange:x=>s==null?void 0:s(b,{...y,facility:x}),hidden:![ee.MTR].includes(v)}]);return _.jsxs(Ne,{direction:"column",children:[d.length===0&&_.jsxs(Oe,{spacing:.5,"data-testid":"interchange-card-stack",children:[_.jsx(at,{as:"i",flex:1,align:"center",fontSize:"md",colorScheme:"gray",children:n("StationSidePanel.interchange.noInterchanges")}),_.jsx(Te,{size:"sm",variant:"ghost","aria-label":n("StationSidePanel.interchange.add"),onClick:()=>t==null?void 0:t({theme:[p[0],"","#aaaaaa",ot.white],name:["",""]}),icon:_.jsx(ze,{})})]}),d.map((y,b)=>_.jsxs(Oe,{spacing:.5,"data-testid":"interchange-card-stack-".concat(b),children:[_.jsx(vt,{label:n("Colour"),minW:"40px",noLabel:b!==0,children:_.jsx(Pt,{theme:y.theme,onClick:()=>{var x;l(b),e(At((x=y.theme)!=null?x:[p[0],"","#aaaaaa",ot.white]))}})}),_.jsx(be,{fields:m[b],noLabel:b!==0}),t&&b===m.length-1?_.jsx(Te,{size:"sm",variant:"ghost","aria-label":n("StationSidePanel.interchange.copy"),onClick:()=>t==null?void 0:t(d.slice(-1)[0]),icon:_.jsx(Bn,{})}):_.jsx(ke,{minW:8}),i&&_.jsx(Te,{size:"sm",variant:"ghost","aria-label":n("StationSidePanel.interchange.remove"),onClick:()=>i==null?void 0:i(b),icon:_.jsx(Et,{})})]},b))]})}function fs(){const{t:o}=le(),d=ue(),t=J(p=>p.app.selectedStation),{theme:i,style:s}=J(p=>p.param),{transfer:n}=J(p=>p.param.stn_list[t]),e=p=>{var f,c,g,m;return[{type:"input",label:o("Station Chinese name"),value:(c=(f=n.groups[p].name)==null?void 0:f[0])!=null?c:"",hidden:![ee.MTR].includes(s),onChange:y=>{var b,x;return d($t(t,p,[y,(x=(b=n.groups[p].name)==null?void 0:b[1])!=null?x:""]))}},{type:"input",label:o("Station English name"),value:(m=(g=n.groups[p].name)==null?void 0:g[1])!=null?m:"",hidden:![ee.MTR].includes(s),onChange:y=>{var b,x;return d($t(t,p,[(x=(b=n.groups[p].name)==null?void 0:b[0])!=null?x:"",y]))}},{type:"switch",label:o("Paid area"),isChecked:n.paid_area,onChange:y=>d(Qr(t,y)),hidden:![ee.MTR].includes(s)||p===0,oneLine:!0}]},r=p=>f=>{d(Vt(t,p,f))},l=p=>f=>{d(Kr(t,p,f))},u=p=>(f,c)=>{d(Xr(t,p,f,c))},v=()=>{d(Vt(t,n.groups.length,{theme:[i[0],"","#AAAAAA",ot.white],name:["",""]}))};return _.jsxs(jt,{align:"flex-start",p:1,children:[_.jsxs(Pe,{w:"100%",children:[_.jsx(ve,{as:"h5",size:"sm",mr:"auto",children:o("StationSidePanel.interchange.title")}),s===ee.MTR&&_.jsx(Be,{selections:[{label:o("Text on the left"),value:lt.left},{label:o("Text on the right"),value:lt.right}],defaultValue:n.tick_direc,onChange:p=>d(Jr(t,p))})]}),n.groups.map((p,f)=>{var c;return _.jsxs(X.Fragment,{children:[_.jsx(ve,{as:"h6",size:"xs",children:o(f===0?"StationSidePanel.interchange.within":f===1?"StationSidePanel.interchange.outStation":"StationSidePanel.interchange.outSystem")}),f!==0&&_.jsx(be,{fields:e(f)}),_.jsx(us,{interchangeList:(c=p.lines)!=null?c:[],onAdd:r(f),onDelete:l(f),onUpdate:u(f)})]},f)}),n.groups.length<3&&_.jsx(de,{size:"xs",variant:"ghost",alignSelf:"flex-end",leftIcon:_.jsx(ze,{}),onClick:v,children:o("StationSidePanel.interchange.addGroup")})]})}function ps(){const{t:o}=le(),d=ue(),t=J(g=>g.app.selectedStation),{style:i,loop:s}=J(g=>g.param),{services:n,facility:e,loop_pivot:r,one_line:l,int_padding:u}=J(g=>g.param.stn_list[t]),v=Object.values(Dt).map(g=>({label:o("StationSidePanel.more."+g),value:g,disabled:g===Dt.local&&i!==ee.SHMetro})),p=Object.fromEntries(Object.entries(yt).filter(([g])=>!["railway"].includes(g)).map(([g,m])=>[g,o(m)])),f=Object.fromEntries(Object.entries(yt).filter(([g])=>!["np360"].includes(g)).map(([g,m])=>[g,o(m)])),c=[{type:"custom",label:o("StationSidePanel.more.service"),component:_.jsx(Be,{selections:v,defaultValue:n,onChange:g=>d(ss(t,g)),multiSelect:!0}),hidden:![ee.GZMTR,ee.SHMetro].includes(i)},{type:"select",label:o("StationSidePanel.more.facility"),value:e||"",options:{"":o("None"),...i===ee.MTR?p:f},onChange:g=>d(rs(t,g)),hidden:![ee.MTR,ee.SHMetro].includes(i)},{type:"switch",label:o("StationSidePanel.more.pivot"),isChecked:r,onChange:g=>d(is(t,g)),hidden:![ee.SHMetro].includes(i)||!s,minW:"full",oneLine:!0},{type:"switch",label:o("StationSidePanel.more.oneLine"),isChecked:l,onChange:g=>d(as(t,g)),hidden:![ee.SHMetro].includes(i),minW:"full",oneLine:!0},{type:"input",label:o("StationSidePanel.more.intPadding"),value:u.toString(),validator:g=>Number.isInteger(g),onChange:g=>d(os(t,Number(g))),hidden:![ee.SHMetro].includes(i)},{type:"custom",label:o("StationSidePanel.more.intPaddingApplyGlobal"),component:_.jsx(Be,{selections:[{label:o("StationSidePanel.more.apply"),value:"",disabled:!1}],defaultValue:"",onChange:g=>d(ls(t))}),oneLine:!0,hidden:![ee.SHMetro].includes(i)}];return _.jsxs(ke,{p:1,children:[_.jsx(ve,{as:"h5",size:"sm",children:o("StationSidePanel.more.title")}),_.jsx(be,{fields:c})]})}function ms(){const{t:o}=le(),d=ue(),t=J(p=>p.app.selectedStation),i=J(p=>p.param.stn_list),{parents:s,children:n,branch:e}=i[t],r={[ct.through]:o("StationSidePanel.branch.through"),[ct.nonThrough]:o("StationSidePanel.branch.nonThrough")},l=p=>(p===ye.left?s:n).reduce((f,c)=>({...f,[c]:i[c].name.join(" ")}),{}),u={upper:o("StationSidePanel.branch.upper"),lower:o("StationSidePanel.branch.lower")},v=p=>{const f=e==null?void 0:e[p];return f?[{type:"select",label:o("StationSidePanel.branch.type"),options:r,value:f[0],onChange:c=>d(es(t,p,c))},{type:"select",label:o("StationSidePanel.branch.firstStation"),options:l(p),value:f[1],onChange:c=>d(ts(t,p,c))},{type:"select",label:o("StationSidePanel.branch.position"),options:u,value:(p===ye.left?s:n)[0]===f[1]?"upper":"lower",onChange:()=>d(ns(t,p))}]:[]};return _.jsxs(ke,{p:1,children:[_.jsx(ve,{as:"h5",size:"sm",children:o("Branches")}),_.jsx(ve,{as:"h6",size:"xs",children:o("Branch on the left")}),_.jsx(Ne,{direction:"column",children:s.length===2?_.jsx(be,{fields:v(ye.left)}):_.jsx(at,{as:"i",flex:1,align:"center",fontSize:"md",colorScheme:"gray",children:o("No branches found")})}),_.jsx(ve,{as:"h6",size:"xs",children:o("Branch on the right")}),_.jsx(Ne,{direction:"column",children:n.length===2?_.jsx(be,{fields:v(ye.right)}):_.jsx(at,{as:"i",flex:1,align:"center",fontSize:"md",colorScheme:"gray",children:o("No branches found")})})]})}function gs(){return _.jsxs(Ot,{children:[_.jsx(ds,{}),_.jsx(Ie,{}),_.jsx(fs,{}),_.jsx(Ie,{}),_.jsx(ms,{}),_.jsx(Ie,{}),_.jsx(ps,{})]})}function bs(){const{t:o}=le(),d=ue(),{style:t,svgWidth:i,svg_height:s,y_pc:n,branchSpacingPct:e,padding:r,direction_gz_x:l,direction_gz_y:u,loop:v}=J(f=>f.param),p=[...Rt[t].map(f=>({type:"input",label:o("StyleSidePanel.layout.".concat(f,"Width")),value:i[f].toString(),onChange:c=>d(In({width:Number(c),canvas:f}))})),{type:"input",label:o("StyleSidePanel.layout.canvasHeight"),value:s.toString(),onChange:f=>d(Nn(Number(f)))},{type:"slider",label:o("StyleSidePanel.layout.verticalPosition"),value:n,min:0,max:100,onChange:f=>d(Dn(f)),leftIcon:_.jsx(St,{}),rightIcon:_.jsx(xt,{}),hidden:![ee.MTR,ee.GZMTR].includes(t)},{type:"slider",label:o(v?"StyleSidePanel.layout.branchSpacingLoop":"Branch spacing"),value:e,min:0,max:v?50:100,onChange:f=>d(Mn(f)),leftIcon:_.jsx(Mt,{}),rightIcon:_.jsx(ze,{})},{type:"slider",label:o("StyleSidePanel.layout.padding"),value:r,min:0,max:50,onChange:f=>d(Ln(f)),leftIcon:_.jsx(Mt,{}),rightIcon:_.jsx(ze,{})},{type:"slider",label:o("StyleSidePanel.layout.directionGzX"),value:l,min:0,max:100,onChange:f=>d(Fn(f)),leftIcon:_.jsx(nn,{}),rightIcon:_.jsx(rn,{}),hidden:![ee.GZMTR].includes(t)},{type:"slider",label:o("StyleSidePanel.layout.directionGzY"),value:u,min:0,max:100,onChange:f=>d(Un(f)),leftIcon:_.jsx(St,{}),rightIcon:_.jsx(xt,{}),hidden:![ee.GZMTR].includes(t)}];return _.jsxs(ke,{p:1,children:[_.jsx(ve,{as:"h5",size:"sm",children:o("StyleSidePanel.layout.title")}),_.jsx(be,{fields:p,minW:130})]})}function _s(){var G;const{t:o}=le(),d=ue(),{paletteAppClipOutput:t}=J(w=>w.app),{style:i,theme:s,line_name:n,line_num:e,spanLineNum:r,direction:l,platform_num:u,psd_num:v,namePosMTR:p,customiseMTRDest:f,info_panel_type:c,stn_list:g,loop:m}=J(w=>w.param),y=Math.max(...Object.values(g).map(w=>w.services.length)),[b,x]=X.useState(!1);X.useEffect(()=>{b&&t&&(d(Wn(t)),x(!1))},[t==null?void 0:t.toString()]);const C=[{label:o("StyleSidePanel.design.left"),value:lt.left},{label:o("StyleSidePanel.design.right"),value:lt.right}],j=Object.values(Zn).reduce((w,T)=>({...w,[T]:o("StyleSidePanel.design."+T)}),{}),A=Object.values(Hn).reduce((w,T)=>({...w,[T]:o("StyleSidePanel.design."+T)}),{}),N=[{type:"custom",label:o("Colour"),component:_.jsx(Pt,{theme:s,onClick:()=>{x(!0),d(At(s))}}),minW:"40px"},{type:"input",label:o("StyleSidePanel.design.zhLineName"),value:n[0],onChange:w=>d(Lt([w,n[1]])),minW:130},{type:"input",label:o("StyleSidePanel.design.enLineName"),value:n[1],onChange:w=>d(Lt([n[0],w])),minW:130},{type:"input",label:o("StyleSidePanel.design.lineNum"),value:e,onChange:w=>d(Gn(w)),hidden:![ee.GZMTR].includes(i)},{type:"custom",label:o("Span digits over rows"),component:_.jsx(Be,{selections:[{label:o("Yes"),value:!0},{label:o("No"),value:!1}],defaultValue:r!=null?r:!1,onChange:w=>d(Vn(w))}),hidden:![ee.GZMTR].includes(i)},{type:"input",label:o("StyleSidePanel.design.platformNum"),value:u||"",onChange:w=>d($n(w))},{type:"input",label:o("StyleSidePanel.design.psdNum"),value:v,onChange:w=>d(Yn(w)),hidden:![ee.GZMTR].includes(i)},{type:"select",label:o("StyleSidePanel.design.panelType"),value:c,options:i===ee.GZMTR?j:A,onChange:w=>d(qn(w)),hidden:![ee.GZMTR,ee.SHMetro].includes(i)},{type:"custom",label:o("StyleSidePanel.design.direction"),component:_.jsx(Be,{selections:C,defaultValue:l,onChange:w=>d(Kn(w))}),minW:"full",oneLine:!0}],O=[{label:o("StyleSidePanel.design.upwards"),value:!0},{label:o("StyleSidePanel.design.downward"),value:!1}],D=[{type:"custom",label:o("StyleSidePanel.design.firstStationNameDisplay"),component:_.jsx(Oe,{spacing:.5,children:_.jsx(Be,{selections:O,defaultValue:(G=p.isFlip)!=null?G:!0,onChange:w=>d(Ft(w))})}),minW:"full",oneLine:!0,hidden:![ee.SHMetro].includes(i)||y>1||m}],R=[{label:o("StyleSidePanel.design.alternatively"),value:!0},{label:o("StyleSidePanel.design.onOneSide"),value:!1}],F=[{type:"custom",label:o("StyleSidePanel.design.nameDisplay"),component:_.jsxs(Oe,{spacing:.5,children:[_.jsx(Te,{size:"xs",variant:"ghost","aria-label":o("StyleSidePanel.design.flip"),title:o("StyleSidePanel.design.flip"),icon:_.jsx(Xn,{}),onClick:()=>d(Ft())}),_.jsx(Be,{selections:R,defaultValue:p.isStagger,onChange:w=>d(Jn(w))})]}),minW:"full",oneLine:!0,hidden:![ee.MTR].includes(i)},{type:"switch",label:o("StyleSidePanel.design.legacyDestination"),isChecked:f.isLegacy,onChange:w=>d(Qn(w)),hidden:![ee.MTR].includes(i),minW:"full",oneLine:!0},{type:"switch",label:o("StyleSidePanel.design.overrideTerminal"),isChecked:f.terminal!==!1,onChange:w=>d(gt(w?["",""]:!1)),hidden:![ee.MTR].includes(i),minW:"full",oneLine:!0},{type:"input",label:o("StyleSidePanel.design.terminalZhName"),value:f.terminal?f.terminal[0]:"",placeholder:"機場及博覽館",onChange:w=>d(gt([w,f.terminal?f.terminal[1]:""])),hidden:![ee.MTR].includes(i)||f.terminal===!1},{type:"input",label:o("StyleSidePanel.design.terminalEnName"),value:f.terminal?f.terminal[1]:"",placeholder:"Airport and AsiaWorld-Expo",onChange:w=>d(gt([f.terminal?f.terminal[0]:"",w])),hidden:![ee.MTR].includes(i)||f.terminal===!1}];return _.jsxs(ke,{p:1,children:[_.jsx(ve,{as:"h5",size:"sm",children:o("StyleSidePanel.design.title")}),_.jsx(be,{fields:[...N,...F,...D],minW:130})]})}function ys(){const{t:o}=le(),d=ue(),{branches:t}=J(f=>f.helper),{loop:i,loop_info:s}=J(f=>f.param),{bank:n,left_and_right_factor:e,bottom_factor:r}=s,l=t.flat().filter((f=>c=>(f[c]=(f[c]||0)+1)===2)({})).filter(f=>!["linestart","lineend"].includes(f)),u=Math.abs(t[0].indexOf(l[0])-t[0].indexOf(l[1])),v=t.length>=2?(0,Math.min)(t[0].length-2-u,u):Math.floor((t[0].length-2-r*2)/2),p=[{type:"switch",label:o("StyleSidePanel.loop.isLoop"),isChecked:i,onChange:f=>d(er(f)),minW:"full",oneLine:!0},{type:"switch",label:o("StyleSidePanel.loop.isBank"),isChecked:n,onChange:f=>d(tr(f)),minW:"full",oneLine:!0,hidden:!i},{type:"slider",label:o("StyleSidePanel.loop.leftRightFactor"),value:e,min:0,max:v,onChange:f=>d(nr(Math.floor(f))),hidden:!i},{type:"slider",label:o("StyleSidePanel.loop.bottomFactor"),value:r,min:0,max:Math.floor((t[0].length-2-e*2)/2),onChange:f=>d(rr(Math.floor(f))),hidden:!i||i&&t.length>2}];return _.jsxs(ke,{p:1,children:[_.jsx(ve,{as:"h5",size:"sm",children:o("StyleSidePanel.loop.title")}),_.jsx(be,{fields:p})]})}function vs(o){const{note:d,onUpdate:t,onDelete:i}=o,{t:s}=le(),n=[{type:"textarea",label:s("StyleSidePanel.note.zhNote"),value:d[0],onChange:r=>t==null?void 0:t([r,d[1],d[2],d[3],d[4]])},{type:"textarea",label:s("StyleSidePanel.note.enNote"),value:d[1],onChange:r=>t==null?void 0:t([d[0],r,d[2],d[3],d[4]])},{type:"switch",label:s("StyleSidePanel.note.border"),isChecked:d[4],onChange:r=>t==null?void 0:t([d[0],d[1],d[2],d[3],r]),oneLine:!0}],e=[{type:"slider",label:s("StyleSidePanel.note.positionX"),value:d[2],min:0,max:100,onChange:r=>t==null?void 0:t([d[0],d[1],r,d[3],d[4]]),leftIcon:_.jsx(nn,{}),rightIcon:_.jsx(rn,{})},{type:"slider",label:s("StyleSidePanel.note.positionY"),value:d[3],min:0,max:100,onChange:r=>t==null?void 0:t([d[0],d[1],d[2],r,d[4]]),leftIcon:_.jsx(St,{}),rightIcon:_.jsx(xt,{})}];return _.jsxs(Ne,{direction:"column",children:[_.jsx(be,{fields:n,minW:"full"}),_.jsxs(Oe,{spacing:.5,sx:{"&>div":{flex:1}},children:[_.jsx(be,{fields:e}),_.jsx(Te,{size:"sm",variant:"ghost","aria-label":s("StyleSidePanel.note.remove"),onClick:()=>i==null?void 0:i(),icon:_.jsx(Et,{})})]})]})}function Ss(){const{t:o}=le(),d=ue(),t=J(i=>i.param.notesGZMTR);return _.jsxs(ke,{p:1,children:[_.jsx(ve,{as:"h5",size:"sm",children:o("StyleSidePanel.note.title")}),_.jsxs(jt,{spacing:.5,children:[t==null?void 0:t.map((i,s)=>_.jsx(vs,{note:i,onUpdate:n=>d(sr({index:s,note:n})),onDelete:()=>d(ir(s))},s)),_.jsx(de,{size:"xs",variant:"ghost",leftIcon:_.jsx(ze,{}),alignSelf:"flex-end",onClick:()=>d(ar()),children:o("StyleSidePanel.note.add")})]})]})}function xs(){const{style:o}=J(d=>d.param);return _.jsxs(Ot,{children:[_.jsx(bs,{}),_.jsx(Ie,{}),_.jsx(_s,{}),o===ee.GZMTR&&_.jsxs(_.Fragment,{children:[_.jsx(Ie,{}),_.jsx(Ss,{})]}),o===ee.SHMetro&&_.jsxs(_.Fragment,{children:[_.jsx(Ie,{}),_.jsx(ys,{})]})]})}const zt=(o,d)=>{if(["linestart","lineend"].includes(o)||d[o].parents.length>1||d[o].children.length>1)return 0;const t=d[o].parents[0];return t?d[t].children.length===1?zt(t,d):d[t].children.indexOf(o)===0?1:-1:0},ws=o=>(d,t)=>{const{stn_list:i,current_stn_idx:s}=t().param;if(o===s)return console.log("removeStation():: failed as current station cannot be deleted"),!1;const{parents:n,children:e}=i[o];return Object.keys(i).length===4?(console.log("removeStation():: failed as only 2 stations remaining"),!1):n.length===2&&e.length===2?(console.log("removeStation():: failed as branches on both sides cannot be combined"),!1):Object.keys(i).some(l=>![o,"linestart","lineend"].includes(l)&&zt(l,i)===0)?!0:(console.log("removeStation():: failed as selected station is the only station without siblings"),!1)},ks=o=>(d,t)=>{var r,l;const i=t().param.stn_list,{parents:s,children:n}=i[o];let e=JSON.parse(JSON.stringify(i));s.length===2||n.length===2?(s.forEach(u=>{e[u].children=n}),n.forEach(u=>{e[u].parents=s}),s.length===1&&(e[s[0]].branch={...e[s[0]].branch,right:(r=e[o].branch)==null?void 0:r.right}),n.length===1&&(e[n[0]].branch={...e[n[0]].branch,left:(l=e[o].branch)==null?void 0:l.left})):i[s[0]].children.length===2&&i[n[0]].parents.length===2?e={...i,[s[0]]:{...i[s[0]],children:i[s[0]].children.filter(u=>u!==o),branch:{...i[s[0]].branch,right:void 0}},[n[0]]:{...i[n[0]],parents:i[n[0]].parents.filter(u=>u!==o),branch:{...i[n[0]].branch,left:void 0}}}:(s.forEach(u=>{var p,f,c,g;const v=e[u].children.indexOf(o);n.length?e[u].children[v]=n[0]:e[u].children.splice(v,1),((f=(p=e[u].branch)==null?void 0:p.right)==null?void 0:f[1])===o&&(e[u].branch={...e[u].branch,right:(g=(c=e[u].branch)==null?void 0:c.right)==null?void 0:g.with(1,n[0])})}),n.forEach(u=>{var p,f,c,g;const v=e[u].parents.indexOf(o);s.length?e[u].parents[v]=s[0]:e[u].parents.splice(v,1),((f=(p=e[u].branch)==null?void 0:p.left)==null?void 0:f[1])===o&&(e[u].branch={...e[u].branch,left:(g=(c=e[u].branch)==null?void 0:c.left)==null?void 0:g.with(1,s[0])})})),delete e[o],d(we(e))};function Cs(...o){return o.reduce((d,t)=>d.map(i=>t.map(s=>i.concat([s]))).reduce((i,s)=>i.concat(s),[]),[[]])}const Fe=(o,d)=>!!d[o[0]].children.indexOf(o[1]),dn=(o,d)=>[o[0][1],o[0][o[0].length-2],...o[0].filter(t=>o.slice(1).filter(i=>Fe(i,d)).map(i=>i.filter(s=>!["linestart","lineend"].includes(s))).map(i=>[i[0],i[i.length-1]]).flat().includes(t))],js=(o,d)=>o.slice(1).filter(t=>Fe(t,d)).map(t=>t.filter(i=>!["linestart","lineend"].includes(i))).map(t=>[t[0],t[t.length-1]]),As=o=>(d,t)=>{const i=t().helper.branches;if(o===0){const s=t().param.stn_list,n=dn(i,s);return Cs(n,n).filter(e=>e[0]!==e[1])}else{const s=i[o];if(s){const n=s.filter(e=>!["linestart","lineend"].includes(e));return[[n[0],n.slice(-1)[0]]]}else return[]}},Ei=(o,d)=>(t,i)=>{const s=i().param.coline,n=i().helper.branches[d];for(const[e,r]of Object.entries(s))if(r.from===o&&n.includes(r.to)){const l=n.indexOf(o),u=n.indexOf(r.to);if(u>l)return[u-l+1,e]}else if(r.to===o&&n.includes(r.to)){const l=n.indexOf(o),u=n.indexOf(r.from);if(u>l)return[u-l+1,e]}return[0,void 0]},hn=(o,d)=>(t,i)=>{const s=i().param.stn_list,n=i().helper.branches;if(o===d)throw new Error("addColine():: failed for same stnId");const e=dn(n,s).filter(l=>[o,d].includes(l)),r=js(n,s).filter(l=>[o,d].every(u=>l.includes(u)));if(e.length===2&&r.length>0)throw new Error("addColine():: main check failed for ".concat(o,", ").concat(d));if(e.length!==2&&r.length!==1)throw new Error("addColine():: branch check failed for ".concat(o,", ").concat(d))},Es=o=>(d,t)=>{const i=t().param.coline,n=t().helper.branches[o];return n?Object.entries(i).reduce((e,r)=>n.includes(r[1].from)&&n.includes(r[1].to)?{...e,[r[0]]:r[1]}:{...e},{}):{}},Os=o=>(d,t)=>{const i=t().param.coline;if(Object.keys(i).length===0)return;const s=Object.entries(i).reduce((n,e)=>e[1].from!==o&&e[1].to!==o?{...n,[e[0]]:e[1]}:{...n},{});d(Me(s))},Rs=(o,d,t,i=!0)=>(s,n)=>{const e=n().param.coline;s(hn(o,d)),s(Me({...e,[$e(4)]:{from:o,to:d,colors:t,display:i}}))},Ps=(o,d,t,i=!0)=>(s,n)=>{const e=n().param.coline;if(o in e){s(hn(d,t));const r={...e,[o]:{...e[o],from:d,to:t,display:i}};s(Me(r))}},zs=(o,d)=>(t,i)=>{const s=i().param.coline;if(o in s&&s[o].colors.length>d){const n=s[o].colors.filter((e,r)=>r!==d);if(n.length===0){const{[o]:e,...r}=s;t(Me(r))}else{const e={...s,[o]:{...s[o],colors:n}};t(Me(e))}}},Ts=(o,d,t)=>(i,s)=>{const n=s().param.coline;if(o in n&&n[o].colors.length>d){const e={...n,[o]:{...n[o],colors:n[o].colors.map((r,l)=>l===d?[0,1,2,3,4,5].map(u=>t[u]===void 0?r[u]:t[u]):r)}};i(Me(e))}};function Bs(o){const{isOpen:d,onClose:t}=o,{t:i}=le(),s=ue(),n=J(u=>u.app.selectedStation),[e,r]=X.useState(!1);X.useEffect(()=>{d||r(!1)},[d]);const l=()=>{const u=s(ws(n));u?(t(),s(Le(De.CLOSE)),s(sn("linestart")),s(Os(n)),s(ks(n))):r(!0),ce.event(Se.REMOVE_STATION,{success:u})};return _.jsxs(Ye,{isOpen:d,onClose:t,children:[_.jsx(qe,{}),_.jsxs(Ke,{children:[e&&_.jsxs(dt,{status:"error",variant:"solid",size:"xs",children:[_.jsx(ht,{}),i("Unable to remove this station.")]}),_.jsxs(ke,{position:"relative",children:[_.jsx(Xe,{children:i("Remove station")}),_.jsx(Je,{})]}),_.jsx(Qe,{children:i("Are you sure to remove station? You cannot undo this action.")}),_.jsxs(et,{children:[_.jsx(de,{onClick:t,children:i("Cancel")}),_.jsx(de,{colorScheme:"primary",onClick:l,ml:3,children:i("Confirm")})]})]})]})}function Is(){const{t:o}=le(),d=ue(),t=J(n=>n.app.selectedStation),[i,s]=X.useState(!1);return _.jsxs(or,{children:[_.jsxs(Oe,{children:[_.jsx(de,{size:"sm",variant:"outline",onClick:()=>d(wt(t)),children:o("StationSidePanel.footer.current")}),_.jsx(de,{size:"sm",variant:"outline",onClick:()=>s(!0),children:o("StationSidePanel.footer.remove")})]}),_.jsx(Bs,{isOpen:i,onClose:()=>s(!1)})]})}function Ns(o){const{colineInfo:d,routeOptions:t,onUpdateRoute:i,onUpdateColourInfo:s,onDelete:n}=o,{t:e}=le(),r=ue(),{paletteAppClipOutput:l}=J(c=>c.app),[u,v]=X.useState(!1);X.useEffect(()=>{u&&l&&(s==null||s([...l,d.colors[0][4],d.colors[0][5]]),v(!1))},[l==null?void 0:l.toString()]);const p=[{type:"select",label:"Route",value:[d.from,d.to].join(","),options:t,onChange:c=>i==null?void 0:i(c)}],f=[{type:"custom",label:e("Colour"),component:_.jsx(Pt,{theme:[d.colors[0][0],d.colors[0][1],d.colors[0][2],d.colors[0][3]],onClick:()=>{v(!0),r(At(d.colors[0].slice(0,4)))}})},{type:"input",label:e("Chinese name"),value:d.colors[0][4],minW:120,onChange:c=>s==null?void 0:s([d.colors[0][0],d.colors[0][1],d.colors[0][2],d.colors[0][3],c,d.colors[0][5]])},{type:"input",label:e("English name"),value:d.colors[0][5],minW:120,onChange:c=>s==null?void 0:s([d.colors[0][0],d.colors[0][1],d.colors[0][2],d.colors[0][3],d.colors[0][4],c])}];return _.jsxs(Ne,{direction:"column",children:[_.jsx(be,{fields:p,minW:"full"}),_.jsxs(Oe,{spacing:.5,children:[_.jsx(be,{fields:f}),_.jsx(Te,{size:"sm",variant:"ghost","aria-label":"Delete colour for route",onClick:()=>n==null?void 0:n(0),icon:_.jsx(Et,{})})]})]})}function Ds(){const{t:o}=le(),d=ue(),t=J(f=>f.app.selectedBranch),{theme:i,stn_list:s}=J(f=>f.param),n=d(Es(t)),e=d(As(t)),r=f=>f.map(c=>s[c].name.join(" - ")).join(" ~ "),l=e.reduce((f,c)=>({...f,[c.join(",")]:r(c)}),{}),u=()=>{console.log("ColineSection.handleAddTrackSharing():: Adding track sharing to branch ".concat(t," with default combination"),e[0]),d(Rs(e[0][0],e[0][1],[[i[0],"","#AAAAAA",ot.white,"",""]]))},v=f=>c=>{const[g,m]=c.split(",");console.log("ColineSection.handleUpdateRoute():: Updating route, colineId=".concat(f,", from=").concat(g,", to=").concat(m));try{d(Ps(f,g,m))}catch(y){d(kt({status:"error",message:"Unable to draw this share track."}))}},p=(f,c)=>{d(zs(f,c))};return _.jsxs(jt,{align:"flex-start",p:1,children:[_.jsx(ve,{as:"h5",size:"sm",children:o("BranchSidePanel.coline.title")}),Object.entries(n).map(([f,c])=>_.jsx(Ns,{colineInfo:c,routeOptions:l,onUpdateRoute:v(f),onUpdateColourInfo:g=>d(Ts(f,0,g)),onDelete:g=>p(f,g)},f)),(t===0||Object.keys(n).length===0)&&_.jsx(de,{size:"xs",variant:"ghost",alignSelf:"flex-end",leftIcon:_.jsx(ze,{}),onClick:u,children:o("BranchSidePanel.coline.add")})]})}function Ms(o){const{isOpen:d,onClose:t}=o,{t:i}=le(),s=ue(),n=J(j=>j.app.selectedBranch),{style:e,stn_list:r}=J(j=>j.param),l=J(j=>j.helper.branches),[u,v]=X.useState(n),[p,f]=X.useState("1"),[c,g]=X.useState("2"),[m,y]=X.useState("asc");X.useEffect(()=>{v(n)},[n]);const b=[{type:"select",label:i("AutoNumModal.where"),value:u,options:{...l.reduce((j,A,N)=>({...j,[N]:N===0?i("AutoNumModal.main"):e!==ee.SHMetro||!Fe(A,r)?i("AutoNumModal.branch")+" "+N:i("AutoNumModal.external")+" "+N}),{})},onChange:j=>v(j)},{type:"input",label:i("AutoNumModal.from"),value:p,validator:j=>!isNaN(Number(j)),onChange:f,debouncedDelay:0},{type:"input",label:i("AutoNumModal.maxLength"),validator:j=>!isNaN(Number(j)),value:c,onChange:g,debouncedDelay:0},{type:"select",label:i("AutoNumModal.sort"),value:m,options:{asc:i("AutoNumModal.asc"),desc:i("AutoNumModal.desc")},onChange:j=>y(j)}],x=()=>{s(cs(u,Number(p),Number(c),m)),t(),ce.event(Se.AUTO_NUMBERING,{})},C=!p||!c||isNaN(Number(p))||isNaN(Number(c));return _.jsxs(Ye,{isOpen:d,onClose:t,children:[_.jsx(qe,{}),_.jsxs(Ke,{children:[_.jsx(Xe,{children:i("AutoNumModal.title")}),_.jsx(Je,{}),_.jsx(Qe,{children:_.jsx(be,{fields:b})}),_.jsx(et,{children:_.jsx(de,{colorScheme:"primary",isDisabled:C,onClick:x,children:i("Confirm")})})]})]})}const Tt=o=>(d,t)=>{const s=t().helper.branches[o];return s.includes("linestart")||s.includes("lineend")?1:2},un=o=>(d,t)=>{const{branches:i}=t().helper,s=i[0],n=i[o];return s.slice(s.indexOf(n[0])+1,s.indexOf(n.slice(-1)[0]))},Ls=(o,d)=>t=>t(Tt(d))===2?(console.log("isStationValid2ConnectBranch():: failed as current branch has 2 connected ends"),!1):t(un(d)).includes(o)?!0:(console.log("isStationValid2ConnectBranch():: failed as the target station is invalid"),!1),Fs=(o,d)=>(t,i)=>{var l,u;if(!t(Ls(o,d)))return!1;const{branches:n}=i().helper,e=i().param.stn_list,r=n[d];if(r[0]==="linestart"){const v={...e,[r[1]]:{...e[r[1]],parents:[o]},[o]:{...e[o],children:e.linestart.children.map(p=>p===r[1]?p:e[o].children[0]),branch:{right:(l=e.linestart.branch)==null?void 0:l.right}},linestart:{...e.linestart,children:e.linestart.children.filter(p=>p!==r[1]),branch:{}}};return t(we(v)),!0}else{const v=r.slice(-2)[0],p={...e,[v]:{...e[v],children:[o]},[o]:{...e[o],parents:e.lineend.parents.map(f=>f===v?f:e[o].parents[0]),branch:{left:(u=e.lineend.branch)==null?void 0:u.left}},lineend:{...e.lineend,parents:e.lineend.parents.filter(f=>f!==v),branch:{}}};return t(we(p)),!0}},fn=o=>(d,t)=>{const{branches:i}=t().helper,s=t().param.stn_list,n=i[0],e=i[o];if(d(Tt(o))!==2)return console.log("getPossibleDirection():: failed as there is no possible direction"),[];const l=n.indexOf(e[0]),u=n.slice(0,l),v=n.indexOf(e.slice(-1)[0]),p=n.slice(v+1),f=u.every(g=>s[g].children.length<=1&&s[g].parents.length<=1),c=p.every(g=>s[g].children.length<=1&&s[g].parents.length<=1);return f?c?[ye.left,ye.right]:[ye.left]:c?[ye.right]:[]},Us=(o,d)=>(t,i)=>{var u,v;if(!t(fn(d)).includes(o))return console.log("disconnectFromMainLine():: failed as the aim direction is not in the possible direction list"),!1;const{branches:n}=i().helper,e=i().param.stn_list,r=n[0],l=n[d];if(o===ye.left){const p=l[0],f={...e,[l[1]]:{...e[l[1]],parents:["linestart"]},[p]:{...e[p],children:e[p].children.filter(c=>c!==l[1]),branch:{}},linestart:{...e.linestart,children:e[p].children.map(c=>c===l[1]?c:r[1]),branch:{right:(u=e[p].branch)==null?void 0:u.right}}};return t(we(f)),!0}else{const p=l.slice(-1)[0],f=l.slice(-2)[0],c={...e,[f]:{...e[f],children:["lineend"]},[p]:{...e[p],parents:e[p].parents.filter(g=>g!==f),branch:{}},lineend:{...e.lineend,parents:e[p].parents.map(g=>g===f?g:r.slice(-2)[0]),branch:{left:(v=e[p].branch)==null?void 0:v.left}}};return t(we(c)),!0}};function Kt(o){const{direction:d}=o,{t}=le(),i=ue(),{branches:s}=J(O=>O.helper),n=J(O=>O.app.selectedBranch),{style:e,stn_list:r}=J(O=>O.param),[l,u]=X.useState(!1),[v,p]=X.useState(""),f=s[n].filter(O=>!["linestart","lineend"].includes(O)),c=d===ye.left?f[0]:f.slice(-1)[0],g=r[c],m=i(un(n)),y=i(Tt(n)),b=i(fn(n)),x=y===1&&!s[0].includes(c),C=b.includes(d),j=m.reduce((O,D)=>{var R;return{...O,[D]:(R=r[D])==null?void 0:R.name.join(" - ")}},{"":t("Please select...")}),A=()=>{const O=i(Fs(v,n));O?u(!1):i(kt({status:"error",message:t("Unable to connect to main line.")})),ce.event(Se.CONNECT_BRANCH,{style:e,success:O})},N=()=>{const O=i(Us(d,n));O||i(kt({status:"error",message:t("Unable to disconnect from main line.")})),ce.event(Se.DISCONNECT_BRANCH,{style:e,success:O})};return _.jsxs(Ne,{direction:"column",children:[_.jsxs(Pe,{alignItems:"center",children:[_.jsx(vt,{label:t("Station name"),flex:1,children:_.jsx(lr,{defaultValue:g.name.join(" "),isDisabled:!0})}),l?_.jsx(de,{mx:1,size:"sm",variant:"outline",onClick:()=>u(!1),children:t("Cancel")}):x?_.jsx(de,{mx:1,size:"sm",variant:"solid",colorScheme:"primary",onClick:()=>u(!0),children:t("Connect to main line")}):_.jsx(de,{mx:1,size:"sm",variant:"solid",colorScheme:"primary",onClick:N,isDisabled:!C,children:t("Disconnect from main line")})]}),l&&_.jsxs(Pe,{alignItems:"center",children:[_.jsx(vt,{label:t("Target station"),flex:1,children:_.jsx(cr,{defaultValue:v,options:j,disabledOptions:[""],onChange:({target:{value:O}})=>p(O)})}),_.jsx(de,{mx:1,size:"sm",variant:"solid",colorScheme:"primary",onClick:A,isDisabled:!v,children:t("Confirm")})]})]})}function Ws(){const{t:o}=le(),d=ue(),t=J(r=>r.param.style),i=J(r=>r.app.selectedBranch),[s,n]=X.useState(!1),e=()=>{d(Yr(t===ee.SHMetro)),ce.event(Se.REVERSE_STATIONS,{style:t})};return _.jsxs(ke,{p:1,children:[_.jsx(ve,{as:"h5",size:"sm",children:o("BranchSidePanel.action.title")}),_.jsxs(Pe,{wrap:"wrap",sx:{p:1,"&> *":{flexShrink:0,flexBasis:"100%","&:not(:first-of-type)":{marginTop:2}}},children:[i!==0&&t!==ee.SHMetro&&_.jsxs(_.Fragment,{children:[_.jsx(ve,{as:"h6",size:"xs",children:o("Branch left end")}),_.jsx(Kt,{direction:ye.left}),_.jsx(ve,{as:"h6",size:"xs",children:o("Branch right end")}),_.jsx(Kt,{direction:ye.right})]}),t===ee.GZMTR&&_.jsx(de,{size:"sm",variant:"outline",leftIcon:_.jsx(dr,{}),alignSelf:"flex-end",onClick:()=>n(!0),children:o("BranchSidePanel.action.autoNum")}),_.jsx(de,{size:"sm",variant:"outline",leftIcon:_.jsx(hr,{}),alignSelf:"flex-end",onClick:e,children:t===ee.SHMetro?o("BranchSidePanel.action.flip"):o("BranchSidePanel.action.reverse")})]}),_.jsx(Ms,{isOpen:s,onClose:()=>n(!1)})]})}function Zs(){const o=J(s=>s.app.selectedBranch),{style:d,stn_list:t}=J(s=>s.param),i=J(s=>s.helper.branches);return _.jsxs(Ot,{children:[d===ee.SHMetro&&(o===0||Fe(i[o],t))&&_.jsxs(_.Fragment,{children:[_.jsx(Ds,{}),_.jsx(Ie,{})]}),_.jsx(Ws,{})]})}const Hs="rmg-palette-bridge--",Gs={position:"relative",h:460,maxH:"70%","& > button":{position:"absolute",right:1,top:1},"& iframe":{h:"100%",w:"100%"}};function Vs(o){const{isOpen:d,onClose:t,defaultTheme:i,onSelect:s}=o,[n]=X.useState($e()),[e,r]=X.useState(!1),l="/rmg-palette/#/picker?"+new URLSearchParams({parentComponent:ce.getAppName(),parentId:n}),u=X.useRef();return X.useEffect(()=>{const v=new BroadcastChannel(Hs+n);return u.current=v,v.onmessage=p=>{const{event:f,data:c}=p.data;console.log("[rmg] Received event from Palette app clip:",f),f==="CLOSE"?t():f==="SELECT"?s(c):f==="LOADED"&&r(!0)},()=>{v.close()}},[]),X.useEffect(()=>{var v;i&&((v=u.current)==null||v.postMessage({event:"OPEN",data:i}))},[e,i==null?void 0:i.toString()]),_.jsxs(an,{size:"md",isOpen:d,onClose:t,sx:Gs,children:[_.jsx(Jt,{onClick:t}),_.jsx("iframe",{src:l,loading:"eager"})]})}const $s=410;function Ys(){var l,u;const{t:o}=le(),d=on(),{sidePanelMode:t,selectedStation:i,paletteAppClipInput:s}=J(v=>v.app),n=J(v=>{var p;return(p=v.param.stn_list[i])==null?void 0:p.name}),e={STATION:{header:_.jsx(Zr,{text:(n==null?void 0:n.join(" - "))||""}),body:_.jsx(gs,{}),footer:_.jsx(Is,{})},STYLE:{header:o("StyleSidePanel.header"),body:_.jsx(xs,{})},BRANCH:{header:o("BranchSidePanel.header"),body:_.jsx(Zs,{})},CLOSE:{header:"Close"}},r=()=>{d(Le(De.CLOSE))};return _.jsxs(ur,{isOpen:t!==De.CLOSE,width:$s,header:"Dummy header",children:[_.jsx(fr,{onClose:r,children:e[t].header}),(l=e[t])==null?void 0:l.body,(u=e[t])==null?void 0:u.footer,_.jsx(Vs,{isOpen:!!s,onClose:()=>d(pr()),defaultTheme:s,onSelect:v=>d(mr(v))})]})}function st(o){throw new Error('Could not dynamically require "'+o+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var pn={exports:{}};/*!

JSZip v3.10.1 - A JavaScript class for generating and reading zip files
<http://stuartk.com/jszip>

(c) 2009-2016 Stuart Knightley <stuart [at] stuartk.com>
Dual licenced under the MIT license or GPLv3. See https://raw.github.com/Stuk/jszip/main/LICENSE.markdown.

JSZip uses the library pako released under the MIT license :
https://github.com/nodeca/pako/blob/main/LICENSE
*/(function(o,d){(function(t){o.exports=t()})(function(){return function t(i,s,n){function e(u,v){if(!s[u]){if(!i[u]){var p=typeof st=="function"&&st;if(!v&&p)return p(u,!0);if(r)return r(u,!0);var f=new Error("Cannot find module '"+u+"'");throw f.code="MODULE_NOT_FOUND",f}var c=s[u]={exports:{}};i[u][0].call(c.exports,function(g){var m=i[u][1][g];return e(m||g)},c,c.exports,t,i,s,n)}return s[u].exports}for(var r=typeof st=="function"&&st,l=0;l<n.length;l++)e(n[l]);return e}({1:[function(t,i,s){var n=t("./utils"),e=t("./support"),r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";s.encode=function(l){for(var u,v,p,f,c,g,m,y=[],b=0,x=l.length,C=x,j=n.getTypeOf(l)!=="string";b<l.length;)C=x-b,p=j?(u=l[b++],v=b<x?l[b++]:0,b<x?l[b++]:0):(u=l.charCodeAt(b++),v=b<x?l.charCodeAt(b++):0,b<x?l.charCodeAt(b++):0),f=u>>2,c=(3&u)<<4|v>>4,g=1<C?(15&v)<<2|p>>6:64,m=2<C?63&p:64,y.push(r.charAt(f)+r.charAt(c)+r.charAt(g)+r.charAt(m));return y.join("")},s.decode=function(l){var u,v,p,f,c,g,m=0,y=0,b="data:";if(l.substr(0,b.length)===b)throw new Error("Invalid base64 input, it looks like a data url.");var x,C=3*(l=l.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(l.charAt(l.length-1)===r.charAt(64)&&C--,l.charAt(l.length-2)===r.charAt(64)&&C--,C%1!=0)throw new Error("Invalid base64 input, bad content length.");for(x=e.uint8array?new Uint8Array(0|C):new Array(0|C);m<l.length;)u=r.indexOf(l.charAt(m++))<<2|(f=r.indexOf(l.charAt(m++)))>>4,v=(15&f)<<4|(c=r.indexOf(l.charAt(m++)))>>2,p=(3&c)<<6|(g=r.indexOf(l.charAt(m++))),x[y++]=u,c!==64&&(x[y++]=v),g!==64&&(x[y++]=p);return x}},{"./support":30,"./utils":32}],2:[function(t,i,s){var n=t("./external"),e=t("./stream/DataWorker"),r=t("./stream/Crc32Probe"),l=t("./stream/DataLengthProbe");function u(v,p,f,c,g){this.compressedSize=v,this.uncompressedSize=p,this.crc32=f,this.compression=c,this.compressedContent=g}u.prototype={getContentWorker:function(){var v=new e(n.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new l("data_length")),p=this;return v.on("end",function(){if(this.streamInfo.data_length!==p.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),v},getCompressedWorker:function(){return new e(n.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},u.createWorkerFrom=function(v,p,f){return v.pipe(new r).pipe(new l("uncompressedSize")).pipe(p.compressWorker(f)).pipe(new l("compressedSize")).withStreamInfo("compression",p)},i.exports=u},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(t,i,s){var n=t("./stream/GenericWorker");s.STORE={magic:"\0\0",compressWorker:function(){return new n("STORE compression")},uncompressWorker:function(){return new n("STORE decompression")}},s.DEFLATE=t("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(t,i,s){var n=t("./utils"),e=function(){for(var r,l=[],u=0;u<256;u++){r=u;for(var v=0;v<8;v++)r=1&r?3988292384^r>>>1:r>>>1;l[u]=r}return l}();i.exports=function(r,l){return r!==void 0&&r.length?n.getTypeOf(r)!=="string"?function(u,v,p,f){var c=e,g=f+p;u^=-1;for(var m=f;m<g;m++)u=u>>>8^c[255&(u^v[m])];return-1^u}(0|l,r,r.length,0):function(u,v,p,f){var c=e,g=f+p;u^=-1;for(var m=f;m<g;m++)u=u>>>8^c[255&(u^v.charCodeAt(m))];return-1^u}(0|l,r,r.length,0):0}},{"./utils":32}],5:[function(t,i,s){s.base64=!1,s.binary=!1,s.dir=!1,s.createFolders=!0,s.date=null,s.compression=null,s.compressionOptions=null,s.comment=null,s.unixPermissions=null,s.dosPermissions=null},{}],6:[function(t,i,s){var n=null;n=typeof Promise<"u"?Promise:t("lie"),i.exports={Promise:n}},{lie:37}],7:[function(t,i,s){var n=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Uint32Array<"u",e=t("pako"),r=t("./utils"),l=t("./stream/GenericWorker"),u=n?"uint8array":"array";function v(p,f){l.call(this,"FlateWorker/"+p),this._pako=null,this._pakoAction=p,this._pakoOptions=f,this.meta={}}s.magic="\b\0",r.inherits(v,l),v.prototype.processChunk=function(p){this.meta=p.meta,this._pako===null&&this._createPako(),this._pako.push(r.transformTo(u,p.data),!1)},v.prototype.flush=function(){l.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)},v.prototype.cleanUp=function(){l.prototype.cleanUp.call(this),this._pako=null},v.prototype._createPako=function(){this._pako=new e[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var p=this;this._pako.onData=function(f){p.push({data:f,meta:p.meta})}},s.compressWorker=function(p){return new v("Deflate",p)},s.uncompressWorker=function(){return new v("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(t,i,s){function n(c,g){var m,y="";for(m=0;m<g;m++)y+=String.fromCharCode(255&c),c>>>=8;return y}function e(c,g,m,y,b,x){var C,j,A=c.file,N=c.compression,O=x!==u.utf8encode,D=r.transformTo("string",x(A.name)),R=r.transformTo("string",u.utf8encode(A.name)),F=A.comment,G=r.transformTo("string",x(F)),w=r.transformTo("string",u.utf8encode(F)),T=R.length!==A.name.length,h=w.length!==F.length,M="",ne="",Z="",se=A.dir,H=A.date,re={crc32:0,compressedSize:0,uncompressedSize:0};g&&!m||(re.crc32=c.crc32,re.compressedSize=c.compressedSize,re.uncompressedSize=c.uncompressedSize);var B=0;g&&(B|=8),O||!T&&!h||(B|=2048);var z=0,te=0;se&&(z|=16),b==="UNIX"?(te=798,z|=function(Y,fe){var _e=Y;return Y||(_e=fe?16893:33204),(65535&_e)<<16}(A.unixPermissions,se)):(te=20,z|=function(Y){return 63&(Y||0)}(A.dosPermissions)),C=H.getUTCHours(),C<<=6,C|=H.getUTCMinutes(),C<<=5,C|=H.getUTCSeconds()/2,j=H.getUTCFullYear()-1980,j<<=4,j|=H.getUTCMonth()+1,j<<=5,j|=H.getUTCDate(),T&&(ne=n(1,1)+n(v(D),4)+R,M+="up"+n(ne.length,2)+ne),h&&(Z=n(1,1)+n(v(G),4)+w,M+="uc"+n(Z.length,2)+Z);var q="";return q+="\n\0",q+=n(B,2),q+=N.magic,q+=n(C,2),q+=n(j,2),q+=n(re.crc32,4),q+=n(re.compressedSize,4),q+=n(re.uncompressedSize,4),q+=n(D.length,2),q+=n(M.length,2),{fileRecord:p.LOCAL_FILE_HEADER+q+D+M,dirRecord:p.CENTRAL_FILE_HEADER+n(te,2)+q+n(G.length,2)+"\0\0\0\0"+n(z,4)+n(y,4)+D+M+G}}var r=t("../utils"),l=t("../stream/GenericWorker"),u=t("../utf8"),v=t("../crc32"),p=t("../signature");function f(c,g,m,y){l.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=g,this.zipPlatform=m,this.encodeFileName=y,this.streamFiles=c,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}r.inherits(f,l),f.prototype.push=function(c){var g=c.meta.percent||0,m=this.entriesCount,y=this._sources.length;this.accumulate?this.contentBuffer.push(c):(this.bytesWritten+=c.data.length,l.prototype.push.call(this,{data:c.data,meta:{currentFile:this.currentFile,percent:m?(g+100*(m-y-1))/m:100}}))},f.prototype.openedSource=function(c){this.currentSourceOffset=this.bytesWritten,this.currentFile=c.file.name;var g=this.streamFiles&&!c.file.dir;if(g){var m=e(c,g,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:m.fileRecord,meta:{percent:0}})}else this.accumulate=!0},f.prototype.closedSource=function(c){this.accumulate=!1;var g=this.streamFiles&&!c.file.dir,m=e(c,g,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(m.dirRecord),g)this.push({data:function(y){return p.DATA_DESCRIPTOR+n(y.crc32,4)+n(y.compressedSize,4)+n(y.uncompressedSize,4)}(c),meta:{percent:100}});else for(this.push({data:m.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},f.prototype.flush=function(){for(var c=this.bytesWritten,g=0;g<this.dirRecords.length;g++)this.push({data:this.dirRecords[g],meta:{percent:100}});var m=this.bytesWritten-c,y=function(b,x,C,j,A){var N=r.transformTo("string",A(j));return p.CENTRAL_DIRECTORY_END+"\0\0\0\0"+n(b,2)+n(b,2)+n(x,4)+n(C,4)+n(N.length,2)+N}(this.dirRecords.length,m,c,this.zipComment,this.encodeFileName);this.push({data:y,meta:{percent:100}})},f.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},f.prototype.registerPrevious=function(c){this._sources.push(c);var g=this;return c.on("data",function(m){g.processChunk(m)}),c.on("end",function(){g.closedSource(g.previous.streamInfo),g._sources.length?g.prepareNextSource():g.end()}),c.on("error",function(m){g.error(m)}),this},f.prototype.resume=function(){return!!l.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},f.prototype.error=function(c){var g=this._sources;if(!l.prototype.error.call(this,c))return!1;for(var m=0;m<g.length;m++)try{g[m].error(c)}catch(y){}return!0},f.prototype.lock=function(){l.prototype.lock.call(this);for(var c=this._sources,g=0;g<c.length;g++)c[g].lock()},i.exports=f},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(t,i,s){var n=t("../compressions"),e=t("./ZipFileWorker");s.generateWorker=function(r,l,u){var v=new e(l.streamFiles,u,l.platform,l.encodeFileName),p=0;try{r.forEach(function(f,c){p++;var g=function(x,C){var j=x||C,A=n[j];if(!A)throw new Error(j+" is not a valid compression method !");return A}(c.options.compression,l.compression),m=c.options.compressionOptions||l.compressionOptions||{},y=c.dir,b=c.date;c._compressWorker(g,m).withStreamInfo("file",{name:f,dir:y,date:b,comment:c.comment||"",unixPermissions:c.unixPermissions,dosPermissions:c.dosPermissions}).pipe(v)}),v.entriesCount=p}catch(f){v.error(f)}return v}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(t,i,s){function n(){if(!(this instanceof n))return new n;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var e=new n;for(var r in this)typeof this[r]!="function"&&(e[r]=this[r]);return e}}(n.prototype=t("./object")).loadAsync=t("./load"),n.support=t("./support"),n.defaults=t("./defaults"),n.version="3.10.1",n.loadAsync=function(e,r){return new n().loadAsync(e,r)},n.external=t("./external"),i.exports=n},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(t,i,s){var n=t("./utils"),e=t("./external"),r=t("./utf8"),l=t("./zipEntries"),u=t("./stream/Crc32Probe"),v=t("./nodejsUtils");function p(f){return new e.Promise(function(c,g){var m=f.decompressed.getContentWorker().pipe(new u);m.on("error",function(y){g(y)}).on("end",function(){m.streamInfo.crc32!==f.decompressed.crc32?g(new Error("Corrupted zip : CRC32 mismatch")):c()}).resume()})}i.exports=function(f,c){var g=this;return c=n.extend(c||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:r.utf8decode}),v.isNode&&v.isStream(f)?e.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):n.prepareContent("the loaded zip file",f,!0,c.optimizedBinaryString,c.base64).then(function(m){var y=new l(c);return y.load(m),y}).then(function(m){var y=[e.Promise.resolve(m)],b=m.files;if(c.checkCRC32)for(var x=0;x<b.length;x++)y.push(p(b[x]));return e.Promise.all(y)}).then(function(m){for(var y=m.shift(),b=y.files,x=0;x<b.length;x++){var C=b[x],j=C.fileNameStr,A=n.resolve(C.fileNameStr);g.file(A,C.decompressed,{binary:!0,optimizedBinaryString:!0,date:C.date,dir:C.dir,comment:C.fileCommentStr.length?C.fileCommentStr:null,unixPermissions:C.unixPermissions,dosPermissions:C.dosPermissions,createFolders:c.createFolders}),C.dir||(g.file(A).unsafeOriginalName=j)}return y.zipComment.length&&(g.comment=y.zipComment),g})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(t,i,s){var n=t("../utils"),e=t("../stream/GenericWorker");function r(l,u){e.call(this,"Nodejs stream input adapter for "+l),this._upstreamEnded=!1,this._bindStream(u)}n.inherits(r,e),r.prototype._bindStream=function(l){var u=this;(this._stream=l).pause(),l.on("data",function(v){u.push({data:v,meta:{percent:0}})}).on("error",function(v){u.isPaused?this.generatedError=v:u.error(v)}).on("end",function(){u.isPaused?u._upstreamEnded=!0:u.end()})},r.prototype.pause=function(){return!!e.prototype.pause.call(this)&&(this._stream.pause(),!0)},r.prototype.resume=function(){return!!e.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},i.exports=r},{"../stream/GenericWorker":28,"../utils":32}],13:[function(t,i,s){var n=t("readable-stream").Readable;function e(r,l,u){n.call(this,l),this._helper=r;var v=this;r.on("data",function(p,f){v.push(p)||v._helper.pause(),u&&u(f)}).on("error",function(p){v.emit("error",p)}).on("end",function(){v.push(null)})}t("../utils").inherits(e,n),e.prototype._read=function(){this._helper.resume()},i.exports=e},{"../utils":32,"readable-stream":16}],14:[function(t,i,s){i.exports={isNode:typeof Buffer<"u",newBufferFrom:function(n,e){if(Buffer.from&&Buffer.from!==Uint8Array.from)return Buffer.from(n,e);if(typeof n=="number")throw new Error('The "data" argument must not be a number');return new Buffer(n,e)},allocBuffer:function(n){if(Buffer.alloc)return Buffer.alloc(n);var e=new Buffer(n);return e.fill(0),e},isBuffer:function(n){return Buffer.isBuffer(n)},isStream:function(n){return n&&typeof n.on=="function"&&typeof n.pause=="function"&&typeof n.resume=="function"}}},{}],15:[function(t,i,s){function n(A,N,O){var D,R=r.getTypeOf(N),F=r.extend(O||{},v);F.date=F.date||new Date,F.compression!==null&&(F.compression=F.compression.toUpperCase()),typeof F.unixPermissions=="string"&&(F.unixPermissions=parseInt(F.unixPermissions,8)),F.unixPermissions&&16384&F.unixPermissions&&(F.dir=!0),F.dosPermissions&&16&F.dosPermissions&&(F.dir=!0),F.dir&&(A=b(A)),F.createFolders&&(D=y(A))&&x.call(this,D,!0);var G=R==="string"&&F.binary===!1&&F.base64===!1;O&&O.binary!==void 0||(F.binary=!G),(N instanceof p&&N.uncompressedSize===0||F.dir||!N||N.length===0)&&(F.base64=!1,F.binary=!0,N="",F.compression="STORE",R="string");var w=null;w=N instanceof p||N instanceof l?N:g.isNode&&g.isStream(N)?new m(A,N):r.prepareContent(A,N,F.binary,F.optimizedBinaryString,F.base64);var T=new f(A,w,F);this.files[A]=T}var e=t("./utf8"),r=t("./utils"),l=t("./stream/GenericWorker"),u=t("./stream/StreamHelper"),v=t("./defaults"),p=t("./compressedObject"),f=t("./zipObject"),c=t("./generate"),g=t("./nodejsUtils"),m=t("./nodejs/NodejsStreamInputAdapter"),y=function(A){A.slice(-1)==="/"&&(A=A.substring(0,A.length-1));var N=A.lastIndexOf("/");return 0<N?A.substring(0,N):""},b=function(A){return A.slice(-1)!=="/"&&(A+="/"),A},x=function(A,N){return N=N!==void 0?N:v.createFolders,A=b(A),this.files[A]||n.call(this,A,null,{dir:!0,createFolders:N}),this.files[A]};function C(A){return Object.prototype.toString.call(A)==="[object RegExp]"}var j={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(A){var N,O,D;for(N in this.files)D=this.files[N],(O=N.slice(this.root.length,N.length))&&N.slice(0,this.root.length)===this.root&&A(O,D)},filter:function(A){var N=[];return this.forEach(function(O,D){A(O,D)&&N.push(D)}),N},file:function(A,N,O){if(arguments.length!==1)return A=this.root+A,n.call(this,A,N,O),this;if(C(A)){var D=A;return this.filter(function(F,G){return!G.dir&&D.test(F)})}var R=this.files[this.root+A];return R&&!R.dir?R:null},folder:function(A){if(!A)return this;if(C(A))return this.filter(function(R,F){return F.dir&&A.test(R)});var N=this.root+A,O=x.call(this,N),D=this.clone();return D.root=O.name,D},remove:function(A){A=this.root+A;var N=this.files[A];if(N||(A.slice(-1)!=="/"&&(A+="/"),N=this.files[A]),N&&!N.dir)delete this.files[A];else for(var O=this.filter(function(R,F){return F.name.slice(0,A.length)===A}),D=0;D<O.length;D++)delete this.files[O[D].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(A){var N,O={};try{if((O=r.extend(A||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:e.utf8encode})).type=O.type.toLowerCase(),O.compression=O.compression.toUpperCase(),O.type==="binarystring"&&(O.type="string"),!O.type)throw new Error("No output type specified.");r.checkSupport(O.type),O.platform!=="darwin"&&O.platform!=="freebsd"&&O.platform!=="linux"&&O.platform!=="sunos"||(O.platform="UNIX"),O.platform==="win32"&&(O.platform="DOS");var D=O.comment||this.comment||"";N=c.generateWorker(this,O,D)}catch(R){(N=new l("error")).error(R)}return new u(N,O.type||"string",O.mimeType)},generateAsync:function(A,N){return this.generateInternalStream(A).accumulate(N)},generateNodeStream:function(A,N){return(A=A||{}).type||(A.type="nodebuffer"),this.generateInternalStream(A).toNodejsStream(N)}};i.exports=j},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(t,i,s){i.exports=t("stream")},{stream:void 0}],17:[function(t,i,s){var n=t("./DataReader");function e(r){n.call(this,r);for(var l=0;l<this.data.length;l++)r[l]=255&r[l]}t("../utils").inherits(e,n),e.prototype.byteAt=function(r){return this.data[this.zero+r]},e.prototype.lastIndexOfSignature=function(r){for(var l=r.charCodeAt(0),u=r.charCodeAt(1),v=r.charCodeAt(2),p=r.charCodeAt(3),f=this.length-4;0<=f;--f)if(this.data[f]===l&&this.data[f+1]===u&&this.data[f+2]===v&&this.data[f+3]===p)return f-this.zero;return-1},e.prototype.readAndCheckSignature=function(r){var l=r.charCodeAt(0),u=r.charCodeAt(1),v=r.charCodeAt(2),p=r.charCodeAt(3),f=this.readData(4);return l===f[0]&&u===f[1]&&v===f[2]&&p===f[3]},e.prototype.readData=function(r){if(this.checkOffset(r),r===0)return[];var l=this.data.slice(this.zero+this.index,this.zero+this.index+r);return this.index+=r,l},i.exports=e},{"../utils":32,"./DataReader":18}],18:[function(t,i,s){var n=t("../utils");function e(r){this.data=r,this.length=r.length,this.index=0,this.zero=0}e.prototype={checkOffset:function(r){this.checkIndex(this.index+r)},checkIndex:function(r){if(this.length<this.zero+r||r<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+r+"). Corrupted zip ?")},setIndex:function(r){this.checkIndex(r),this.index=r},skip:function(r){this.setIndex(this.index+r)},byteAt:function(){},readInt:function(r){var l,u=0;for(this.checkOffset(r),l=this.index+r-1;l>=this.index;l--)u=(u<<8)+this.byteAt(l);return this.index+=r,u},readString:function(r){return n.transformTo("string",this.readData(r))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var r=this.readInt(4);return new Date(Date.UTC(1980+(r>>25&127),(r>>21&15)-1,r>>16&31,r>>11&31,r>>5&63,(31&r)<<1))}},i.exports=e},{"../utils":32}],19:[function(t,i,s){var n=t("./Uint8ArrayReader");function e(r){n.call(this,r)}t("../utils").inherits(e,n),e.prototype.readData=function(r){this.checkOffset(r);var l=this.data.slice(this.zero+this.index,this.zero+this.index+r);return this.index+=r,l},i.exports=e},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(t,i,s){var n=t("./DataReader");function e(r){n.call(this,r)}t("../utils").inherits(e,n),e.prototype.byteAt=function(r){return this.data.charCodeAt(this.zero+r)},e.prototype.lastIndexOfSignature=function(r){return this.data.lastIndexOf(r)-this.zero},e.prototype.readAndCheckSignature=function(r){return r===this.readData(4)},e.prototype.readData=function(r){this.checkOffset(r);var l=this.data.slice(this.zero+this.index,this.zero+this.index+r);return this.index+=r,l},i.exports=e},{"../utils":32,"./DataReader":18}],21:[function(t,i,s){var n=t("./ArrayReader");function e(r){n.call(this,r)}t("../utils").inherits(e,n),e.prototype.readData=function(r){if(this.checkOffset(r),r===0)return new Uint8Array(0);var l=this.data.subarray(this.zero+this.index,this.zero+this.index+r);return this.index+=r,l},i.exports=e},{"../utils":32,"./ArrayReader":17}],22:[function(t,i,s){var n=t("../utils"),e=t("../support"),r=t("./ArrayReader"),l=t("./StringReader"),u=t("./NodeBufferReader"),v=t("./Uint8ArrayReader");i.exports=function(p){var f=n.getTypeOf(p);return n.checkSupport(f),f!=="string"||e.uint8array?f==="nodebuffer"?new u(p):e.uint8array?new v(n.transformTo("uint8array",p)):new r(n.transformTo("array",p)):new l(p)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(t,i,s){s.LOCAL_FILE_HEADER="PK",s.CENTRAL_FILE_HEADER="PK",s.CENTRAL_DIRECTORY_END="PK",s.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x07",s.ZIP64_CENTRAL_DIRECTORY_END="PK",s.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(t,i,s){var n=t("./GenericWorker"),e=t("../utils");function r(l){n.call(this,"ConvertWorker to "+l),this.destType=l}e.inherits(r,n),r.prototype.processChunk=function(l){this.push({data:e.transformTo(this.destType,l.data),meta:l.meta})},i.exports=r},{"../utils":32,"./GenericWorker":28}],25:[function(t,i,s){var n=t("./GenericWorker"),e=t("../crc32");function r(){n.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}t("../utils").inherits(r,n),r.prototype.processChunk=function(l){this.streamInfo.crc32=e(l.data,this.streamInfo.crc32||0),this.push(l)},i.exports=r},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(t,i,s){var n=t("../utils"),e=t("./GenericWorker");function r(l){e.call(this,"DataLengthProbe for "+l),this.propName=l,this.withStreamInfo(l,0)}n.inherits(r,e),r.prototype.processChunk=function(l){if(l){var u=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=u+l.data.length}e.prototype.processChunk.call(this,l)},i.exports=r},{"../utils":32,"./GenericWorker":28}],27:[function(t,i,s){var n=t("../utils"),e=t("./GenericWorker");function r(l){e.call(this,"DataWorker");var u=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,l.then(function(v){u.dataIsReady=!0,u.data=v,u.max=v&&v.length||0,u.type=n.getTypeOf(v),u.isPaused||u._tickAndRepeat()},function(v){u.error(v)})}n.inherits(r,e),r.prototype.cleanUp=function(){e.prototype.cleanUp.call(this),this.data=null},r.prototype.resume=function(){return!!e.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,n.delay(this._tickAndRepeat,[],this)),!0)},r.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(n.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},r.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var l=null,u=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":l=this.data.substring(this.index,u);break;case"uint8array":l=this.data.subarray(this.index,u);break;case"array":case"nodebuffer":l=this.data.slice(this.index,u)}return this.index=u,this.push({data:l,meta:{percent:this.max?this.index/this.max*100:0}})},i.exports=r},{"../utils":32,"./GenericWorker":28}],28:[function(t,i,s){function n(e){this.name=e||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}n.prototype={push:function(e){this.emit("data",e)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(e){this.emit("error",e)}return!0},error:function(e){return!this.isFinished&&(this.isPaused?this.generatedError=e:(this.isFinished=!0,this.emit("error",e),this.previous&&this.previous.error(e),this.cleanUp()),!0)},on:function(e,r){return this._listeners[e].push(r),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(e,r){if(this._listeners[e])for(var l=0;l<this._listeners[e].length;l++)this._listeners[e][l].call(this,r)},pipe:function(e){return e.registerPrevious(this)},registerPrevious:function(e){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=e.streamInfo,this.mergeStreamInfo(),this.previous=e;var r=this;return e.on("data",function(l){r.processChunk(l)}),e.on("end",function(){r.end()}),e.on("error",function(l){r.error(l)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var e=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),e=!0),this.previous&&this.previous.resume(),!e},flush:function(){},processChunk:function(e){this.push(e)},withStreamInfo:function(e,r){return this.extraStreamInfo[e]=r,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var e in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,e)&&(this.streamInfo[e]=this.extraStreamInfo[e])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var e="Worker "+this.name;return this.previous?this.previous+" -> "+e:e}},i.exports=n},{}],29:[function(t,i,s){var n=t("../utils"),e=t("./ConvertWorker"),r=t("./GenericWorker"),l=t("../base64"),u=t("../support"),v=t("../external"),p=null;if(u.nodestream)try{p=t("../nodejs/NodejsStreamOutputAdapter")}catch(g){}function f(g,m){return new v.Promise(function(y,b){var x=[],C=g._internalType,j=g._outputType,A=g._mimeType;g.on("data",function(N,O){x.push(N),m&&m(O)}).on("error",function(N){x=[],b(N)}).on("end",function(){try{var N=function(O,D,R){switch(O){case"blob":return n.newBlob(n.transformTo("arraybuffer",D),R);case"base64":return l.encode(D);default:return n.transformTo(O,D)}}(j,function(O,D){var R,F=0,G=null,w=0;for(R=0;R<D.length;R++)w+=D[R].length;switch(O){case"string":return D.join("");case"array":return Array.prototype.concat.apply([],D);case"uint8array":for(G=new Uint8Array(w),R=0;R<D.length;R++)G.set(D[R],F),F+=D[R].length;return G;case"nodebuffer":return Buffer.concat(D);default:throw new Error("concat : unsupported type '"+O+"'")}}(C,x),A);y(N)}catch(O){b(O)}x=[]}).resume()})}function c(g,m,y){var b=m;switch(m){case"blob":case"arraybuffer":b="uint8array";break;case"base64":b="string"}try{this._internalType=b,this._outputType=m,this._mimeType=y,n.checkSupport(b),this._worker=g.pipe(new e(b)),g.lock()}catch(x){this._worker=new r("error"),this._worker.error(x)}}c.prototype={accumulate:function(g){return f(this,g)},on:function(g,m){var y=this;return g==="data"?this._worker.on(g,function(b){m.call(y,b.data,b.meta)}):this._worker.on(g,function(){n.delay(m,arguments,y)}),this},resume:function(){return n.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(g){if(n.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new p(this,{objectMode:this._outputType!=="nodebuffer"},g)}},i.exports=c},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(t,i,s){if(s.base64=!0,s.array=!0,s.string=!0,s.arraybuffer=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u",s.nodebuffer=typeof Buffer<"u",s.uint8array=typeof Uint8Array<"u",typeof ArrayBuffer>"u")s.blob=!1;else{var n=new ArrayBuffer(0);try{s.blob=new Blob([n],{type:"application/zip"}).size===0}catch(r){try{var e=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);e.append(n),s.blob=e.getBlob("application/zip").size===0}catch(l){s.blob=!1}}}try{s.nodestream=!!t("readable-stream").Readable}catch(r){s.nodestream=!1}},{"readable-stream":16}],31:[function(t,i,s){for(var n=t("./utils"),e=t("./support"),r=t("./nodejsUtils"),l=t("./stream/GenericWorker"),u=new Array(256),v=0;v<256;v++)u[v]=252<=v?6:248<=v?5:240<=v?4:224<=v?3:192<=v?2:1;u[254]=u[254]=1;function p(){l.call(this,"utf-8 decode"),this.leftOver=null}function f(){l.call(this,"utf-8 encode")}s.utf8encode=function(c){return e.nodebuffer?r.newBufferFrom(c,"utf-8"):function(g){var m,y,b,x,C,j=g.length,A=0;for(x=0;x<j;x++)(64512&(y=g.charCodeAt(x)))==55296&&x+1<j&&(64512&(b=g.charCodeAt(x+1)))==56320&&(y=65536+(y-55296<<10)+(b-56320),x++),A+=y<128?1:y<2048?2:y<65536?3:4;for(m=e.uint8array?new Uint8Array(A):new Array(A),x=C=0;C<A;x++)(64512&(y=g.charCodeAt(x)))==55296&&x+1<j&&(64512&(b=g.charCodeAt(x+1)))==56320&&(y=65536+(y-55296<<10)+(b-56320),x++),y<128?m[C++]=y:(y<2048?m[C++]=192|y>>>6:(y<65536?m[C++]=224|y>>>12:(m[C++]=240|y>>>18,m[C++]=128|y>>>12&63),m[C++]=128|y>>>6&63),m[C++]=128|63&y);return m}(c)},s.utf8decode=function(c){return e.nodebuffer?n.transformTo("nodebuffer",c).toString("utf-8"):function(g){var m,y,b,x,C=g.length,j=new Array(2*C);for(m=y=0;m<C;)if((b=g[m++])<128)j[y++]=b;else if(4<(x=u[b]))j[y++]=65533,m+=x-1;else{for(b&=x===2?31:x===3?15:7;1<x&&m<C;)b=b<<6|63&g[m++],x--;1<x?j[y++]=65533:b<65536?j[y++]=b:(b-=65536,j[y++]=55296|b>>10&1023,j[y++]=56320|1023&b)}return j.length!==y&&(j.subarray?j=j.subarray(0,y):j.length=y),n.applyFromCharCode(j)}(c=n.transformTo(e.uint8array?"uint8array":"array",c))},n.inherits(p,l),p.prototype.processChunk=function(c){var g=n.transformTo(e.uint8array?"uint8array":"array",c.data);if(this.leftOver&&this.leftOver.length){if(e.uint8array){var m=g;(g=new Uint8Array(m.length+this.leftOver.length)).set(this.leftOver,0),g.set(m,this.leftOver.length)}else g=this.leftOver.concat(g);this.leftOver=null}var y=function(x,C){var j;for((C=C||x.length)>x.length&&(C=x.length),j=C-1;0<=j&&(192&x[j])==128;)j--;return j<0||j===0?C:j+u[x[j]]>C?j:C}(g),b=g;y!==g.length&&(e.uint8array?(b=g.subarray(0,y),this.leftOver=g.subarray(y,g.length)):(b=g.slice(0,y),this.leftOver=g.slice(y,g.length))),this.push({data:s.utf8decode(b),meta:c.meta})},p.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:s.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},s.Utf8DecodeWorker=p,n.inherits(f,l),f.prototype.processChunk=function(c){this.push({data:s.utf8encode(c.data),meta:c.meta})},s.Utf8EncodeWorker=f},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(t,i,s){var n=t("./support"),e=t("./base64"),r=t("./nodejsUtils"),l=t("./external");function u(m){return m}function v(m,y){for(var b=0;b<m.length;++b)y[b]=255&m.charCodeAt(b);return y}t("setimmediate"),s.newBlob=function(m,y){s.checkSupport("blob");try{return new Blob([m],{type:y})}catch(x){try{var b=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return b.append(m),b.getBlob(y)}catch(C){throw new Error("Bug : can't construct the Blob.")}}};var p={stringifyByChunk:function(m,y,b){var x=[],C=0,j=m.length;if(j<=b)return String.fromCharCode.apply(null,m);for(;C<j;)y==="array"||y==="nodebuffer"?x.push(String.fromCharCode.apply(null,m.slice(C,Math.min(C+b,j)))):x.push(String.fromCharCode.apply(null,m.subarray(C,Math.min(C+b,j)))),C+=b;return x.join("")},stringifyByChar:function(m){for(var y="",b=0;b<m.length;b++)y+=String.fromCharCode(m[b]);return y},applyCanBeUsed:{uint8array:function(){try{return n.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch(m){return!1}}(),nodebuffer:function(){try{return n.nodebuffer&&String.fromCharCode.apply(null,r.allocBuffer(1)).length===1}catch(m){return!1}}()}};function f(m){var y=65536,b=s.getTypeOf(m),x=!0;if(b==="uint8array"?x=p.applyCanBeUsed.uint8array:b==="nodebuffer"&&(x=p.applyCanBeUsed.nodebuffer),x)for(;1<y;)try{return p.stringifyByChunk(m,b,y)}catch(C){y=Math.floor(y/2)}return p.stringifyByChar(m)}function c(m,y){for(var b=0;b<m.length;b++)y[b]=m[b];return y}s.applyFromCharCode=f;var g={};g.string={string:u,array:function(m){return v(m,new Array(m.length))},arraybuffer:function(m){return g.string.uint8array(m).buffer},uint8array:function(m){return v(m,new Uint8Array(m.length))},nodebuffer:function(m){return v(m,r.allocBuffer(m.length))}},g.array={string:f,array:u,arraybuffer:function(m){return new Uint8Array(m).buffer},uint8array:function(m){return new Uint8Array(m)},nodebuffer:function(m){return r.newBufferFrom(m)}},g.arraybuffer={string:function(m){return f(new Uint8Array(m))},array:function(m){return c(new Uint8Array(m),new Array(m.byteLength))},arraybuffer:u,uint8array:function(m){return new Uint8Array(m)},nodebuffer:function(m){return r.newBufferFrom(new Uint8Array(m))}},g.uint8array={string:f,array:function(m){return c(m,new Array(m.length))},arraybuffer:function(m){return m.buffer},uint8array:u,nodebuffer:function(m){return r.newBufferFrom(m)}},g.nodebuffer={string:f,array:function(m){return c(m,new Array(m.length))},arraybuffer:function(m){return g.nodebuffer.uint8array(m).buffer},uint8array:function(m){return c(m,new Uint8Array(m.length))},nodebuffer:u},s.transformTo=function(m,y){if(y=y||"",!m)return y;s.checkSupport(m);var b=s.getTypeOf(y);return g[b][m](y)},s.resolve=function(m){for(var y=m.split("/"),b=[],x=0;x<y.length;x++){var C=y[x];C==="."||C===""&&x!==0&&x!==y.length-1||(C===".."?b.pop():b.push(C))}return b.join("/")},s.getTypeOf=function(m){return typeof m=="string"?"string":Object.prototype.toString.call(m)==="[object Array]"?"array":n.nodebuffer&&r.isBuffer(m)?"nodebuffer":n.uint8array&&m instanceof Uint8Array?"uint8array":n.arraybuffer&&m instanceof ArrayBuffer?"arraybuffer":void 0},s.checkSupport=function(m){if(!n[m.toLowerCase()])throw new Error(m+" is not supported by this platform")},s.MAX_VALUE_16BITS=65535,s.MAX_VALUE_32BITS=-1,s.pretty=function(m){var y,b,x="";for(b=0;b<(m||"").length;b++)x+="\\x"+((y=m.charCodeAt(b))<16?"0":"")+y.toString(16).toUpperCase();return x},s.delay=function(m,y,b){setImmediate(function(){m.apply(b||null,y||[])})},s.inherits=function(m,y){function b(){}b.prototype=y.prototype,m.prototype=new b},s.extend=function(){var m,y,b={};for(m=0;m<arguments.length;m++)for(y in arguments[m])Object.prototype.hasOwnProperty.call(arguments[m],y)&&b[y]===void 0&&(b[y]=arguments[m][y]);return b},s.prepareContent=function(m,y,b,x,C){return l.Promise.resolve(y).then(function(j){return n.blob&&(j instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(j))!==-1)&&typeof FileReader<"u"?new l.Promise(function(A,N){var O=new FileReader;O.onload=function(D){A(D.target.result)},O.onerror=function(D){N(D.target.error)},O.readAsArrayBuffer(j)}):j}).then(function(j){var A=s.getTypeOf(j);return A?(A==="arraybuffer"?j=s.transformTo("uint8array",j):A==="string"&&(C?j=e.decode(j):b&&x!==!0&&(j=function(N){return v(N,n.uint8array?new Uint8Array(N.length):new Array(N.length))}(j))),j):l.Promise.reject(new Error("Can't read the data of '"+m+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(t,i,s){var n=t("./reader/readerFor"),e=t("./utils"),r=t("./signature"),l=t("./zipEntry"),u=t("./support");function v(p){this.files=[],this.loadOptions=p}v.prototype={checkSignature:function(p){if(!this.reader.readAndCheckSignature(p)){this.reader.index-=4;var f=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+e.pretty(f)+", expected "+e.pretty(p)+")")}},isSignature:function(p,f){var c=this.reader.index;this.reader.setIndex(p);var g=this.reader.readString(4)===f;return this.reader.setIndex(c),g},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var p=this.reader.readData(this.zipCommentLength),f=u.uint8array?"uint8array":"array",c=e.transformTo(f,p);this.zipComment=this.loadOptions.decodeFileName(c)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var p,f,c,g=this.zip64EndOfCentralSize-44;0<g;)p=this.reader.readInt(2),f=this.reader.readInt(4),c=this.reader.readData(f),this.zip64ExtensibleData[p]={id:p,length:f,value:c}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var p,f;for(p=0;p<this.files.length;p++)f=this.files[p],this.reader.setIndex(f.localHeaderOffset),this.checkSignature(r.LOCAL_FILE_HEADER),f.readLocalPart(this.reader),f.handleUTF8(),f.processAttributes()},readCentralDir:function(){var p;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(r.CENTRAL_FILE_HEADER);)(p=new l({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(p);if(this.centralDirRecords!==this.files.length&&this.centralDirRecords!==0&&this.files.length===0)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var p=this.reader.lastIndexOfSignature(r.CENTRAL_DIRECTORY_END);if(p<0)throw this.isSignature(0,r.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(p);var f=p;if(this.checkSignature(r.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===e.MAX_VALUE_16BITS||this.diskWithCentralDirStart===e.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===e.MAX_VALUE_16BITS||this.centralDirRecords===e.MAX_VALUE_16BITS||this.centralDirSize===e.MAX_VALUE_32BITS||this.centralDirOffset===e.MAX_VALUE_32BITS){if(this.zip64=!0,(p=this.reader.lastIndexOfSignature(r.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(p),this.checkSignature(r.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,r.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(r.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(r.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var c=this.centralDirOffset+this.centralDirSize;this.zip64&&(c+=20,c+=12+this.zip64EndOfCentralSize);var g=f-c;if(0<g)this.isSignature(f,r.CENTRAL_FILE_HEADER)||(this.reader.zero=g);else if(g<0)throw new Error("Corrupted zip: missing "+Math.abs(g)+" bytes.")},prepareReader:function(p){this.reader=n(p)},load:function(p){this.prepareReader(p),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},i.exports=v},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(t,i,s){var n=t("./reader/readerFor"),e=t("./utils"),r=t("./compressedObject"),l=t("./crc32"),u=t("./utf8"),v=t("./compressions"),p=t("./support");function f(c,g){this.options=c,this.loadOptions=g}f.prototype={isEncrypted:function(){return(1&this.bitFlag)==1},useUTF8:function(){return(2048&this.bitFlag)==2048},readLocalPart:function(c){var g,m;if(c.skip(22),this.fileNameLength=c.readInt(2),m=c.readInt(2),this.fileName=c.readData(this.fileNameLength),c.skip(m),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if((g=function(y){for(var b in v)if(Object.prototype.hasOwnProperty.call(v,b)&&v[b].magic===y)return v[b];return null}(this.compressionMethod))===null)throw new Error("Corrupted zip : compression "+e.pretty(this.compressionMethod)+" unknown (inner file : "+e.transformTo("string",this.fileName)+")");this.decompressed=new r(this.compressedSize,this.uncompressedSize,this.crc32,g,c.readData(this.compressedSize))},readCentralPart:function(c){this.versionMadeBy=c.readInt(2),c.skip(2),this.bitFlag=c.readInt(2),this.compressionMethod=c.readString(2),this.date=c.readDate(),this.crc32=c.readInt(4),this.compressedSize=c.readInt(4),this.uncompressedSize=c.readInt(4);var g=c.readInt(2);if(this.extraFieldsLength=c.readInt(2),this.fileCommentLength=c.readInt(2),this.diskNumberStart=c.readInt(2),this.internalFileAttributes=c.readInt(2),this.externalFileAttributes=c.readInt(4),this.localHeaderOffset=c.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");c.skip(g),this.readExtraFields(c),this.parseZIP64ExtraField(c),this.fileComment=c.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var c=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),c==0&&(this.dosPermissions=63&this.externalFileAttributes),c==3&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||this.fileNameStr.slice(-1)!=="/"||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var c=n(this.extraFields[1].value);this.uncompressedSize===e.MAX_VALUE_32BITS&&(this.uncompressedSize=c.readInt(8)),this.compressedSize===e.MAX_VALUE_32BITS&&(this.compressedSize=c.readInt(8)),this.localHeaderOffset===e.MAX_VALUE_32BITS&&(this.localHeaderOffset=c.readInt(8)),this.diskNumberStart===e.MAX_VALUE_32BITS&&(this.diskNumberStart=c.readInt(4))}},readExtraFields:function(c){var g,m,y,b=c.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});c.index+4<b;)g=c.readInt(2),m=c.readInt(2),y=c.readData(m),this.extraFields[g]={id:g,length:m,value:y};c.setIndex(b)},handleUTF8:function(){var c=p.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=u.utf8decode(this.fileName),this.fileCommentStr=u.utf8decode(this.fileComment);else{var g=this.findExtraFieldUnicodePath();if(g!==null)this.fileNameStr=g;else{var m=e.transformTo(c,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(m)}var y=this.findExtraFieldUnicodeComment();if(y!==null)this.fileCommentStr=y;else{var b=e.transformTo(c,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(b)}}},findExtraFieldUnicodePath:function(){var c=this.extraFields[28789];if(c){var g=n(c.value);return g.readInt(1)!==1||l(this.fileName)!==g.readInt(4)?null:u.utf8decode(g.readData(c.length-5))}return null},findExtraFieldUnicodeComment:function(){var c=this.extraFields[25461];if(c){var g=n(c.value);return g.readInt(1)!==1||l(this.fileComment)!==g.readInt(4)?null:u.utf8decode(g.readData(c.length-5))}return null}},i.exports=f},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(t,i,s){function n(g,m,y){this.name=g,this.dir=y.dir,this.date=y.date,this.comment=y.comment,this.unixPermissions=y.unixPermissions,this.dosPermissions=y.dosPermissions,this._data=m,this._dataBinary=y.binary,this.options={compression:y.compression,compressionOptions:y.compressionOptions}}var e=t("./stream/StreamHelper"),r=t("./stream/DataWorker"),l=t("./utf8"),u=t("./compressedObject"),v=t("./stream/GenericWorker");n.prototype={internalStream:function(g){var m=null,y="string";try{if(!g)throw new Error("No output type specified.");var b=(y=g.toLowerCase())==="string"||y==="text";y!=="binarystring"&&y!=="text"||(y="string"),m=this._decompressWorker();var x=!this._dataBinary;x&&!b&&(m=m.pipe(new l.Utf8EncodeWorker)),!x&&b&&(m=m.pipe(new l.Utf8DecodeWorker))}catch(C){(m=new v("error")).error(C)}return new e(m,y,"")},async:function(g,m){return this.internalStream(g).accumulate(m)},nodeStream:function(g,m){return this.internalStream(g||"nodebuffer").toNodejsStream(m)},_compressWorker:function(g,m){if(this._data instanceof u&&this._data.compression.magic===g.magic)return this._data.getCompressedWorker();var y=this._decompressWorker();return this._dataBinary||(y=y.pipe(new l.Utf8EncodeWorker)),u.createWorkerFrom(y,g,m)},_decompressWorker:function(){return this._data instanceof u?this._data.getContentWorker():this._data instanceof v?this._data:new r(this._data)}};for(var p=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],f=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},c=0;c<p.length;c++)n.prototype[p[c]]=f;i.exports=n},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(t,i,s){(function(n){var e,r,l=n.MutationObserver||n.WebKitMutationObserver;if(l){var u=0,v=new l(g),p=n.document.createTextNode("");v.observe(p,{characterData:!0}),e=function(){p.data=u=++u%2}}else if(n.setImmediate||n.MessageChannel===void 0)e="document"in n&&"onreadystatechange"in n.document.createElement("script")?function(){var m=n.document.createElement("script");m.onreadystatechange=function(){g(),m.onreadystatechange=null,m.parentNode.removeChild(m),m=null},n.document.documentElement.appendChild(m)}:function(){setTimeout(g,0)};else{var f=new n.MessageChannel;f.port1.onmessage=g,e=function(){f.port2.postMessage(0)}}var c=[];function g(){var m,y;r=!0;for(var b=c.length;b;){for(y=c,c=[],m=-1;++m<b;)y[m]();b=c.length}r=!1}i.exports=function(m){c.push(m)!==1||r||e()}}).call(this,typeof rt<"u"?rt:typeof self<"u"?self:typeof window<"u"?window:{})},{}],37:[function(t,i,s){var n=t("immediate");function e(){}var r={},l=["REJECTED"],u=["FULFILLED"],v=["PENDING"];function p(b){if(typeof b!="function")throw new TypeError("resolver must be a function");this.state=v,this.queue=[],this.outcome=void 0,b!==e&&m(this,b)}function f(b,x,C){this.promise=b,typeof x=="function"&&(this.onFulfilled=x,this.callFulfilled=this.otherCallFulfilled),typeof C=="function"&&(this.onRejected=C,this.callRejected=this.otherCallRejected)}function c(b,x,C){n(function(){var j;try{j=x(C)}catch(A){return r.reject(b,A)}j===b?r.reject(b,new TypeError("Cannot resolve promise with itself")):r.resolve(b,j)})}function g(b){var x=b&&b.then;if(b&&(typeof b=="object"||typeof b=="function")&&typeof x=="function")return function(){x.apply(b,arguments)}}function m(b,x){var C=!1;function j(O){C||(C=!0,r.reject(b,O))}function A(O){C||(C=!0,r.resolve(b,O))}var N=y(function(){x(A,j)});N.status==="error"&&j(N.value)}function y(b,x){var C={};try{C.value=b(x),C.status="success"}catch(j){C.status="error",C.value=j}return C}(i.exports=p).prototype.finally=function(b){if(typeof b!="function")return this;var x=this.constructor;return this.then(function(C){return x.resolve(b()).then(function(){return C})},function(C){return x.resolve(b()).then(function(){throw C})})},p.prototype.catch=function(b){return this.then(null,b)},p.prototype.then=function(b,x){if(typeof b!="function"&&this.state===u||typeof x!="function"&&this.state===l)return this;var C=new this.constructor(e);return this.state!==v?c(C,this.state===u?b:x,this.outcome):this.queue.push(new f(C,b,x)),C},f.prototype.callFulfilled=function(b){r.resolve(this.promise,b)},f.prototype.otherCallFulfilled=function(b){c(this.promise,this.onFulfilled,b)},f.prototype.callRejected=function(b){r.reject(this.promise,b)},f.prototype.otherCallRejected=function(b){c(this.promise,this.onRejected,b)},r.resolve=function(b,x){var C=y(g,x);if(C.status==="error")return r.reject(b,C.value);var j=C.value;if(j)m(b,j);else{b.state=u,b.outcome=x;for(var A=-1,N=b.queue.length;++A<N;)b.queue[A].callFulfilled(x)}return b},r.reject=function(b,x){b.state=l,b.outcome=x;for(var C=-1,j=b.queue.length;++C<j;)b.queue[C].callRejected(x);return b},p.resolve=function(b){return b instanceof this?b:r.resolve(new this(e),b)},p.reject=function(b){var x=new this(e);return r.reject(x,b)},p.all=function(b){var x=this;if(Object.prototype.toString.call(b)!=="[object Array]")return this.reject(new TypeError("must be an array"));var C=b.length,j=!1;if(!C)return this.resolve([]);for(var A=new Array(C),N=0,O=-1,D=new this(e);++O<C;)R(b[O],O);return D;function R(F,G){x.resolve(F).then(function(w){A[G]=w,++N!==C||j||(j=!0,r.resolve(D,A))},function(w){j||(j=!0,r.reject(D,w))})}},p.race=function(b){var x=this;if(Object.prototype.toString.call(b)!=="[object Array]")return this.reject(new TypeError("must be an array"));var C=b.length,j=!1;if(!C)return this.resolve([]);for(var A=-1,N=new this(e);++A<C;)O=b[A],x.resolve(O).then(function(D){j||(j=!0,r.resolve(N,D))},function(D){j||(j=!0,r.reject(N,D))});var O;return N}},{immediate:36}],38:[function(t,i,s){var n={};(0,t("./lib/utils/common").assign)(n,t("./lib/deflate"),t("./lib/inflate"),t("./lib/zlib/constants")),i.exports=n},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(t,i,s){var n=t("./zlib/deflate"),e=t("./utils/common"),r=t("./utils/strings"),l=t("./zlib/messages"),u=t("./zlib/zstream"),v=Object.prototype.toString,p=0,f=-1,c=0,g=8;function m(b){if(!(this instanceof m))return new m(b);this.options=e.assign({level:f,method:g,chunkSize:16384,windowBits:15,memLevel:8,strategy:c,to:""},b||{});var x=this.options;x.raw&&0<x.windowBits?x.windowBits=-x.windowBits:x.gzip&&0<x.windowBits&&x.windowBits<16&&(x.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new u,this.strm.avail_out=0;var C=n.deflateInit2(this.strm,x.level,x.method,x.windowBits,x.memLevel,x.strategy);if(C!==p)throw new Error(l[C]);if(x.header&&n.deflateSetHeader(this.strm,x.header),x.dictionary){var j;if(j=typeof x.dictionary=="string"?r.string2buf(x.dictionary):v.call(x.dictionary)==="[object ArrayBuffer]"?new Uint8Array(x.dictionary):x.dictionary,(C=n.deflateSetDictionary(this.strm,j))!==p)throw new Error(l[C]);this._dict_set=!0}}function y(b,x){var C=new m(x);if(C.push(b,!0),C.err)throw C.msg||l[C.err];return C.result}m.prototype.push=function(b,x){var C,j,A=this.strm,N=this.options.chunkSize;if(this.ended)return!1;j=x===~~x?x:x===!0?4:0,typeof b=="string"?A.input=r.string2buf(b):v.call(b)==="[object ArrayBuffer]"?A.input=new Uint8Array(b):A.input=b,A.next_in=0,A.avail_in=A.input.length;do{if(A.avail_out===0&&(A.output=new e.Buf8(N),A.next_out=0,A.avail_out=N),(C=n.deflate(A,j))!==1&&C!==p)return this.onEnd(C),!(this.ended=!0);A.avail_out!==0&&(A.avail_in!==0||j!==4&&j!==2)||(this.options.to==="string"?this.onData(r.buf2binstring(e.shrinkBuf(A.output,A.next_out))):this.onData(e.shrinkBuf(A.output,A.next_out)))}while((0<A.avail_in||A.avail_out===0)&&C!==1);return j===4?(C=n.deflateEnd(this.strm),this.onEnd(C),this.ended=!0,C===p):j!==2||(this.onEnd(p),!(A.avail_out=0))},m.prototype.onData=function(b){this.chunks.push(b)},m.prototype.onEnd=function(b){b===p&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=e.flattenChunks(this.chunks)),this.chunks=[],this.err=b,this.msg=this.strm.msg},s.Deflate=m,s.deflate=y,s.deflateRaw=function(b,x){return(x=x||{}).raw=!0,y(b,x)},s.gzip=function(b,x){return(x=x||{}).gzip=!0,y(b,x)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(t,i,s){var n=t("./zlib/inflate"),e=t("./utils/common"),r=t("./utils/strings"),l=t("./zlib/constants"),u=t("./zlib/messages"),v=t("./zlib/zstream"),p=t("./zlib/gzheader"),f=Object.prototype.toString;function c(m){if(!(this instanceof c))return new c(m);this.options=e.assign({chunkSize:16384,windowBits:0,to:""},m||{});var y=this.options;y.raw&&0<=y.windowBits&&y.windowBits<16&&(y.windowBits=-y.windowBits,y.windowBits===0&&(y.windowBits=-15)),!(0<=y.windowBits&&y.windowBits<16)||m&&m.windowBits||(y.windowBits+=32),15<y.windowBits&&y.windowBits<48&&!(15&y.windowBits)&&(y.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new v,this.strm.avail_out=0;var b=n.inflateInit2(this.strm,y.windowBits);if(b!==l.Z_OK)throw new Error(u[b]);this.header=new p,n.inflateGetHeader(this.strm,this.header)}function g(m,y){var b=new c(y);if(b.push(m,!0),b.err)throw b.msg||u[b.err];return b.result}c.prototype.push=function(m,y){var b,x,C,j,A,N,O=this.strm,D=this.options.chunkSize,R=this.options.dictionary,F=!1;if(this.ended)return!1;x=y===~~y?y:y===!0?l.Z_FINISH:l.Z_NO_FLUSH,typeof m=="string"?O.input=r.binstring2buf(m):f.call(m)==="[object ArrayBuffer]"?O.input=new Uint8Array(m):O.input=m,O.next_in=0,O.avail_in=O.input.length;do{if(O.avail_out===0&&(O.output=new e.Buf8(D),O.next_out=0,O.avail_out=D),(b=n.inflate(O,l.Z_NO_FLUSH))===l.Z_NEED_DICT&&R&&(N=typeof R=="string"?r.string2buf(R):f.call(R)==="[object ArrayBuffer]"?new Uint8Array(R):R,b=n.inflateSetDictionary(this.strm,N)),b===l.Z_BUF_ERROR&&F===!0&&(b=l.Z_OK,F=!1),b!==l.Z_STREAM_END&&b!==l.Z_OK)return this.onEnd(b),!(this.ended=!0);O.next_out&&(O.avail_out!==0&&b!==l.Z_STREAM_END&&(O.avail_in!==0||x!==l.Z_FINISH&&x!==l.Z_SYNC_FLUSH)||(this.options.to==="string"?(C=r.utf8border(O.output,O.next_out),j=O.next_out-C,A=r.buf2string(O.output,C),O.next_out=j,O.avail_out=D-j,j&&e.arraySet(O.output,O.output,C,j,0),this.onData(A)):this.onData(e.shrinkBuf(O.output,O.next_out)))),O.avail_in===0&&O.avail_out===0&&(F=!0)}while((0<O.avail_in||O.avail_out===0)&&b!==l.Z_STREAM_END);return b===l.Z_STREAM_END&&(x=l.Z_FINISH),x===l.Z_FINISH?(b=n.inflateEnd(this.strm),this.onEnd(b),this.ended=!0,b===l.Z_OK):x!==l.Z_SYNC_FLUSH||(this.onEnd(l.Z_OK),!(O.avail_out=0))},c.prototype.onData=function(m){this.chunks.push(m)},c.prototype.onEnd=function(m){m===l.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=e.flattenChunks(this.chunks)),this.chunks=[],this.err=m,this.msg=this.strm.msg},s.Inflate=c,s.inflate=g,s.inflateRaw=function(m,y){return(y=y||{}).raw=!0,g(m,y)},s.ungzip=g},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(t,i,s){var n=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";s.assign=function(l){for(var u=Array.prototype.slice.call(arguments,1);u.length;){var v=u.shift();if(v){if(typeof v!="object")throw new TypeError(v+"must be non-object");for(var p in v)v.hasOwnProperty(p)&&(l[p]=v[p])}}return l},s.shrinkBuf=function(l,u){return l.length===u?l:l.subarray?l.subarray(0,u):(l.length=u,l)};var e={arraySet:function(l,u,v,p,f){if(u.subarray&&l.subarray)l.set(u.subarray(v,v+p),f);else for(var c=0;c<p;c++)l[f+c]=u[v+c]},flattenChunks:function(l){var u,v,p,f,c,g;for(u=p=0,v=l.length;u<v;u++)p+=l[u].length;for(g=new Uint8Array(p),u=f=0,v=l.length;u<v;u++)c=l[u],g.set(c,f),f+=c.length;return g}},r={arraySet:function(l,u,v,p,f){for(var c=0;c<p;c++)l[f+c]=u[v+c]},flattenChunks:function(l){return[].concat.apply([],l)}};s.setTyped=function(l){l?(s.Buf8=Uint8Array,s.Buf16=Uint16Array,s.Buf32=Int32Array,s.assign(s,e)):(s.Buf8=Array,s.Buf16=Array,s.Buf32=Array,s.assign(s,r))},s.setTyped(n)},{}],42:[function(t,i,s){var n=t("./common"),e=!0,r=!0;try{String.fromCharCode.apply(null,[0])}catch(p){e=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(p){r=!1}for(var l=new n.Buf8(256),u=0;u<256;u++)l[u]=252<=u?6:248<=u?5:240<=u?4:224<=u?3:192<=u?2:1;function v(p,f){if(f<65537&&(p.subarray&&r||!p.subarray&&e))return String.fromCharCode.apply(null,n.shrinkBuf(p,f));for(var c="",g=0;g<f;g++)c+=String.fromCharCode(p[g]);return c}l[254]=l[254]=1,s.string2buf=function(p){var f,c,g,m,y,b=p.length,x=0;for(m=0;m<b;m++)(64512&(c=p.charCodeAt(m)))==55296&&m+1<b&&(64512&(g=p.charCodeAt(m+1)))==56320&&(c=65536+(c-55296<<10)+(g-56320),m++),x+=c<128?1:c<2048?2:c<65536?3:4;for(f=new n.Buf8(x),m=y=0;y<x;m++)(64512&(c=p.charCodeAt(m)))==55296&&m+1<b&&(64512&(g=p.charCodeAt(m+1)))==56320&&(c=65536+(c-55296<<10)+(g-56320),m++),c<128?f[y++]=c:(c<2048?f[y++]=192|c>>>6:(c<65536?f[y++]=224|c>>>12:(f[y++]=240|c>>>18,f[y++]=128|c>>>12&63),f[y++]=128|c>>>6&63),f[y++]=128|63&c);return f},s.buf2binstring=function(p){return v(p,p.length)},s.binstring2buf=function(p){for(var f=new n.Buf8(p.length),c=0,g=f.length;c<g;c++)f[c]=p.charCodeAt(c);return f},s.buf2string=function(p,f){var c,g,m,y,b=f||p.length,x=new Array(2*b);for(c=g=0;c<b;)if((m=p[c++])<128)x[g++]=m;else if(4<(y=l[m]))x[g++]=65533,c+=y-1;else{for(m&=y===2?31:y===3?15:7;1<y&&c<b;)m=m<<6|63&p[c++],y--;1<y?x[g++]=65533:m<65536?x[g++]=m:(m-=65536,x[g++]=55296|m>>10&1023,x[g++]=56320|1023&m)}return v(x,g)},s.utf8border=function(p,f){var c;for((f=f||p.length)>p.length&&(f=p.length),c=f-1;0<=c&&(192&p[c])==128;)c--;return c<0||c===0?f:c+l[p[c]]>f?c:f}},{"./common":41}],43:[function(t,i,s){i.exports=function(n,e,r,l){for(var u=65535&n|0,v=n>>>16&65535|0,p=0;r!==0;){for(r-=p=2e3<r?2e3:r;v=v+(u=u+e[l++]|0)|0,--p;);u%=65521,v%=65521}return u|v<<16|0}},{}],44:[function(t,i,s){i.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(t,i,s){var n=function(){for(var e,r=[],l=0;l<256;l++){e=l;for(var u=0;u<8;u++)e=1&e?3988292384^e>>>1:e>>>1;r[l]=e}return r}();i.exports=function(e,r,l,u){var v=n,p=u+l;e^=-1;for(var f=u;f<p;f++)e=e>>>8^v[255&(e^r[f])];return-1^e}},{}],46:[function(t,i,s){var n,e=t("../utils/common"),r=t("./trees"),l=t("./adler32"),u=t("./crc32"),v=t("./messages"),p=0,f=4,c=0,g=-2,m=-1,y=4,b=2,x=8,C=9,j=286,A=30,N=19,O=2*j+1,D=15,R=3,F=258,G=F+R+1,w=42,T=113,h=1,M=2,ne=3,Z=4;function se(a,L){return a.msg=v[L],L}function H(a){return(a<<1)-(4<a?9:0)}function re(a){for(var L=a.length;0<=--L;)a[L]=0}function B(a){var L=a.state,I=L.pending;I>a.avail_out&&(I=a.avail_out),I!==0&&(e.arraySet(a.output,L.pending_buf,L.pending_out,I,a.next_out),a.next_out+=I,L.pending_out+=I,a.total_out+=I,a.avail_out-=I,L.pending-=I,L.pending===0&&(L.pending_out=0))}function z(a,L){r._tr_flush_block(a,0<=a.block_start?a.block_start:-1,a.strstart-a.block_start,L),a.block_start=a.strstart,B(a.strm)}function te(a,L){a.pending_buf[a.pending++]=L}function q(a,L){a.pending_buf[a.pending++]=L>>>8&255,a.pending_buf[a.pending++]=255&L}function Y(a,L){var I,k,S=a.max_chain_length,E=a.strstart,U=a.prev_length,W=a.nice_match,P=a.strstart>a.w_size-G?a.strstart-(a.w_size-G):0,V=a.window,K=a.w_mask,$=a.prev,Q=a.strstart+F,he=V[E+U-1],ae=V[E+U];a.prev_length>=a.good_match&&(S>>=2),W>a.lookahead&&(W=a.lookahead);do if(V[(I=L)+U]===ae&&V[I+U-1]===he&&V[I]===V[E]&&V[++I]===V[E+1]){E+=2,I++;do;while(V[++E]===V[++I]&&V[++E]===V[++I]&&V[++E]===V[++I]&&V[++E]===V[++I]&&V[++E]===V[++I]&&V[++E]===V[++I]&&V[++E]===V[++I]&&V[++E]===V[++I]&&E<Q);if(k=F-(Q-E),E=Q-F,U<k){if(a.match_start=L,W<=(U=k))break;he=V[E+U-1],ae=V[E+U]}}while((L=$[L&K])>P&&--S!=0);return U<=a.lookahead?U:a.lookahead}function fe(a){var L,I,k,S,E,U,W,P,V,K,$=a.w_size;do{if(S=a.window_size-a.lookahead-a.strstart,a.strstart>=$+($-G)){for(e.arraySet(a.window,a.window,$,$,0),a.match_start-=$,a.strstart-=$,a.block_start-=$,L=I=a.hash_size;k=a.head[--L],a.head[L]=$<=k?k-$:0,--I;);for(L=I=$;k=a.prev[--L],a.prev[L]=$<=k?k-$:0,--I;);S+=$}if(a.strm.avail_in===0)break;if(U=a.strm,W=a.window,P=a.strstart+a.lookahead,V=S,K=void 0,K=U.avail_in,V<K&&(K=V),I=K===0?0:(U.avail_in-=K,e.arraySet(W,U.input,U.next_in,K,P),U.state.wrap===1?U.adler=l(U.adler,W,K,P):U.state.wrap===2&&(U.adler=u(U.adler,W,K,P)),U.next_in+=K,U.total_in+=K,K),a.lookahead+=I,a.lookahead+a.insert>=R)for(E=a.strstart-a.insert,a.ins_h=a.window[E],a.ins_h=(a.ins_h<<a.hash_shift^a.window[E+1])&a.hash_mask;a.insert&&(a.ins_h=(a.ins_h<<a.hash_shift^a.window[E+R-1])&a.hash_mask,a.prev[E&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=E,E++,a.insert--,!(a.lookahead+a.insert<R)););}while(a.lookahead<G&&a.strm.avail_in!==0)}function _e(a,L){for(var I,k;;){if(a.lookahead<G){if(fe(a),a.lookahead<G&&L===p)return h;if(a.lookahead===0)break}if(I=0,a.lookahead>=R&&(a.ins_h=(a.ins_h<<a.hash_shift^a.window[a.strstart+R-1])&a.hash_mask,I=a.prev[a.strstart&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=a.strstart),I!==0&&a.strstart-I<=a.w_size-G&&(a.match_length=Y(a,I)),a.match_length>=R)if(k=r._tr_tally(a,a.strstart-a.match_start,a.match_length-R),a.lookahead-=a.match_length,a.match_length<=a.max_lazy_match&&a.lookahead>=R){for(a.match_length--;a.strstart++,a.ins_h=(a.ins_h<<a.hash_shift^a.window[a.strstart+R-1])&a.hash_mask,I=a.prev[a.strstart&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=a.strstart,--a.match_length!=0;);a.strstart++}else a.strstart+=a.match_length,a.match_length=0,a.ins_h=a.window[a.strstart],a.ins_h=(a.ins_h<<a.hash_shift^a.window[a.strstart+1])&a.hash_mask;else k=r._tr_tally(a,0,a.window[a.strstart]),a.lookahead--,a.strstart++;if(k&&(z(a,!1),a.strm.avail_out===0))return h}return a.insert=a.strstart<R-1?a.strstart:R-1,L===f?(z(a,!0),a.strm.avail_out===0?ne:Z):a.last_lit&&(z(a,!1),a.strm.avail_out===0)?h:M}function ie(a,L){for(var I,k,S;;){if(a.lookahead<G){if(fe(a),a.lookahead<G&&L===p)return h;if(a.lookahead===0)break}if(I=0,a.lookahead>=R&&(a.ins_h=(a.ins_h<<a.hash_shift^a.window[a.strstart+R-1])&a.hash_mask,I=a.prev[a.strstart&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=a.strstart),a.prev_length=a.match_length,a.prev_match=a.match_start,a.match_length=R-1,I!==0&&a.prev_length<a.max_lazy_match&&a.strstart-I<=a.w_size-G&&(a.match_length=Y(a,I),a.match_length<=5&&(a.strategy===1||a.match_length===R&&4096<a.strstart-a.match_start)&&(a.match_length=R-1)),a.prev_length>=R&&a.match_length<=a.prev_length){for(S=a.strstart+a.lookahead-R,k=r._tr_tally(a,a.strstart-1-a.prev_match,a.prev_length-R),a.lookahead-=a.prev_length-1,a.prev_length-=2;++a.strstart<=S&&(a.ins_h=(a.ins_h<<a.hash_shift^a.window[a.strstart+R-1])&a.hash_mask,I=a.prev[a.strstart&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=a.strstart),--a.prev_length!=0;);if(a.match_available=0,a.match_length=R-1,a.strstart++,k&&(z(a,!1),a.strm.avail_out===0))return h}else if(a.match_available){if((k=r._tr_tally(a,0,a.window[a.strstart-1]))&&z(a,!1),a.strstart++,a.lookahead--,a.strm.avail_out===0)return h}else a.match_available=1,a.strstart++,a.lookahead--}return a.match_available&&(k=r._tr_tally(a,0,a.window[a.strstart-1]),a.match_available=0),a.insert=a.strstart<R-1?a.strstart:R-1,L===f?(z(a,!0),a.strm.avail_out===0?ne:Z):a.last_lit&&(z(a,!1),a.strm.avail_out===0)?h:M}function oe(a,L,I,k,S){this.good_length=a,this.max_lazy=L,this.nice_length=I,this.max_chain=k,this.func=S}function ge(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=x,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new e.Buf16(2*O),this.dyn_dtree=new e.Buf16(2*(2*A+1)),this.bl_tree=new e.Buf16(2*(2*N+1)),re(this.dyn_ltree),re(this.dyn_dtree),re(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new e.Buf16(D+1),this.heap=new e.Buf16(2*j+1),re(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new e.Buf16(2*j+1),re(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function pe(a){var L;return a&&a.state?(a.total_in=a.total_out=0,a.data_type=b,(L=a.state).pending=0,L.pending_out=0,L.wrap<0&&(L.wrap=-L.wrap),L.status=L.wrap?w:T,a.adler=L.wrap===2?0:1,L.last_flush=p,r._tr_init(L),c):se(a,g)}function Ae(a){var L=pe(a);return L===c&&function(I){I.window_size=2*I.w_size,re(I.head),I.max_lazy_match=n[I.level].max_lazy,I.good_match=n[I.level].good_length,I.nice_match=n[I.level].nice_length,I.max_chain_length=n[I.level].max_chain,I.strstart=0,I.block_start=0,I.lookahead=0,I.insert=0,I.match_length=I.prev_length=R-1,I.match_available=0,I.ins_h=0}(a.state),L}function je(a,L,I,k,S,E){if(!a)return g;var U=1;if(L===m&&(L=6),k<0?(U=0,k=-k):15<k&&(U=2,k-=16),S<1||C<S||I!==x||k<8||15<k||L<0||9<L||E<0||y<E)return se(a,g);k===8&&(k=9);var W=new ge;return(a.state=W).strm=a,W.wrap=U,W.gzhead=null,W.w_bits=k,W.w_size=1<<W.w_bits,W.w_mask=W.w_size-1,W.hash_bits=S+7,W.hash_size=1<<W.hash_bits,W.hash_mask=W.hash_size-1,W.hash_shift=~~((W.hash_bits+R-1)/R),W.window=new e.Buf8(2*W.w_size),W.head=new e.Buf16(W.hash_size),W.prev=new e.Buf16(W.w_size),W.lit_bufsize=1<<S+6,W.pending_buf_size=4*W.lit_bufsize,W.pending_buf=new e.Buf8(W.pending_buf_size),W.d_buf=1*W.lit_bufsize,W.l_buf=3*W.lit_bufsize,W.level=L,W.strategy=E,W.method=I,Ae(a)}n=[new oe(0,0,0,0,function(a,L){var I=65535;for(I>a.pending_buf_size-5&&(I=a.pending_buf_size-5);;){if(a.lookahead<=1){if(fe(a),a.lookahead===0&&L===p)return h;if(a.lookahead===0)break}a.strstart+=a.lookahead,a.lookahead=0;var k=a.block_start+I;if((a.strstart===0||a.strstart>=k)&&(a.lookahead=a.strstart-k,a.strstart=k,z(a,!1),a.strm.avail_out===0)||a.strstart-a.block_start>=a.w_size-G&&(z(a,!1),a.strm.avail_out===0))return h}return a.insert=0,L===f?(z(a,!0),a.strm.avail_out===0?ne:Z):(a.strstart>a.block_start&&(z(a,!1),a.strm.avail_out),h)}),new oe(4,4,8,4,_e),new oe(4,5,16,8,_e),new oe(4,6,32,32,_e),new oe(4,4,16,16,ie),new oe(8,16,32,32,ie),new oe(8,16,128,128,ie),new oe(8,32,128,256,ie),new oe(32,128,258,1024,ie),new oe(32,258,258,4096,ie)],s.deflateInit=function(a,L){return je(a,L,x,15,8,0)},s.deflateInit2=je,s.deflateReset=Ae,s.deflateResetKeep=pe,s.deflateSetHeader=function(a,L){return a&&a.state?a.state.wrap!==2?g:(a.state.gzhead=L,c):g},s.deflate=function(a,L){var I,k,S,E;if(!a||!a.state||5<L||L<0)return a?se(a,g):g;if(k=a.state,!a.output||!a.input&&a.avail_in!==0||k.status===666&&L!==f)return se(a,a.avail_out===0?-5:g);if(k.strm=a,I=k.last_flush,k.last_flush=L,k.status===w)if(k.wrap===2)a.adler=0,te(k,31),te(k,139),te(k,8),k.gzhead?(te(k,(k.gzhead.text?1:0)+(k.gzhead.hcrc?2:0)+(k.gzhead.extra?4:0)+(k.gzhead.name?8:0)+(k.gzhead.comment?16:0)),te(k,255&k.gzhead.time),te(k,k.gzhead.time>>8&255),te(k,k.gzhead.time>>16&255),te(k,k.gzhead.time>>24&255),te(k,k.level===9?2:2<=k.strategy||k.level<2?4:0),te(k,255&k.gzhead.os),k.gzhead.extra&&k.gzhead.extra.length&&(te(k,255&k.gzhead.extra.length),te(k,k.gzhead.extra.length>>8&255)),k.gzhead.hcrc&&(a.adler=u(a.adler,k.pending_buf,k.pending,0)),k.gzindex=0,k.status=69):(te(k,0),te(k,0),te(k,0),te(k,0),te(k,0),te(k,k.level===9?2:2<=k.strategy||k.level<2?4:0),te(k,3),k.status=T);else{var U=x+(k.w_bits-8<<4)<<8;U|=(2<=k.strategy||k.level<2?0:k.level<6?1:k.level===6?2:3)<<6,k.strstart!==0&&(U|=32),U+=31-U%31,k.status=T,q(k,U),k.strstart!==0&&(q(k,a.adler>>>16),q(k,65535&a.adler)),a.adler=1}if(k.status===69)if(k.gzhead.extra){for(S=k.pending;k.gzindex<(65535&k.gzhead.extra.length)&&(k.pending!==k.pending_buf_size||(k.gzhead.hcrc&&k.pending>S&&(a.adler=u(a.adler,k.pending_buf,k.pending-S,S)),B(a),S=k.pending,k.pending!==k.pending_buf_size));)te(k,255&k.gzhead.extra[k.gzindex]),k.gzindex++;k.gzhead.hcrc&&k.pending>S&&(a.adler=u(a.adler,k.pending_buf,k.pending-S,S)),k.gzindex===k.gzhead.extra.length&&(k.gzindex=0,k.status=73)}else k.status=73;if(k.status===73)if(k.gzhead.name){S=k.pending;do{if(k.pending===k.pending_buf_size&&(k.gzhead.hcrc&&k.pending>S&&(a.adler=u(a.adler,k.pending_buf,k.pending-S,S)),B(a),S=k.pending,k.pending===k.pending_buf_size)){E=1;break}E=k.gzindex<k.gzhead.name.length?255&k.gzhead.name.charCodeAt(k.gzindex++):0,te(k,E)}while(E!==0);k.gzhead.hcrc&&k.pending>S&&(a.adler=u(a.adler,k.pending_buf,k.pending-S,S)),E===0&&(k.gzindex=0,k.status=91)}else k.status=91;if(k.status===91)if(k.gzhead.comment){S=k.pending;do{if(k.pending===k.pending_buf_size&&(k.gzhead.hcrc&&k.pending>S&&(a.adler=u(a.adler,k.pending_buf,k.pending-S,S)),B(a),S=k.pending,k.pending===k.pending_buf_size)){E=1;break}E=k.gzindex<k.gzhead.comment.length?255&k.gzhead.comment.charCodeAt(k.gzindex++):0,te(k,E)}while(E!==0);k.gzhead.hcrc&&k.pending>S&&(a.adler=u(a.adler,k.pending_buf,k.pending-S,S)),E===0&&(k.status=103)}else k.status=103;if(k.status===103&&(k.gzhead.hcrc?(k.pending+2>k.pending_buf_size&&B(a),k.pending+2<=k.pending_buf_size&&(te(k,255&a.adler),te(k,a.adler>>8&255),a.adler=0,k.status=T)):k.status=T),k.pending!==0){if(B(a),a.avail_out===0)return k.last_flush=-1,c}else if(a.avail_in===0&&H(L)<=H(I)&&L!==f)return se(a,-5);if(k.status===666&&a.avail_in!==0)return se(a,-5);if(a.avail_in!==0||k.lookahead!==0||L!==p&&k.status!==666){var W=k.strategy===2?function(P,V){for(var K;;){if(P.lookahead===0&&(fe(P),P.lookahead===0)){if(V===p)return h;break}if(P.match_length=0,K=r._tr_tally(P,0,P.window[P.strstart]),P.lookahead--,P.strstart++,K&&(z(P,!1),P.strm.avail_out===0))return h}return P.insert=0,V===f?(z(P,!0),P.strm.avail_out===0?ne:Z):P.last_lit&&(z(P,!1),P.strm.avail_out===0)?h:M}(k,L):k.strategy===3?function(P,V){for(var K,$,Q,he,ae=P.window;;){if(P.lookahead<=F){if(fe(P),P.lookahead<=F&&V===p)return h;if(P.lookahead===0)break}if(P.match_length=0,P.lookahead>=R&&0<P.strstart&&($=ae[Q=P.strstart-1])===ae[++Q]&&$===ae[++Q]&&$===ae[++Q]){he=P.strstart+F;do;while($===ae[++Q]&&$===ae[++Q]&&$===ae[++Q]&&$===ae[++Q]&&$===ae[++Q]&&$===ae[++Q]&&$===ae[++Q]&&$===ae[++Q]&&Q<he);P.match_length=F-(he-Q),P.match_length>P.lookahead&&(P.match_length=P.lookahead)}if(P.match_length>=R?(K=r._tr_tally(P,1,P.match_length-R),P.lookahead-=P.match_length,P.strstart+=P.match_length,P.match_length=0):(K=r._tr_tally(P,0,P.window[P.strstart]),P.lookahead--,P.strstart++),K&&(z(P,!1),P.strm.avail_out===0))return h}return P.insert=0,V===f?(z(P,!0),P.strm.avail_out===0?ne:Z):P.last_lit&&(z(P,!1),P.strm.avail_out===0)?h:M}(k,L):n[k.level].func(k,L);if(W!==ne&&W!==Z||(k.status=666),W===h||W===ne)return a.avail_out===0&&(k.last_flush=-1),c;if(W===M&&(L===1?r._tr_align(k):L!==5&&(r._tr_stored_block(k,0,0,!1),L===3&&(re(k.head),k.lookahead===0&&(k.strstart=0,k.block_start=0,k.insert=0))),B(a),a.avail_out===0))return k.last_flush=-1,c}return L!==f?c:k.wrap<=0?1:(k.wrap===2?(te(k,255&a.adler),te(k,a.adler>>8&255),te(k,a.adler>>16&255),te(k,a.adler>>24&255),te(k,255&a.total_in),te(k,a.total_in>>8&255),te(k,a.total_in>>16&255),te(k,a.total_in>>24&255)):(q(k,a.adler>>>16),q(k,65535&a.adler)),B(a),0<k.wrap&&(k.wrap=-k.wrap),k.pending!==0?c:1)},s.deflateEnd=function(a){var L;return a&&a.state?(L=a.state.status)!==w&&L!==69&&L!==73&&L!==91&&L!==103&&L!==T&&L!==666?se(a,g):(a.state=null,L===T?se(a,-3):c):g},s.deflateSetDictionary=function(a,L){var I,k,S,E,U,W,P,V,K=L.length;if(!a||!a.state||(E=(I=a.state).wrap)===2||E===1&&I.status!==w||I.lookahead)return g;for(E===1&&(a.adler=l(a.adler,L,K,0)),I.wrap=0,K>=I.w_size&&(E===0&&(re(I.head),I.strstart=0,I.block_start=0,I.insert=0),V=new e.Buf8(I.w_size),e.arraySet(V,L,K-I.w_size,I.w_size,0),L=V,K=I.w_size),U=a.avail_in,W=a.next_in,P=a.input,a.avail_in=K,a.next_in=0,a.input=L,fe(I);I.lookahead>=R;){for(k=I.strstart,S=I.lookahead-(R-1);I.ins_h=(I.ins_h<<I.hash_shift^I.window[k+R-1])&I.hash_mask,I.prev[k&I.w_mask]=I.head[I.ins_h],I.head[I.ins_h]=k,k++,--S;);I.strstart=k,I.lookahead=R-1,fe(I)}return I.strstart+=I.lookahead,I.block_start=I.strstart,I.insert=I.lookahead,I.lookahead=0,I.match_length=I.prev_length=R-1,I.match_available=0,a.next_in=W,a.input=P,a.avail_in=U,I.wrap=E,c},s.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(t,i,s){i.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(t,i,s){i.exports=function(n,e){var r,l,u,v,p,f,c,g,m,y,b,x,C,j,A,N,O,D,R,F,G,w,T,h,M;r=n.state,l=n.next_in,h=n.input,u=l+(n.avail_in-5),v=n.next_out,M=n.output,p=v-(e-n.avail_out),f=v+(n.avail_out-257),c=r.dmax,g=r.wsize,m=r.whave,y=r.wnext,b=r.window,x=r.hold,C=r.bits,j=r.lencode,A=r.distcode,N=(1<<r.lenbits)-1,O=(1<<r.distbits)-1;e:do{C<15&&(x+=h[l++]<<C,C+=8,x+=h[l++]<<C,C+=8),D=j[x&N];t:for(;;){if(x>>>=R=D>>>24,C-=R,(R=D>>>16&255)===0)M[v++]=65535&D;else{if(!(16&R)){if(!(64&R)){D=j[(65535&D)+(x&(1<<R)-1)];continue t}if(32&R){r.mode=12;break e}n.msg="invalid literal/length code",r.mode=30;break e}F=65535&D,(R&=15)&&(C<R&&(x+=h[l++]<<C,C+=8),F+=x&(1<<R)-1,x>>>=R,C-=R),C<15&&(x+=h[l++]<<C,C+=8,x+=h[l++]<<C,C+=8),D=A[x&O];n:for(;;){if(x>>>=R=D>>>24,C-=R,!(16&(R=D>>>16&255))){if(!(64&R)){D=A[(65535&D)+(x&(1<<R)-1)];continue n}n.msg="invalid distance code",r.mode=30;break e}if(G=65535&D,C<(R&=15)&&(x+=h[l++]<<C,(C+=8)<R&&(x+=h[l++]<<C,C+=8)),c<(G+=x&(1<<R)-1)){n.msg="invalid distance too far back",r.mode=30;break e}if(x>>>=R,C-=R,(R=v-p)<G){if(m<(R=G-R)&&r.sane){n.msg="invalid distance too far back",r.mode=30;break e}if(T=b,(w=0)===y){if(w+=g-R,R<F){for(F-=R;M[v++]=b[w++],--R;);w=v-G,T=M}}else if(y<R){if(w+=g+y-R,(R-=y)<F){for(F-=R;M[v++]=b[w++],--R;);if(w=0,y<F){for(F-=R=y;M[v++]=b[w++],--R;);w=v-G,T=M}}}else if(w+=y-R,R<F){for(F-=R;M[v++]=b[w++],--R;);w=v-G,T=M}for(;2<F;)M[v++]=T[w++],M[v++]=T[w++],M[v++]=T[w++],F-=3;F&&(M[v++]=T[w++],1<F&&(M[v++]=T[w++]))}else{for(w=v-G;M[v++]=M[w++],M[v++]=M[w++],M[v++]=M[w++],2<(F-=3););F&&(M[v++]=M[w++],1<F&&(M[v++]=M[w++]))}break}}break}}while(l<u&&v<f);l-=F=C>>3,x&=(1<<(C-=F<<3))-1,n.next_in=l,n.next_out=v,n.avail_in=l<u?u-l+5:5-(l-u),n.avail_out=v<f?f-v+257:257-(v-f),r.hold=x,r.bits=C}},{}],49:[function(t,i,s){var n=t("../utils/common"),e=t("./adler32"),r=t("./crc32"),l=t("./inffast"),u=t("./inftrees"),v=1,p=2,f=0,c=-2,g=1,m=852,y=592;function b(w){return(w>>>24&255)+(w>>>8&65280)+((65280&w)<<8)+((255&w)<<24)}function x(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new n.Buf16(320),this.work=new n.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function C(w){var T;return w&&w.state?(T=w.state,w.total_in=w.total_out=T.total=0,w.msg="",T.wrap&&(w.adler=1&T.wrap),T.mode=g,T.last=0,T.havedict=0,T.dmax=32768,T.head=null,T.hold=0,T.bits=0,T.lencode=T.lendyn=new n.Buf32(m),T.distcode=T.distdyn=new n.Buf32(y),T.sane=1,T.back=-1,f):c}function j(w){var T;return w&&w.state?((T=w.state).wsize=0,T.whave=0,T.wnext=0,C(w)):c}function A(w,T){var h,M;return w&&w.state?(M=w.state,T<0?(h=0,T=-T):(h=1+(T>>4),T<48&&(T&=15)),T&&(T<8||15<T)?c:(M.window!==null&&M.wbits!==T&&(M.window=null),M.wrap=h,M.wbits=T,j(w))):c}function N(w,T){var h,M;return w?(M=new x,(w.state=M).window=null,(h=A(w,T))!==f&&(w.state=null),h):c}var O,D,R=!0;function F(w){if(R){var T;for(O=new n.Buf32(512),D=new n.Buf32(32),T=0;T<144;)w.lens[T++]=8;for(;T<256;)w.lens[T++]=9;for(;T<280;)w.lens[T++]=7;for(;T<288;)w.lens[T++]=8;for(u(v,w.lens,0,288,O,0,w.work,{bits:9}),T=0;T<32;)w.lens[T++]=5;u(p,w.lens,0,32,D,0,w.work,{bits:5}),R=!1}w.lencode=O,w.lenbits=9,w.distcode=D,w.distbits=5}function G(w,T,h,M){var ne,Z=w.state;return Z.window===null&&(Z.wsize=1<<Z.wbits,Z.wnext=0,Z.whave=0,Z.window=new n.Buf8(Z.wsize)),M>=Z.wsize?(n.arraySet(Z.window,T,h-Z.wsize,Z.wsize,0),Z.wnext=0,Z.whave=Z.wsize):(M<(ne=Z.wsize-Z.wnext)&&(ne=M),n.arraySet(Z.window,T,h-M,ne,Z.wnext),(M-=ne)?(n.arraySet(Z.window,T,h-M,M,0),Z.wnext=M,Z.whave=Z.wsize):(Z.wnext+=ne,Z.wnext===Z.wsize&&(Z.wnext=0),Z.whave<Z.wsize&&(Z.whave+=ne))),0}s.inflateReset=j,s.inflateReset2=A,s.inflateResetKeep=C,s.inflateInit=function(w){return N(w,15)},s.inflateInit2=N,s.inflate=function(w,T){var h,M,ne,Z,se,H,re,B,z,te,q,Y,fe,_e,ie,oe,ge,pe,Ae,je,a,L,I,k,S=0,E=new n.Buf8(4),U=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!w||!w.state||!w.output||!w.input&&w.avail_in!==0)return c;(h=w.state).mode===12&&(h.mode=13),se=w.next_out,ne=w.output,re=w.avail_out,Z=w.next_in,M=w.input,H=w.avail_in,B=h.hold,z=h.bits,te=H,q=re,L=f;e:for(;;)switch(h.mode){case g:if(h.wrap===0){h.mode=13;break}for(;z<16;){if(H===0)break e;H--,B+=M[Z++]<<z,z+=8}if(2&h.wrap&&B===35615){E[h.check=0]=255&B,E[1]=B>>>8&255,h.check=r(h.check,E,2,0),z=B=0,h.mode=2;break}if(h.flags=0,h.head&&(h.head.done=!1),!(1&h.wrap)||(((255&B)<<8)+(B>>8))%31){w.msg="incorrect header check",h.mode=30;break}if((15&B)!=8){w.msg="unknown compression method",h.mode=30;break}if(z-=4,a=8+(15&(B>>>=4)),h.wbits===0)h.wbits=a;else if(a>h.wbits){w.msg="invalid window size",h.mode=30;break}h.dmax=1<<a,w.adler=h.check=1,h.mode=512&B?10:12,z=B=0;break;case 2:for(;z<16;){if(H===0)break e;H--,B+=M[Z++]<<z,z+=8}if(h.flags=B,(255&h.flags)!=8){w.msg="unknown compression method",h.mode=30;break}if(57344&h.flags){w.msg="unknown header flags set",h.mode=30;break}h.head&&(h.head.text=B>>8&1),512&h.flags&&(E[0]=255&B,E[1]=B>>>8&255,h.check=r(h.check,E,2,0)),z=B=0,h.mode=3;case 3:for(;z<32;){if(H===0)break e;H--,B+=M[Z++]<<z,z+=8}h.head&&(h.head.time=B),512&h.flags&&(E[0]=255&B,E[1]=B>>>8&255,E[2]=B>>>16&255,E[3]=B>>>24&255,h.check=r(h.check,E,4,0)),z=B=0,h.mode=4;case 4:for(;z<16;){if(H===0)break e;H--,B+=M[Z++]<<z,z+=8}h.head&&(h.head.xflags=255&B,h.head.os=B>>8),512&h.flags&&(E[0]=255&B,E[1]=B>>>8&255,h.check=r(h.check,E,2,0)),z=B=0,h.mode=5;case 5:if(1024&h.flags){for(;z<16;){if(H===0)break e;H--,B+=M[Z++]<<z,z+=8}h.length=B,h.head&&(h.head.extra_len=B),512&h.flags&&(E[0]=255&B,E[1]=B>>>8&255,h.check=r(h.check,E,2,0)),z=B=0}else h.head&&(h.head.extra=null);h.mode=6;case 6:if(1024&h.flags&&(H<(Y=h.length)&&(Y=H),Y&&(h.head&&(a=h.head.extra_len-h.length,h.head.extra||(h.head.extra=new Array(h.head.extra_len)),n.arraySet(h.head.extra,M,Z,Y,a)),512&h.flags&&(h.check=r(h.check,M,Y,Z)),H-=Y,Z+=Y,h.length-=Y),h.length))break e;h.length=0,h.mode=7;case 7:if(2048&h.flags){if(H===0)break e;for(Y=0;a=M[Z+Y++],h.head&&a&&h.length<65536&&(h.head.name+=String.fromCharCode(a)),a&&Y<H;);if(512&h.flags&&(h.check=r(h.check,M,Y,Z)),H-=Y,Z+=Y,a)break e}else h.head&&(h.head.name=null);h.length=0,h.mode=8;case 8:if(4096&h.flags){if(H===0)break e;for(Y=0;a=M[Z+Y++],h.head&&a&&h.length<65536&&(h.head.comment+=String.fromCharCode(a)),a&&Y<H;);if(512&h.flags&&(h.check=r(h.check,M,Y,Z)),H-=Y,Z+=Y,a)break e}else h.head&&(h.head.comment=null);h.mode=9;case 9:if(512&h.flags){for(;z<16;){if(H===0)break e;H--,B+=M[Z++]<<z,z+=8}if(B!==(65535&h.check)){w.msg="header crc mismatch",h.mode=30;break}z=B=0}h.head&&(h.head.hcrc=h.flags>>9&1,h.head.done=!0),w.adler=h.check=0,h.mode=12;break;case 10:for(;z<32;){if(H===0)break e;H--,B+=M[Z++]<<z,z+=8}w.adler=h.check=b(B),z=B=0,h.mode=11;case 11:if(h.havedict===0)return w.next_out=se,w.avail_out=re,w.next_in=Z,w.avail_in=H,h.hold=B,h.bits=z,2;w.adler=h.check=1,h.mode=12;case 12:if(T===5||T===6)break e;case 13:if(h.last){B>>>=7&z,z-=7&z,h.mode=27;break}for(;z<3;){if(H===0)break e;H--,B+=M[Z++]<<z,z+=8}switch(h.last=1&B,z-=1,3&(B>>>=1)){case 0:h.mode=14;break;case 1:if(F(h),h.mode=20,T!==6)break;B>>>=2,z-=2;break e;case 2:h.mode=17;break;case 3:w.msg="invalid block type",h.mode=30}B>>>=2,z-=2;break;case 14:for(B>>>=7&z,z-=7&z;z<32;){if(H===0)break e;H--,B+=M[Z++]<<z,z+=8}if((65535&B)!=(B>>>16^65535)){w.msg="invalid stored block lengths",h.mode=30;break}if(h.length=65535&B,z=B=0,h.mode=15,T===6)break e;case 15:h.mode=16;case 16:if(Y=h.length){if(H<Y&&(Y=H),re<Y&&(Y=re),Y===0)break e;n.arraySet(ne,M,Z,Y,se),H-=Y,Z+=Y,re-=Y,se+=Y,h.length-=Y;break}h.mode=12;break;case 17:for(;z<14;){if(H===0)break e;H--,B+=M[Z++]<<z,z+=8}if(h.nlen=257+(31&B),B>>>=5,z-=5,h.ndist=1+(31&B),B>>>=5,z-=5,h.ncode=4+(15&B),B>>>=4,z-=4,286<h.nlen||30<h.ndist){w.msg="too many length or distance symbols",h.mode=30;break}h.have=0,h.mode=18;case 18:for(;h.have<h.ncode;){for(;z<3;){if(H===0)break e;H--,B+=M[Z++]<<z,z+=8}h.lens[U[h.have++]]=7&B,B>>>=3,z-=3}for(;h.have<19;)h.lens[U[h.have++]]=0;if(h.lencode=h.lendyn,h.lenbits=7,I={bits:h.lenbits},L=u(0,h.lens,0,19,h.lencode,0,h.work,I),h.lenbits=I.bits,L){w.msg="invalid code lengths set",h.mode=30;break}h.have=0,h.mode=19;case 19:for(;h.have<h.nlen+h.ndist;){for(;oe=(S=h.lencode[B&(1<<h.lenbits)-1])>>>16&255,ge=65535&S,!((ie=S>>>24)<=z);){if(H===0)break e;H--,B+=M[Z++]<<z,z+=8}if(ge<16)B>>>=ie,z-=ie,h.lens[h.have++]=ge;else{if(ge===16){for(k=ie+2;z<k;){if(H===0)break e;H--,B+=M[Z++]<<z,z+=8}if(B>>>=ie,z-=ie,h.have===0){w.msg="invalid bit length repeat",h.mode=30;break}a=h.lens[h.have-1],Y=3+(3&B),B>>>=2,z-=2}else if(ge===17){for(k=ie+3;z<k;){if(H===0)break e;H--,B+=M[Z++]<<z,z+=8}z-=ie,a=0,Y=3+(7&(B>>>=ie)),B>>>=3,z-=3}else{for(k=ie+7;z<k;){if(H===0)break e;H--,B+=M[Z++]<<z,z+=8}z-=ie,a=0,Y=11+(127&(B>>>=ie)),B>>>=7,z-=7}if(h.have+Y>h.nlen+h.ndist){w.msg="invalid bit length repeat",h.mode=30;break}for(;Y--;)h.lens[h.have++]=a}}if(h.mode===30)break;if(h.lens[256]===0){w.msg="invalid code -- missing end-of-block",h.mode=30;break}if(h.lenbits=9,I={bits:h.lenbits},L=u(v,h.lens,0,h.nlen,h.lencode,0,h.work,I),h.lenbits=I.bits,L){w.msg="invalid literal/lengths set",h.mode=30;break}if(h.distbits=6,h.distcode=h.distdyn,I={bits:h.distbits},L=u(p,h.lens,h.nlen,h.ndist,h.distcode,0,h.work,I),h.distbits=I.bits,L){w.msg="invalid distances set",h.mode=30;break}if(h.mode=20,T===6)break e;case 20:h.mode=21;case 21:if(6<=H&&258<=re){w.next_out=se,w.avail_out=re,w.next_in=Z,w.avail_in=H,h.hold=B,h.bits=z,l(w,q),se=w.next_out,ne=w.output,re=w.avail_out,Z=w.next_in,M=w.input,H=w.avail_in,B=h.hold,z=h.bits,h.mode===12&&(h.back=-1);break}for(h.back=0;oe=(S=h.lencode[B&(1<<h.lenbits)-1])>>>16&255,ge=65535&S,!((ie=S>>>24)<=z);){if(H===0)break e;H--,B+=M[Z++]<<z,z+=8}if(oe&&!(240&oe)){for(pe=ie,Ae=oe,je=ge;oe=(S=h.lencode[je+((B&(1<<pe+Ae)-1)>>pe)])>>>16&255,ge=65535&S,!(pe+(ie=S>>>24)<=z);){if(H===0)break e;H--,B+=M[Z++]<<z,z+=8}B>>>=pe,z-=pe,h.back+=pe}if(B>>>=ie,z-=ie,h.back+=ie,h.length=ge,oe===0){h.mode=26;break}if(32&oe){h.back=-1,h.mode=12;break}if(64&oe){w.msg="invalid literal/length code",h.mode=30;break}h.extra=15&oe,h.mode=22;case 22:if(h.extra){for(k=h.extra;z<k;){if(H===0)break e;H--,B+=M[Z++]<<z,z+=8}h.length+=B&(1<<h.extra)-1,B>>>=h.extra,z-=h.extra,h.back+=h.extra}h.was=h.length,h.mode=23;case 23:for(;oe=(S=h.distcode[B&(1<<h.distbits)-1])>>>16&255,ge=65535&S,!((ie=S>>>24)<=z);){if(H===0)break e;H--,B+=M[Z++]<<z,z+=8}if(!(240&oe)){for(pe=ie,Ae=oe,je=ge;oe=(S=h.distcode[je+((B&(1<<pe+Ae)-1)>>pe)])>>>16&255,ge=65535&S,!(pe+(ie=S>>>24)<=z);){if(H===0)break e;H--,B+=M[Z++]<<z,z+=8}B>>>=pe,z-=pe,h.back+=pe}if(B>>>=ie,z-=ie,h.back+=ie,64&oe){w.msg="invalid distance code",h.mode=30;break}h.offset=ge,h.extra=15&oe,h.mode=24;case 24:if(h.extra){for(k=h.extra;z<k;){if(H===0)break e;H--,B+=M[Z++]<<z,z+=8}h.offset+=B&(1<<h.extra)-1,B>>>=h.extra,z-=h.extra,h.back+=h.extra}if(h.offset>h.dmax){w.msg="invalid distance too far back",h.mode=30;break}h.mode=25;case 25:if(re===0)break e;if(Y=q-re,h.offset>Y){if((Y=h.offset-Y)>h.whave&&h.sane){w.msg="invalid distance too far back",h.mode=30;break}fe=Y>h.wnext?(Y-=h.wnext,h.wsize-Y):h.wnext-Y,Y>h.length&&(Y=h.length),_e=h.window}else _e=ne,fe=se-h.offset,Y=h.length;for(re<Y&&(Y=re),re-=Y,h.length-=Y;ne[se++]=_e[fe++],--Y;);h.length===0&&(h.mode=21);break;case 26:if(re===0)break e;ne[se++]=h.length,re--,h.mode=21;break;case 27:if(h.wrap){for(;z<32;){if(H===0)break e;H--,B|=M[Z++]<<z,z+=8}if(q-=re,w.total_out+=q,h.total+=q,q&&(w.adler=h.check=h.flags?r(h.check,ne,q,se-q):e(h.check,ne,q,se-q)),q=re,(h.flags?B:b(B))!==h.check){w.msg="incorrect data check",h.mode=30;break}z=B=0}h.mode=28;case 28:if(h.wrap&&h.flags){for(;z<32;){if(H===0)break e;H--,B+=M[Z++]<<z,z+=8}if(B!==(4294967295&h.total)){w.msg="incorrect length check",h.mode=30;break}z=B=0}h.mode=29;case 29:L=1;break e;case 30:L=-3;break e;case 31:return-4;case 32:default:return c}return w.next_out=se,w.avail_out=re,w.next_in=Z,w.avail_in=H,h.hold=B,h.bits=z,(h.wsize||q!==w.avail_out&&h.mode<30&&(h.mode<27||T!==4))&&G(w,w.output,w.next_out,q-w.avail_out)?(h.mode=31,-4):(te-=w.avail_in,q-=w.avail_out,w.total_in+=te,w.total_out+=q,h.total+=q,h.wrap&&q&&(w.adler=h.check=h.flags?r(h.check,ne,q,w.next_out-q):e(h.check,ne,q,w.next_out-q)),w.data_type=h.bits+(h.last?64:0)+(h.mode===12?128:0)+(h.mode===20||h.mode===15?256:0),(te==0&&q===0||T===4)&&L===f&&(L=-5),L)},s.inflateEnd=function(w){if(!w||!w.state)return c;var T=w.state;return T.window&&(T.window=null),w.state=null,f},s.inflateGetHeader=function(w,T){var h;return w&&w.state&&2&(h=w.state).wrap?((h.head=T).done=!1,f):c},s.inflateSetDictionary=function(w,T){var h,M=T.length;return w&&w.state?(h=w.state).wrap!==0&&h.mode!==11?c:h.mode===11&&e(1,T,M,0)!==h.check?-3:G(w,T,M,M)?(h.mode=31,-4):(h.havedict=1,f):c},s.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(t,i,s){var n=t("../utils/common"),e=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],r=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],l=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],u=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];i.exports=function(v,p,f,c,g,m,y,b){var x,C,j,A,N,O,D,R,F,G=b.bits,w=0,T=0,h=0,M=0,ne=0,Z=0,se=0,H=0,re=0,B=0,z=null,te=0,q=new n.Buf16(16),Y=new n.Buf16(16),fe=null,_e=0;for(w=0;w<=15;w++)q[w]=0;for(T=0;T<c;T++)q[p[f+T]]++;for(ne=G,M=15;1<=M&&q[M]===0;M--);if(M<ne&&(ne=M),M===0)return g[m++]=20971520,g[m++]=20971520,b.bits=1,0;for(h=1;h<M&&q[h]===0;h++);for(ne<h&&(ne=h),w=H=1;w<=15;w++)if(H<<=1,(H-=q[w])<0)return-1;if(0<H&&(v===0||M!==1))return-1;for(Y[1]=0,w=1;w<15;w++)Y[w+1]=Y[w]+q[w];for(T=0;T<c;T++)p[f+T]!==0&&(y[Y[p[f+T]]++]=T);if(O=v===0?(z=fe=y,19):v===1?(z=e,te-=257,fe=r,_e-=257,256):(z=l,fe=u,-1),w=h,N=m,se=T=B=0,j=-1,A=(re=1<<(Z=ne))-1,v===1&&852<re||v===2&&592<re)return 1;for(;;){for(D=w-se,F=y[T]<O?(R=0,y[T]):y[T]>O?(R=fe[_e+y[T]],z[te+y[T]]):(R=96,0),x=1<<w-se,h=C=1<<Z;g[N+(B>>se)+(C-=x)]=D<<24|R<<16|F|0,C!==0;);for(x=1<<w-1;B&x;)x>>=1;if(x!==0?(B&=x-1,B+=x):B=0,T++,--q[w]==0){if(w===M)break;w=p[f+y[T]]}if(ne<w&&(B&A)!==j){for(se===0&&(se=ne),N+=h,H=1<<(Z=w-se);Z+se<M&&!((H-=q[Z+se])<=0);)Z++,H<<=1;if(re+=1<<Z,v===1&&852<re||v===2&&592<re)return 1;g[j=B&A]=ne<<24|Z<<16|N-m|0}}return B!==0&&(g[N+B]=w-se<<24|64<<16|0),b.bits=ne,0}},{"../utils/common":41}],51:[function(t,i,s){i.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(t,i,s){var n=t("../utils/common"),e=0,r=1;function l(S){for(var E=S.length;0<=--E;)S[E]=0}var u=0,v=29,p=256,f=p+1+v,c=30,g=19,m=2*f+1,y=15,b=16,x=7,C=256,j=16,A=17,N=18,O=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],D=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],R=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],F=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],G=new Array(2*(f+2));l(G);var w=new Array(2*c);l(w);var T=new Array(512);l(T);var h=new Array(256);l(h);var M=new Array(v);l(M);var ne,Z,se,H=new Array(c);function re(S,E,U,W,P){this.static_tree=S,this.extra_bits=E,this.extra_base=U,this.elems=W,this.max_length=P,this.has_stree=S&&S.length}function B(S,E){this.dyn_tree=S,this.max_code=0,this.stat_desc=E}function z(S){return S<256?T[S]:T[256+(S>>>7)]}function te(S,E){S.pending_buf[S.pending++]=255&E,S.pending_buf[S.pending++]=E>>>8&255}function q(S,E,U){S.bi_valid>b-U?(S.bi_buf|=E<<S.bi_valid&65535,te(S,S.bi_buf),S.bi_buf=E>>b-S.bi_valid,S.bi_valid+=U-b):(S.bi_buf|=E<<S.bi_valid&65535,S.bi_valid+=U)}function Y(S,E,U){q(S,U[2*E],U[2*E+1])}function fe(S,E){for(var U=0;U|=1&S,S>>>=1,U<<=1,0<--E;);return U>>>1}function _e(S,E,U){var W,P,V=new Array(y+1),K=0;for(W=1;W<=y;W++)V[W]=K=K+U[W-1]<<1;for(P=0;P<=E;P++){var $=S[2*P+1];$!==0&&(S[2*P]=fe(V[$]++,$))}}function ie(S){var E;for(E=0;E<f;E++)S.dyn_ltree[2*E]=0;for(E=0;E<c;E++)S.dyn_dtree[2*E]=0;for(E=0;E<g;E++)S.bl_tree[2*E]=0;S.dyn_ltree[2*C]=1,S.opt_len=S.static_len=0,S.last_lit=S.matches=0}function oe(S){8<S.bi_valid?te(S,S.bi_buf):0<S.bi_valid&&(S.pending_buf[S.pending++]=S.bi_buf),S.bi_buf=0,S.bi_valid=0}function ge(S,E,U,W){var P=2*E,V=2*U;return S[P]<S[V]||S[P]===S[V]&&W[E]<=W[U]}function pe(S,E,U){for(var W=S.heap[U],P=U<<1;P<=S.heap_len&&(P<S.heap_len&&ge(E,S.heap[P+1],S.heap[P],S.depth)&&P++,!ge(E,W,S.heap[P],S.depth));)S.heap[U]=S.heap[P],U=P,P<<=1;S.heap[U]=W}function Ae(S,E,U){var W,P,V,K,$=0;if(S.last_lit!==0)for(;W=S.pending_buf[S.d_buf+2*$]<<8|S.pending_buf[S.d_buf+2*$+1],P=S.pending_buf[S.l_buf+$],$++,W===0?Y(S,P,E):(Y(S,(V=h[P])+p+1,E),(K=O[V])!==0&&q(S,P-=M[V],K),Y(S,V=z(--W),U),(K=D[V])!==0&&q(S,W-=H[V],K)),$<S.last_lit;);Y(S,C,E)}function je(S,E){var U,W,P,V=E.dyn_tree,K=E.stat_desc.static_tree,$=E.stat_desc.has_stree,Q=E.stat_desc.elems,he=-1;for(S.heap_len=0,S.heap_max=m,U=0;U<Q;U++)V[2*U]!==0?(S.heap[++S.heap_len]=he=U,S.depth[U]=0):V[2*U+1]=0;for(;S.heap_len<2;)V[2*(P=S.heap[++S.heap_len]=he<2?++he:0)]=1,S.depth[P]=0,S.opt_len--,$&&(S.static_len-=K[2*P+1]);for(E.max_code=he,U=S.heap_len>>1;1<=U;U--)pe(S,V,U);for(P=Q;U=S.heap[1],S.heap[1]=S.heap[S.heap_len--],pe(S,V,1),W=S.heap[1],S.heap[--S.heap_max]=U,S.heap[--S.heap_max]=W,V[2*P]=V[2*U]+V[2*W],S.depth[P]=(S.depth[U]>=S.depth[W]?S.depth[U]:S.depth[W])+1,V[2*U+1]=V[2*W+1]=P,S.heap[1]=P++,pe(S,V,1),2<=S.heap_len;);S.heap[--S.heap_max]=S.heap[1],function(ae,Ce){var Ue,Ee,We,me,tt,pt,Re=Ce.dyn_tree,Bt=Ce.max_code,gn=Ce.stat_desc.static_tree,bn=Ce.stat_desc.has_stree,_n=Ce.stat_desc.extra_bits,It=Ce.stat_desc.extra_base,Ze=Ce.stat_desc.max_length,nt=0;for(me=0;me<=y;me++)ae.bl_count[me]=0;for(Re[2*ae.heap[ae.heap_max]+1]=0,Ue=ae.heap_max+1;Ue<m;Ue++)Ze<(me=Re[2*Re[2*(Ee=ae.heap[Ue])+1]+1]+1)&&(me=Ze,nt++),Re[2*Ee+1]=me,Bt<Ee||(ae.bl_count[me]++,tt=0,It<=Ee&&(tt=_n[Ee-It]),pt=Re[2*Ee],ae.opt_len+=pt*(me+tt),bn&&(ae.static_len+=pt*(gn[2*Ee+1]+tt)));if(nt!==0){do{for(me=Ze-1;ae.bl_count[me]===0;)me--;ae.bl_count[me]--,ae.bl_count[me+1]+=2,ae.bl_count[Ze]--,nt-=2}while(0<nt);for(me=Ze;me!==0;me--)for(Ee=ae.bl_count[me];Ee!==0;)Bt<(We=ae.heap[--Ue])||(Re[2*We+1]!==me&&(ae.opt_len+=(me-Re[2*We+1])*Re[2*We],Re[2*We+1]=me),Ee--)}}(S,E),_e(V,he,S.bl_count)}function a(S,E,U){var W,P,V=-1,K=E[1],$=0,Q=7,he=4;for(K===0&&(Q=138,he=3),E[2*(U+1)+1]=65535,W=0;W<=U;W++)P=K,K=E[2*(W+1)+1],++$<Q&&P===K||($<he?S.bl_tree[2*P]+=$:P!==0?(P!==V&&S.bl_tree[2*P]++,S.bl_tree[2*j]++):$<=10?S.bl_tree[2*A]++:S.bl_tree[2*N]++,V=P,he=($=0)===K?(Q=138,3):P===K?(Q=6,3):(Q=7,4))}function L(S,E,U){var W,P,V=-1,K=E[1],$=0,Q=7,he=4;for(K===0&&(Q=138,he=3),W=0;W<=U;W++)if(P=K,K=E[2*(W+1)+1],!(++$<Q&&P===K)){if($<he)for(;Y(S,P,S.bl_tree),--$!=0;);else P!==0?(P!==V&&(Y(S,P,S.bl_tree),$--),Y(S,j,S.bl_tree),q(S,$-3,2)):$<=10?(Y(S,A,S.bl_tree),q(S,$-3,3)):(Y(S,N,S.bl_tree),q(S,$-11,7));V=P,he=($=0)===K?(Q=138,3):P===K?(Q=6,3):(Q=7,4)}}l(H);var I=!1;function k(S,E,U,W){q(S,(u<<1)+(W?1:0),3),function(P,V,K,$){oe(P),$&&(te(P,K),te(P,~K)),n.arraySet(P.pending_buf,P.window,V,K,P.pending),P.pending+=K}(S,E,U,!0)}s._tr_init=function(S){I||(function(){var E,U,W,P,V,K=new Array(y+1);for(P=W=0;P<v-1;P++)for(M[P]=W,E=0;E<1<<O[P];E++)h[W++]=P;for(h[W-1]=P,P=V=0;P<16;P++)for(H[P]=V,E=0;E<1<<D[P];E++)T[V++]=P;for(V>>=7;P<c;P++)for(H[P]=V<<7,E=0;E<1<<D[P]-7;E++)T[256+V++]=P;for(U=0;U<=y;U++)K[U]=0;for(E=0;E<=143;)G[2*E+1]=8,E++,K[8]++;for(;E<=255;)G[2*E+1]=9,E++,K[9]++;for(;E<=279;)G[2*E+1]=7,E++,K[7]++;for(;E<=287;)G[2*E+1]=8,E++,K[8]++;for(_e(G,f+1,K),E=0;E<c;E++)w[2*E+1]=5,w[2*E]=fe(E,5);ne=new re(G,O,p+1,f,y),Z=new re(w,D,0,c,y),se=new re(new Array(0),R,0,g,x)}(),I=!0),S.l_desc=new B(S.dyn_ltree,ne),S.d_desc=new B(S.dyn_dtree,Z),S.bl_desc=new B(S.bl_tree,se),S.bi_buf=0,S.bi_valid=0,ie(S)},s._tr_stored_block=k,s._tr_flush_block=function(S,E,U,W){var P,V,K=0;0<S.level?(S.strm.data_type===2&&(S.strm.data_type=function($){var Q,he=4093624447;for(Q=0;Q<=31;Q++,he>>>=1)if(1&he&&$.dyn_ltree[2*Q]!==0)return e;if($.dyn_ltree[18]!==0||$.dyn_ltree[20]!==0||$.dyn_ltree[26]!==0)return r;for(Q=32;Q<p;Q++)if($.dyn_ltree[2*Q]!==0)return r;return e}(S)),je(S,S.l_desc),je(S,S.d_desc),K=function($){var Q;for(a($,$.dyn_ltree,$.l_desc.max_code),a($,$.dyn_dtree,$.d_desc.max_code),je($,$.bl_desc),Q=g-1;3<=Q&&$.bl_tree[2*F[Q]+1]===0;Q--);return $.opt_len+=3*(Q+1)+5+5+4,Q}(S),P=S.opt_len+3+7>>>3,(V=S.static_len+3+7>>>3)<=P&&(P=V)):P=V=U+5,U+4<=P&&E!==-1?k(S,E,U,W):S.strategy===4||V===P?(q(S,2+(W?1:0),3),Ae(S,G,w)):(q(S,4+(W?1:0),3),function($,Q,he,ae){var Ce;for(q($,Q-257,5),q($,he-1,5),q($,ae-4,4),Ce=0;Ce<ae;Ce++)q($,$.bl_tree[2*F[Ce]+1],3);L($,$.dyn_ltree,Q-1),L($,$.dyn_dtree,he-1)}(S,S.l_desc.max_code+1,S.d_desc.max_code+1,K+1),Ae(S,S.dyn_ltree,S.dyn_dtree)),ie(S),W&&oe(S)},s._tr_tally=function(S,E,U){return S.pending_buf[S.d_buf+2*S.last_lit]=E>>>8&255,S.pending_buf[S.d_buf+2*S.last_lit+1]=255&E,S.pending_buf[S.l_buf+S.last_lit]=255&U,S.last_lit++,E===0?S.dyn_ltree[2*U]++:(S.matches++,E--,S.dyn_ltree[2*(h[U]+p+1)]++,S.dyn_dtree[2*z(E)]++),S.last_lit===S.lit_bufsize-1},s._tr_align=function(S){q(S,2,3),Y(S,C,G),function(E){E.bi_valid===16?(te(E,E.bi_buf),E.bi_buf=0,E.bi_valid=0):8<=E.bi_valid&&(E.pending_buf[E.pending++]=255&E.bi_buf,E.bi_buf>>=8,E.bi_valid-=8)}(S)}},{"../utils/common":41}],53:[function(t,i,s){i.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(t,i,s){(function(n){(function(e,r){if(!e.setImmediate){var l,u,v,p,f=1,c={},g=!1,m=e.document,y=Object.getPrototypeOf&&Object.getPrototypeOf(e);y=y&&y.setTimeout?y:e,l={}.toString.call(e.process)==="[object process]"?function(j){process.nextTick(function(){x(j)})}:function(){if(e.postMessage&&!e.importScripts){var j=!0,A=e.onmessage;return e.onmessage=function(){j=!1},e.postMessage("","*"),e.onmessage=A,j}}()?(p="setImmediate$"+Math.random()+"$",e.addEventListener?e.addEventListener("message",C,!1):e.attachEvent("onmessage",C),function(j){e.postMessage(p+j,"*")}):e.MessageChannel?((v=new MessageChannel).port1.onmessage=function(j){x(j.data)},function(j){v.port2.postMessage(j)}):m&&"onreadystatechange"in m.createElement("script")?(u=m.documentElement,function(j){var A=m.createElement("script");A.onreadystatechange=function(){x(j),A.onreadystatechange=null,u.removeChild(A),A=null},u.appendChild(A)}):function(j){setTimeout(x,0,j)},y.setImmediate=function(j){typeof j!="function"&&(j=new Function(""+j));for(var A=new Array(arguments.length-1),N=0;N<A.length;N++)A[N]=arguments[N+1];var O={callback:j,args:A};return c[f]=O,l(f),f++},y.clearImmediate=b}function b(j){delete c[j]}function x(j){if(g)setTimeout(x,0,j);else{var A=c[j];if(A){g=!0;try{(function(N){var O=N.callback,D=N.args;switch(D.length){case 0:O();break;case 1:O(D[0]);break;case 2:O(D[0],D[1]);break;case 3:O(D[0],D[1],D[2]);break;default:O.apply(r,D)}})(A)}finally{b(j),g=!1}}}}function C(j){j.source===e&&typeof j.data=="string"&&j.data.indexOf(p)===0&&x(+j.data.slice(p.length))}})(typeof self>"u"?n===void 0?this:n:self)}).call(this,typeof rt<"u"?rt:typeof self<"u"?self:typeof window<"u"?window:{})},{}]},{},[10])(10)})})(pn);var qs=pn.exports;const Ks=On(qs),mn=/url\("([\S*]+)"\)/,Xs=async(o,d,t,i,s)=>{var l,u,v;const n=document.querySelector("svg#".concat(o));if(!n)throw new Error("Requested canvas SVG element not found");const e=Number((l=n.style.getPropertyValue("--rmg-svg-height").match(/\d+/g))==null?void 0:l[0]),r=n.cloneNode(!0);if(r.setAttribute("height",(e*(s||100)/100).toString()),r.style.setProperty("all","initial"),["share"].map(p=>{var f;return[...((f=[...document.querySelectorAll("link")].filter(c=>c.id==="css_"+p)[0])==null?void 0:f.sheet).cssRules].map(c=>c.cssText).join(" ")}).forEach(p=>{const f=document.createElement("style");f.textContent=p,r.prepend(f)}),(u=r.querySelector("rect#canvas-border"))==null||u.setAttribute("stroke",i?"black":"none"),(v=r.querySelector("rect#canvas-bg"))==null||v.setAttribute("fill",t?"none":"white"),d===ee.MTR)try{const p=await ei(r),f=document.createElement("style");f.textContent=p.join("\n"),r.prepend(f)}catch(p){alert("Failed to fonts. Fonts in the exported PNG will be missing."),console.error(p)}return r},Js=o=>new Promise(d=>{const t=new FileReader;t.onloadend=()=>d(t.result),t.readAsDataURL(o)}),Qs=(o,d)=>o.find(t=>{const i=t.style;return i.getPropertyValue("font-family").replace(/^"(.+)"$/,"$1")===d.family&&i.getPropertyValue("unicode-range")===d.unicodeRange}),ei=async o=>{var n,e,r,l;const d=Array.from(new Set([...o.querySelectorAll(".rmg-name__zh"),...o.querySelectorAll(".rmg-name__en")].map(u=>u.innerHTML).join("").replace(/\s/g,""))).join(""),t=await document.fonts.load("80px GenYoMin TW, Vegur",d),i=Array.from(((l=((r=(e=(n=document.querySelector("link#css_share"))==null?void 0:n.sheet)==null?void 0:e.cssRules)==null?void 0:r[0]).styleSheet)==null?void 0:l.cssRules)||[]),s=t.reduce((u,v)=>{const p=Qs(i,v);return p?u.find(c=>{const g=c.style,m=p.style;return g.getPropertyValue("font-family")===m.getPropertyValue("font-family")&&g.getPropertyValue("unicode-range")===m.getPropertyValue("unicode-range")})?u:u.concat(p):u},[]);return await Promise.all(s.map(async u=>{try{const v=await fetch(ti(u)),p=await Js(await v.blob());return u.cssText.replace(mn,"url('".concat(p,"')"))}catch(v){return console.error(v),""}}))},ti=o=>{var t;return"/styles/"+((t=o.style.src.match(mn))==null?void 0:t[1])},ni=async(o,d,t)=>{const i=o.viewBox.baseVal.width,s=o.viewBox.baseVal.height,n=document.querySelectorAll("canvas")[0];n.width=Number(i)*window.devicePixelRatio*d,n.height=Number(s)*window.devicePixelRatio*d,o.setAttribute("width",n.width.toString()),o.setAttribute("height",n.height.toString());const e=n.getContext("2d");return e.clearRect(0,0,n.width,n.height),o.querySelectorAll(".rmg-name__en.rmg-name__gzmtr--next2-dest").forEach(r=>r.setAttribute("font-size","8.5px")),o.querySelectorAll("text, tspan").forEach(r=>{const l=window.getComputedStyle(r);r.setAttribute("font-family",l.fontFamily),r.setAttribute("fill",l.fill),r.setAttribute("dominant-baseline",l.dominantBaseline),r.setAttribute("text-anchor",l.textAnchor||"")}),new Promise((r,l)=>{const u=new Image;u.onload=()=>{setTimeout(()=>{e.drawImage(u,0,0,n.width,n.height),n.toBlob(v=>{v?r(v):l("Canvas blob is null")},"image/png")},t?2e3:0)},u.onerror=l,u.src="data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(o.outerHTML)))})};function ri(o){const{isOpen:d,onClose:t}=o,{t:i}=le(),s=ue(),[n,e]=X.useState(""),[r,l]=X.useState(!1),[u,v]=X.useState(!1),[p,f]=X.useState(100),[c,g]=X.useState("png"),m=J(R=>R.app.canvasToShow),{style:y,stn_list:b,current_stn_idx:x,line_name:C}=J(R=>R.param);X.useEffect(()=>{n!==""&&!m.includes(n)&&e("")},[m]);const j=Rt[y].reduce((R,F)=>m.includes(F)?{...R,[F]:i("CanvasType."+F)}:{...R},{"":i("DownloadModal.pleaseSelect")}),A=[25,33,50,67,75,80,90,100,110,125,150,175,200,250,300,400,500].reduce((R,F)=>({...R,[F]:"".concat(F,"%")}),{}),N={png:i("DownloadModal.png"),svg:i("DownloadModal.svg")},O=[{type:"select",label:i("DownloadModal.canvas"),value:n,options:j,disabledOptions:[""],onChange:R=>e(R),minW:"full"},{type:"switch",label:i("DownloadModal.transparent"),isChecked:r,onChange:l,oneLine:!0,minW:"full"},{type:"switch",label:i("DownloadModal.showBorder"),isChecked:u,onChange:v,oneLine:!0,minW:"full"},{type:"select",label:i("DownloadModal.scale"),value:p,options:A,onChange:R=>f(R)},{type:"select",label:i("DownloadModal.format"),value:c,options:N,onChange:R=>g(R)}],D=async R=>{s(Ut(0));const F=R==="current"?[x]:Object.keys(b).filter(w=>!["linestart","lineend"].includes(w)),G=new Ks;for(const w in F){s(Ut((Number(w)+1)/F.length*100));const T=F[w];s(wt(T)),await Br(500);const h=await Xs(n,y,r,u,p);document.body.appendChild(h);const M="rmg.".concat(T,".").concat(b[T].name[0],".").concat(b[T].name[1]).replaceAll(/\\|\/|\||\*|:|\?|<|>|"/g,"_");if(c==="png"){const ne=Ir()&&w==="0",Z=await ni(h,p/100,ne);F.length>1?G.file("".concat(M,".png"),Z):Wt("".concat(M,".png"),Z)}else if(c==="svg"){h.removeAttribute("height");const ne="data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(h.outerHTML)));F.length>1?G.file("".concat(M,".svg"),ne.split("base64,")[1],{base64:!0}):cn(M+".svg","image/svg+xml",h.outerHTML)}document.body.removeChild(h)}if(F.length>1){const w=await G.generateAsync({type:"blob"}),T="rmg.".concat(C[0],".").concat(C[1],".zip").replaceAll(" ","_");Wt(T,w)}ce.event(Se.DOWNLOAD_IMAGES,{canvasToDownload:n,style:y,option:R,format:c}),s(wt(x)),s(gr()),t()};return _.jsxs(Ye,{isOpen:d,onClose:t,children:[_.jsx(qe,{}),_.jsxs(Ke,{children:[_.jsx(Xe,{children:i("DownloadModal.title")}),_.jsx(Je,{}),_.jsx(Qe,{children:_.jsx(be,{fields:O})}),_.jsx(et,{children:_.jsxs(Oe,{children:[_.jsx(de,{colorScheme:"primary",variant:"outline",size:"sm",onClick:()=>D("current"),isDisabled:!n,children:i("DownloadModal.downloadOne")}),y!==ee.GZMTR&&_.jsx(de,{colorScheme:"primary",variant:"outline",size:"sm",onClick:()=>D("all"),isDisabled:!n,children:i("DownloadModal.downloadAll")})]})})]})]})}function si(){const{t:o}=le(),[d,t]=X.useState(!1),{paramConfig:i}=J(e=>e.app),s=J(e=>e.param),n=()=>{const e=Nr(s);cn("RMG_".concat(i==null?void 0:i.id,".json"),"application/json",JSON.stringify(e)),ce.event(Se.DOWNLOAD_PARAM,{style:s.style})};return _.jsxs(vn,{children:[_.jsx(Sn,{as:de,variant:"ghost",size:"sm",rightIcon:_.jsx(br,{}),children:o("DownloadActions.downloads")}),_.jsxs(xn,{children:[_.jsx(Nt,{onClick:n,children:o("DownloadActions.configFile")}),_.jsx(Nt,{onClick:()=>t(!0),children:o("DownloadActions.images")})]}),_.jsx(ri,{isOpen:d,onClose:()=>t(!1)})]})}function ft(){const[o,d]=Rn();return[o,i=>{if(d(i),Object.keys(i)){const s=new URLSearchParams(i);ce.updateUrl("/rmg/#/?"+s)}else ce.updateUrl("/rmg/#/")}]}function ii(){const{t:o}=le(),d=on(),[,t]=ft(),i=()=>{d(Le(De.CLOSE)),d(Ct(void 0)),t({})};return _.jsxs(Oe,{ml:"auto",w:"fit-content",children:[_.jsx(de,{variant:"ghost",size:"sm",leftIcon:_.jsx(_r,{}),onClick:i,children:o("All projects")}),_.jsx(si,{}),_.jsx(de,{variant:"solid",size:"sm",colorScheme:"primary",leftIcon:_.jsx(yr,{}),onClick:()=>d(Le(De.STYLE)),children:o("HeaderActions.editStyle")})]})}function ai(){const{t:o}=le(),d=ue(),{canvasToShow:t,canvasScale:i}=J(u=>u.app),s=J(u=>u.param.style),n=Object.values(ee).reduce((u,v)=>({...u,[v]:o("RmgStyle."+v)}),{}),e=Rt[s].map(u=>({label:o("CanvasType."+u),value:u})),r=u=>{d(jr(u))},l=[{type:"select",label:o("Style"),value:s,options:n,onChange:u=>r(u)},{type:"custom",label:o("View"),component:_.jsx(vr,{displayValue:o("Select canvas"),selections:e,defaultValue:t,onChange:u=>d(Sr(u))})},{type:"slider",label:o("Canvas scale"),value:i,min:.1,max:2,step:.01,onChange:u=>d(xr(u)),leftIcon:_.jsx(wr,{}),rightIcon:_.jsx(kr,{})}];return _.jsxs(Cr,{children:[_.jsx(be,{fields:l,minW:160}),_.jsx(ii,{})]})}const Ve=(o,d,t,i)=>(s,n)=>{var u,v,p,f,c,g,m,y,b,x,C,j,A,N;const e=n().param.stn_list;let r=$e(6);for(;r in e;)r=$e(6);const l=Ar(r);if(o!=="new"){const O={...e,[d]:{...e[d],children:e[d].children.map(D=>D===t?r:D),branch:{left:(u=e[d].branch)==null?void 0:u.left,right:((p=(v=e[d].branch)==null?void 0:v.right)==null?void 0:p[1])===t?(c=(f=e[d].branch)==null?void 0:f.right)==null?void 0:c.with(1,r):(g=e[d].branch)==null?void 0:g.right}},[t]:{...e[t],parents:e[t].parents.map(D=>D===d?r:D),branch:{left:((y=(m=e[t].branch)==null?void 0:m.left)==null?void 0:y[1])===d?(x=(b=e[t].branch)==null?void 0:b.left)==null?void 0:x.with(1,r):(C=e[t].branch)==null?void 0:C.left,right:(j=e[t].branch)==null?void 0:j.right}},[r]:{...l,parents:[d],children:[t]}};return s(we(O)),r}else{if(!i)return!1;const O={...e,[d]:{...e[d],children:i==="upper"?[r,e[d].children[0]]:[e[d].children[0],r],branch:{left:(A=e[d].branch)==null?void 0:A.left,right:[ct.through,r]}},[t]:{...e[t],parents:i==="upper"?[r,e[t].parents[0]]:[e[t].parents[0],r],branch:{left:[ct.through,r],right:(N=e[t].branch)==null?void 0:N.right}},[r]:{...l,parents:[d],children:[t]}};return s(we(O)),r}},oi=(o,d,t)=>(i,s)=>{const e=s().helper.branches[o];if(e!=null&&e.length)if(d==="before"){const r=e[e.indexOf(t)-1];return i(Ve(o.toString(),r,t))}else{const r=e[e.indexOf(t)+1];return i(Ve(o.toString(),t,r))}else return!1},li=()=>(o,d)=>{const t=d().param.stn_list;return d().helper.branches[0].filter(s=>{const n=t[s].parents.length+t[s].children.length===4,e=zt(s,t)===0;return!n&&e})},Xt=(o,d)=>(t,i)=>{const s=i().param.stn_list,n=i().helper.branches;return!n[0].includes(o)||!n[0].includes(d)?"Branch should end at main line":n[0].indexOf(o)>=n[0].indexOf(d)?"Not in correct ordering":o==="linestart"&&d==="lineend"?"Should not be parallel to main line":o==="linestart"&&n[0].indexOf(d)===1?"Branch should not be open jaw from the first station":d==="lineend"&&n[0].indexOf(o)===n[0].length-2?"Branch should not be open jaw from the last station":s[o].children.length>1||s[d].parents.length>1?"Branch already exist":n.slice(1).some(l=>l.slice(1,-1).includes(o)||l.slice(1,-1).includes(d))?"Cannot branch out from existing branch":n[0].slice(n[0].indexOf(o)+1,n[0].indexOf(d)).every(l=>s[l].parents.length===1&&s[l].children.length===1)?"":"One or more stations between both ends are branching out"};function ci(o){var N,O;const{isOpen:d,onClose:t}=o,{t:i}=le(),s=ue(),n=J(D=>D.app.selectedBranch),{style:e,stn_list:r}=J(D=>D.param),l=J(D=>D.helper.branches),[u,v]=X.useState(n),[p,f]=X.useState("before"),[c,g]=X.useState(""),[m,y]=X.useState(!1);X.useEffect(()=>{v(n)},[n]),X.useEffect(()=>{d||y(!1)},[d]);const b=(O=(N=l[Number(u)])==null?void 0:N.slice(1,-1))!=null?O:[],x=D=>D.reduce((R,F)=>{var G;return{...R,[F]:(G=r[F])==null?void 0:G.name.join(" - ")}},{"":i("AddStationModal.pleaseSelect")}),C=[{type:"select",label:i("AddStationModal.where"),value:u,options:{...l.reduce((D,R,F)=>({...D,[F]:F===0?i("AddStationModal.main"):e!==ee.SHMetro||!Fe(R,r)?i("AddStationModal.branch")+" "+F:i("AddStationModal.external")+" "+F}),{})},onChange:D=>j(D),minW:"full"},{type:"select",label:i("AddStationModal.preposition"),value:p,options:{before:i("AddStationModal.before"),after:i("AddStationModal.after")},onChange:D=>f(D)},{type:"select",label:i("AddStationModal.pivot"),value:c,options:x(b),disabledOptions:[""],onChange:D=>g(D)}],j=D=>{v(D),g("")},A=()=>{const D=s(oi(u,p,c));D?(t(),s(sn(D)),s(Le(De.STATION))):(console.log("false here"),y(!0)),ce.event(Se.ADD_STATION,{style:e,branchIndex:u,success:D})};return _.jsxs(Ye,{isOpen:d,onClose:t,children:[_.jsx(qe,{}),_.jsxs(Ke,{children:[m&&_.jsxs(dt,{status:"error",variant:"solid",size:"xs",children:[_.jsx(ht,{}),i("AddStationModal.error")]}),_.jsxs(ke,{position:"relative",children:[_.jsx(Xe,{children:i("AddStationModal.title")}),_.jsx(Je,{})]}),_.jsx(Qe,{children:_.jsx(be,{fields:C})}),_.jsx(et,{children:_.jsx(de,{colorScheme:"primary",onClick:A,isDisabled:!c,children:i("Confirm")})})]})]})}function di(o){const{isOpen:d,onClose:t}=o,{t:i}=le(),s=ue(),[n,e]=X.useState("new"),[r,l]=X.useState(""),[u,v]=X.useState(""),[p,f]=X.useState("upper"),[c,g]=X.useState(""),[m,y]=X.useState(""),{style:b,stn_list:x}=J(G=>G.param);X.useEffect(()=>{d||(e("new"),l(""),v(""))},[d]);const j=(G=>G.reduce((w,T)=>{var h;return{...w,[T]:T==="linestart"?"(".concat(i("LEFT END"),")"):T==="lineend"?"(".concat(i("RIGHT END"),")"):(h=x[T])==null?void 0:h.name.join(" - ")}},{"":i("Please select...")}))(s(li())),A=[{type:"select",label:i("NewBranchModal.where"),value:n,options:{new:i("NewBranchModal.new"),ext:i("NewBranchModal.ext")},disabledOptions:b===ee.SHMetro?[]:["ext"],onChange:G=>N(G),minW:"full"},{type:"select",label:i("NewBranchModal.from"),value:r,options:j,disabledOptions:[""],onChange:G=>O(G),isInvalid:!!c},{type:"select",label:i("NewBranchModal.to"),value:u,options:j,disabledOptions:[""],onChange:G=>D(G),isInvalid:!!m},{type:"select",label:i("NewBranchModal.position"),value:p,options:{upper:i("NewBranchModal.upper"),lower:i("NewBranchModal.lower")},onChange:G=>f(G),minW:"full",hidden:n!=="new"||b===ee.SHMetro}],N=G=>{e(G),l(""),v(""),g(""),y("")},O=G=>{l(G),g(""),G&&u&&y(s(Xt(G,u)))},D=G=>{v(G),y(""),r&&G&&g(s(Xt(r,G)))},R=()=>{let G;n==="ext"?G=s(Ve("new",r,u,"lower")):b===ee.SHMetro?G=s(Ve("new",r,u,"upper")):G=s(Ve("new",r,u,p)),G&&(t(),ce.event(Se.ADD_BRANCH,{style:b,where:n}))},F=!!(!r||!u||c||m);return _.jsxs(Ye,{isOpen:d,onClose:t,children:[_.jsx(qe,{}),_.jsxs(Ke,{children:[_.jsx(Xe,{children:i("NewBranchModal.title")}),_.jsx(Je,{}),_.jsx(Qe,{children:_.jsx(be,{fields:A})}),_.jsx(et,{children:_.jsx(de,{colorScheme:"primary",title:F?c||m:i("Confirm"),onClick:R,isDisabled:F,children:i("Confirm")})})]})]})}const hi=X.lazy(()=>it(()=>import("./station-ag-grid-Busf7Nj8.js"),__vite__mapDeps([10,1,2,3,4,11,7])));function ui(){const{t:o}=le(),d=ue(),[t,i]=X.useState(!1),[s,n]=X.useState(!1),e=J(p=>p.app.selectedBranch),{style:r,stn_list:l}=J(p=>p.param),u=J(p=>p.helper.branches),v=()=>{d(Le(De.BRANCH))};return _.jsxs(ke,{flex:1,overflow:"hidden",children:[_.jsxs(wn,{height:"100%",display:"flex",flexDirection:"column",overflow:"hidden",index:e,onChange:p=>d(Er(p)),children:[_.jsxs(kn,{children:[u.map((p,f)=>f===0?_.jsx(mt,{children:o("GridTabs.main")},f):r!==ee.SHMetro||!Fe(p,l)?_.jsx(mt,{children:o("GridTabs.branch")+" "+f},f):_.jsx(mt,{children:o("GridTabs.external")+" "+f},f)),_.jsx(Te,{size:"sm",variant:"ghost",alignSelf:"center","aria-label":"New branch",onClick:()=>n(!0),icon:_.jsx(ze,{})}),_.jsxs(Oe,{marginLeft:"auto",marginRight:1,children:[_.jsx(de,{variant:"outline",size:"xs",leftIcon:_.jsx(ze,{}),onClick:()=>i(!0),children:o("GridTabs.addStation")}),_.jsx(de,{size:"xs",colorScheme:"primary",onClick:v,children:o("GridTabs.editLine")})]})]}),_.jsx(Cn,{flex:1,overflowY:"auto",children:u.map((p,f)=>_.jsx(jn,{padding:0,h:"100%",position:"relative",children:_.jsx(en,{suspenseFallback:_.jsx(ut,{isIndeterminate:!0}),children:_.jsx(hi,{branchIndex:f})})},f))})]}),_.jsx(ci,{isOpen:t,onClose:()=>i(!1)}),_.jsx(di,{isOpen:s,onClose:()=>n(!1)})]})}function fi(){const o=ue(),d=J(i=>i.app.globalAlerts),t=i=>{ce.isStandaloneWindow()?window.open("/".concat(i),"_blank"):ce.openApp(i)};return _.jsx(_.Fragment,{children:Object.entries(d).map(([i,{message:s,url:n,linkedApp:e}])=>_.jsxs(dt,{status:i,variant:"solid",size:"xs",pl:3,pr:1,py:0,children:[_.jsx(ht,{}),e?_.jsx(He,{onClick:()=>t(e),children:s}):n?_.jsx(He,{href:n,target:"_blank",children:s}):s,_.jsx(Jt,{ml:"auto",onClick:()=>o(Or(i))})]},i))})}function pi(){const{t:o}=le(),d=J(s=>s.app.isLoading),[t,i]=X.useState(!1);return X.useEffect(()=>{ce.isStandaloneWindow()&&!ce.storage.get(Ge.DO_NOT_SHOW_RMT_MSG)&&i(!0)},[]),_.jsxs(ln,{children:[d&&_.jsx(ut,{isIndeterminate:d<0,value:d>=0?d:void 0}),_.jsx(ai,{}),t&&_.jsxs(dt,{status:"info",variant:"solid",size:"xs",pl:3,pr:1,py:1,children:[_.jsx(ht,{}),_.jsxs(at,{sx:{"& a, button":{fontWeight:"bold",textDecoration:"underline"}},children:[o("Try out")," ",_.jsx(He,{href:"/?app=rmg",isExternal:!0,children:o("Rail Map Toolkit")})," ",o("now and enjoy an even better rail map design experience!")," ",_.jsx(He,{as:"button",ml:"auto",onClick:()=>i(!1),children:o("Close")})," | ",_.jsx(He,{as:"button",onClick:()=>{i(!1),ce.storage.set(Ge.DO_NOT_SHOW_RMT_MSG,"true")},children:o("Don't show me again")})]})]}),_.jsx(fi,{}),_.jsxs(Pe,{flex:1,overflow:"hidden",position:"relative",children:[_.jsxs(Pe,{as:"section",direction:"column",flex:1,ml:1,mr:1,overflow:"hidden",children:[_.jsx(ke,{children:_.jsx($r,{})}),_.jsx(ui,{})]}),_.jsx(Ys,{})]}),_.jsx("canvas",{style:{display:"none"}})]})}const mi="rmg-templates-bridge--",gi={h:800,maxH:"70%","& iframe":{h:"100%",w:"100%"}};function bi(o){const{isOpen:d,onClose:t,onImport:i}=o,[s]=X.useState($e()),n="/rmg-templates/#/import?"+new URLSearchParams({parentComponent:ce.getAppName(),parentId:s});return X.useEffect(()=>{const e=new BroadcastChannel(mi+s);return e.onmessage=r=>{const{event:l,meta:u,data:v}=r.data;console.log("[rmg] Received event from RMG Templates app clip:",l),l==="CLOSE"?t():l==="IMPORT"&&i(v,u.name)},()=>{e.close()}},[]),_.jsx(an,{size:"xl",isOpen:d,onClose:t,sx:gi,children:_.jsx("iframe",{src:n,loading:"eager"})})}const _i={flexWrap:"wrap",flex:"1 1 0%",minW:120,"& button":{w:"100%",m:1}};function yi(o){const{selectedParam:d,disableNew:t,onError:i}=o,{t:s}=le(),[,n]=ft(),[e,r]=X.useState(!1),l=X.useRef(null),u=X.useRef(null);X.useEffect(()=>{var g;d&&((g=u.current)==null||g.focus())},[d]);const v=()=>{const g=Tr(ee.MTR,ce.getLanguage()),m=bt(JSON.stringify(g));n({project:m}),ce.event(Se.NEW_PARAM,{})},p=(g,m)=>{const y=bt(JSON.stringify(g),m);n({project:y})},f=async g=>{var y;const m=(y=g.target.files)==null?void 0:y[0];console.log("handleImportProject():: received file",m);try{if(!m)i(s("OpenActions.unknownError"));else if(m.type!=="application/json")i(s("OpenActions.invalidType"));else{const b=await Dr(m),x=bt(b);n({project:x}),ce.event(Se.UPLOAD_PARAM,{})}}catch(b){i(s("OpenActions.unknownError")),console.error("handleImportProject():: Unknown error occurred while parsing the uploaded file",b)}g.target.value=""},c=()=>{d&&(n({project:d}),ce.event(Se.OPEN_PARAM,{}))};return _.jsxs(Pe,{sx:_i,children:[_.jsx(de,{leftIcon:_.jsx(ze,{}),onClick:v,isDisabled:t,children:s("Blank project")}),_.jsx(de,{leftIcon:_.jsx(Rr,{}),onClick:()=>r(!0),isDisabled:t,children:s("Open template")}),_.jsx(de,{leftIcon:_.jsx(Pr,{}),onClick:()=>{var g;return(g=l.current)==null?void 0:g.click()},isDisabled:t,children:s("Import project")}),_.jsx(de,{ref:u,colorScheme:"primary",leftIcon:_.jsx(zr,{}),onClick:c,isDisabled:d===void 0,children:s("Open selected")}),_.jsx("input",{ref:l,type:"file",accept:".json",hidden:!0,onChange:f,"data-testid":"file-upload"}),_.jsx(bi,{isOpen:e,onClose:()=>r(!1),onImport:p})]})}const vi={flexDirection:"column",p:2,h3:{m:2},"& > div":{m:2,flexWrap:"wrap",flexDirection:{base:"column",md:"row"}}};function Si(o){const{downloading:d}=o,{t}=le(),[i]=ft(),s=i.get("project"),[n,e]=X.useState([]),[r,l]=X.useState(),u=X.useRef(null),v=Qt();X.useEffect(()=>{e(_t())},[d]),An({ref:u,handler:()=>l(void 0)});const p=g=>{const{id:m,name:y,lastModified:b}=g;m&&(ce.storage.set(Ge.PARAM_CONFIG_BY_ID+m,JSON.stringify({name:y,lastModified:b})),l(void 0),e(_t()),ce.event(Se.UPDATE_PARAM_CONFIG,{}))},f=g=>{ce.storage.remove(Ge.PARAM_BY_ID+g),ce.storage.remove(Ge.PARAM_CONFIG_BY_ID+g),l(void 0),e(_t()),ce.event(Se.REMOVE_PARAM,{})},c=g=>{v({description:g,status:"error",duration:1e4,isClosable:!0})};return _.jsxs(ln,{justifyContent:"center",children:[s&&_.jsx(ut,{isIndeterminate:!0}),_.jsx(En,{children:_.jsxs(Ne,{sx:vi,children:[_.jsx(ve,{as:"h3",size:"lg",children:t("Saved projects")}),_.jsxs(Pe,{ref:u,children:[_.jsx(Mr,{paramRegistry:n,downloading:d,selectedParam:r,onParamSelect:l,onParamRemove:f,onParamUpdate:p}),_.jsx(yi,{selectedParam:r,disableNew:n.length>=10,onError:c})]})]})})]})}const xi=o=>async d=>{try{const{config:t,param:i}=Lr(o);if(!i)return!1;const s={id:o,...t!=null?t:{}},n=Fr(i);try{const e=await Ur(n);d(Ct(s)),d(Zt(e))}catch(e){d(Ct(s)),d(Zt(n))}return!0}catch(t){return console.warn("Failed to parse param.",t),!1}};function wi(){const{t:o}=le(),d=ue(),{paramConfig:t}=J(f=>f.app),[i,s]=ft(),n=i.get("project"),e=i.get("external"),[r,l]=X.useState(!1),[u,v]=X.useState(),p=Qt();return X.useEffect(()=>{if(console.log("searchParam: project=".concat(n,", external=").concat(e)),n&&e)console.warn("AppRouter:: Both param ID and external URL are provided. External URL will be ignored."),s({project:n});else if(n)p.closeAll(),n===(t==null?void 0:t.id)?(console.log("AppRouter:: Store param ID matches URL param ID. Rendering app view..."),l(!0)):(console.log("AppRouter:: Loading app view for param (ID=".concat(n,")...")),d(xi(n)).then(f=>{f?l(!0):(console.log("AppRouter:: Failed to read param (ID=".concat(n,"). Rendering param selector view...")),p({description:o("Project selected is invalid or corrupted."),status:"error",duration:1e4,isClosable:!0}),s({}))}));else if(e){console.log("AppRouter:: External project URl is provided. Downloading project...");const f=decodeURIComponent(e);v(f),Wr(f).then(c=>{c?s({project:c}):(console.log("AppRouter:: Failed to download param from ".concat(f,". Rendering param selector view...")),p({description:o("External URL cannot be opened."),status:"error",duration:1e4,isClosable:!0}),s({})),v(void 0)})}else console.log("AppRouter:: No URL param ID or external URL provided. Rendering param selector view..."),l(!1)},[n,e]),r?_.jsx(pi,{}):_.jsx(Si,{downloading:u})}const Oi=Object.freeze(Object.defineProperty({__proto__:null,default:wi},Symbol.toStringTag,{value:"Module"}));export{Zr as R,Oi as a,Ei as g,Fe as i};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["assets/index-RVdv0m9B.js","assets/chakra-oLgDt0ZB.js","assets/react-Fl03amIb.js","assets/index-5KRu5Wq_.js","assets/index-e13pkHY7.css","assets/share-FUJNcP92.js","assets/mtr-NLUkfQm7.js","assets/param-manager-utils-yZ7fee0s.js","assets/index-dj_NMTW4.js","assets/index-fb2dLBXs.js","assets/station-ag-grid-Busf7Nj8.js","assets/ag-grid-RxoLydf6.js"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}